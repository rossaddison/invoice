{
  "version": 3,
  "sources": ["../../../../typescript/index.ts", "../../../../typescript/utils.ts", "../../../../typescript/create-credit.ts", "../../../../typescript/quote.ts", "../../../../typescript/client.ts", "../../../../typescript/invoice.ts", "../../../../typescript/product.ts", "../../../../typescript/tasks.ts", "../../../../typescript/salesorder.ts", "../../../../typescript/family.ts", "../../../../typescript/settings.ts", "../../../../typescript/scripts.ts", "../../../../typescript/family-commalist-picker.ts"],
  "sourcesContent": ["console.log(\"Invoice TypeScript bundle loaded\");\n\n// Main TypeScript entry point for Invoice Application\nimport { CreateCreditHandler } from './create-credit.js';\nimport { QuoteHandler } from './quote.js';\nimport { ClientHandler } from './client.js';\nimport { InvoiceHandler } from './invoice.js';\nimport { ProductHandler } from './product.js';\nimport { TaskHandler } from './tasks.js';\nimport { SalesOrderHandler } from './salesorder.js';\nimport { FamilyHandler } from './family.js';\nimport { SettingsHandler } from './settings.js';\nimport { initTooltips, initSimpleSelects, showFullpageLoader, hideFullpageLoader, initPasswordMeter } from './scripts.js';\nimport './family-commalist-picker.js';\n\n/**\n * Initialize Invoice Application\n */\nclass InvoiceApp {\n    readonly #createCreditHandler: CreateCreditHandler;\n    readonly #quoteHandler: QuoteHandler;\n    readonly #clientHandler: ClientHandler;\n    readonly #invoiceHandler: InvoiceHandler;\n    readonly #productHandler: ProductHandler;\n    readonly #taskHandler: TaskHandler;\n    readonly #salesOrderHandler: SalesOrderHandler;\n    readonly #familyHandler: FamilyHandler;\n    readonly #settingsHandler: SettingsHandler;\n\n    constructor() {\n        // Initialize handlers (stored as properties to keep event listeners active)\n        this.#createCreditHandler = new CreateCreditHandler();\n        this.#quoteHandler = new QuoteHandler();\n        this.#clientHandler = new ClientHandler();\n        this.#invoiceHandler = new InvoiceHandler();\n        this.#productHandler = new ProductHandler();\n        this.#taskHandler = new TaskHandler();\n        this.#salesOrderHandler = new SalesOrderHandler();\n        this.#familyHandler = new FamilyHandler();\n        this.#settingsHandler = new SettingsHandler();\n\n        this.initializeTooltips();\n        this.initializeTaggableFocus();\n        \n        // Initialize enhanced scripts functionality\n        initTooltips();\n        initSimpleSelects();\n        initPasswordMeter();\n        \n        // Set up fullpage loader handlers\n        this.initializeFullpageLoader();\n\n        console.log(\n            'Invoice TypeScript App initialized with all core handlers: Quote, Client, Invoice, Product, Task, SalesOrder, Family, and Settings'\n        );\n    }\n\n    /**\n     * Initialize Bootstrap tooltips\n     */\n    private initializeTooltips(): void {\n        document.addEventListener('DOMContentLoaded', () => {\n            if (typeof bootstrap !== 'undefined' && bootstrap.Tooltip) {\n                const tooltipElements = document.querySelectorAll('[data-bs-toggle=\"tooltip\"]');\n                tooltipElements.forEach(element => {\n                    try {\n                        new bootstrap.Tooltip(element as Element);\n                    } catch (error) {\n                        console.warn('Tooltip initialization failed:', error);\n                    }\n                });\n            }\n        });\n    }\n\n    /**\n     * Keep track of last taggable focused element\n     */\n    private initializeTaggableFocus(): void {\n        document.addEventListener(\n            'focus',\n            (event: FocusEvent) => {\n                const target = event.target as Element;\n                if (target?.classList?.contains('taggable')) {\n                    window.lastTaggableClicked = target;\n                }\n            },\n            true\n        );\n    }\n\n    /**\n     * Initialize fullpage loader functionality\n     */\n    private initializeFullpageLoader(): void {\n        document.addEventListener('click', (e) => {\n            const target = e.target as HTMLElement;\n            if (target.classList.contains('ajax-loader')) {\n                showFullpageLoader();\n            }\n            if (target.classList.contains('fullpage-loader-close')) {\n                hideFullpageLoader();\n            }\n        });\n    }\n}\n\n// Initialize the application when DOM is ready\nif (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', () => new InvoiceApp());\n} else {\n    new InvoiceApp();\n}\n\n// Export for potential external usage\nexport { InvoiceApp };\n", "import type { ApiResponse, RequestParams, FetchOptions, SafeElement } from './types.js';\n\n// Re-export types for convenience\nexport type { ApiResponse, RequestParams, FetchOptions, SafeElement } from './types.js';\n\n/**\n * Safe JSON parser that always returns an object\n * @param data - Data to parse (can be string, object, or any type)\n * @returns Parsed object or empty object if parsing fails\n */\nexport function parsedata(data: unknown): ApiResponse | Record<string, any> {\n    if (!data) return {};\n    if (typeof data === 'object' && data !== null) return data as Record<string, any>;\n    if (typeof data === 'string') {\n        try {\n            return JSON.parse(data) as Record<string, any>;\n        } catch (e) {\n            return {};\n        }\n    }\n    return {};\n}\n\n/**\n * HTTP GET helper that serializes arrays as bracketed keys (key[]=v1&key[]=v2)\n * @param url - Request URL\n * @param params - Parameters to send\n * @param options - Additional fetch options\n * @returns Promise resolving to parsed JSON or text\n */\nexport async function getJson<T = unknown>(\n    url: string,\n    params?: RequestParams,\n    options: FetchOptions = {}\n): Promise<T> {\n    let requestUrl = url;\n\n    if (params) {\n        const searchParams = new URLSearchParams();\n\n        Object.entries(params).forEach(([key, value]) => {\n            if (Array.isArray(value)) {\n                // Append as key[] so server parses it as an array (matches jQuery behavior)\n                value.forEach(item => {\n                    if (item !== null && item !== undefined) {\n                        searchParams.append(`${key}[]`, String(item));\n                    }\n                });\n            } else if (value !== undefined && value !== null) {\n                searchParams.append(key, String(value));\n            }\n        });\n\n        const separator = url.includes('?') ? '&' : '?';\n        requestUrl = `${url}${separator}${searchParams.toString()}`;\n    }\n\n    const defaultOptions: RequestInit = {\n        method: 'GET',\n        credentials: 'same-origin',\n        cache: 'no-store',\n        headers: { Accept: 'application/json' },\n        ...options,\n    };\n\n    const response = await fetch(requestUrl, defaultOptions);\n\n    if (!response.ok) {\n        throw new Error(`Network response not ok: ${response.status}`);\n    }\n\n    const text = await response.text();\n\n    try {\n        return JSON.parse(text) as T;\n    } catch (e) {\n        return text as T;\n    }\n}\n\n/**\n * Safe closest element finder with fallback for older browsers\n * @param element - Starting element\n * @param selector - CSS selector to match\n * @returns Matching ancestor element or null\n */\nexport function closestSafe<T extends Element = Element>(\n    element: Element | null,\n    selector: string\n): SafeElement<T> {\n    try {\n        if (!element) return null;\n\n        if (typeof element.closest === 'function') {\n            return element.closest(selector) as SafeElement<T>;\n        }\n\n        // Fallback: walk up parents manually\n        let node = element as Element | null;\n        while (node) {\n            if (node.matches && node.matches(selector)) {\n                return node as SafeElement<T>;\n            }\n            node = node.parentElement;\n        }\n    } catch (e) {\n        console.warn('closestSafe error:', e);\n        return null;\n    }\n\n    return null;\n}\n\n/**\n * Safe DOM element getter with type safety\n * @param id - Element ID\n * @returns Element or null\n */\nexport function getElementById<T extends HTMLElement = HTMLElement>(id: string): SafeElement<T> {\n    return document.getElementById(id) as SafeElement<T>;\n}\n\n/**\n * Safe DOM element selector with type safety\n * @param selector - CSS selector\n * @returns Element or null\n */\nexport function querySelector<T extends Element = Element>(selector: string): SafeElement<T> {\n    return document.querySelector(selector) as SafeElement<T>;\n}\n\n/**\n * Safe DOM elements selector with type safety\n * @param selector - CSS selector\n * @returns NodeList of elements\n */\nexport function querySelectorAll<T extends Element = Element>(selector: string): NodeListOf<T> {\n    return document.querySelectorAll(selector) as NodeListOf<T>;\n}\n\n/**\n * Get form field value safely\n * @param id - Element ID\n * @returns Value or empty string\n */\nexport function getInputValue(id: string): string {\n    const element = getElementById<HTMLInputElement>(id);\n    return element?.value || '';\n}\n\n/**\n * ES2024: Advanced Promise.withResolvers for batch data processing\n * Processes multiple async operations with timeout, retry, and progress tracking\n */\nexport async function processBatchWithProgress<T, R>(\n    items: T[],\n    processor: (item: T, index: number) => Promise<R>,\n    options: {\n        batchSize?: number;\n        timeoutMs?: number;\n        maxRetries?: number;\n        onProgress?: (completed: number, total: number) => void;\n    } = {}\n): Promise<R[]> {\n    const { batchSize = 5, timeoutMs = 30000, maxRetries = 3, onProgress } = options;\n    const { promise, resolve, reject } = Promise.withResolvers<R[]>();\n    \n    const results: R[] = [];\n    let completed = 0;\n    \n    // Process items in batches to avoid overwhelming the system\n    const processBatch = async (batch: T[], startIndex: number): Promise<R[]> => {\n        const batchPromises = batch.map(async (item, batchIndex) => {\n            const globalIndex = startIndex + batchIndex;\n            let lastError: Error | null = null;\n            \n            // Retry logic with exponential backoff\n            for (let attempt = 0; attempt <= maxRetries; attempt++) {\n                try {\n                    const timeoutPromise = new Promise<never>((_, timeoutReject) => {\n                        setTimeout(() => timeoutReject(\n                            new Error(`Processing timeout for item ${globalIndex}`)\n                        ), timeoutMs);\n                    });\n                    \n                    const result = await Promise.race([\n                        processor(item, globalIndex),\n                        timeoutPromise\n                    ]);\n                    \n                    completed++;\n                    onProgress?.(completed, items.length);\n                    return result;\n                } catch (error) {\n                    lastError = error as Error;\n                    if (attempt < maxRetries) {\n                        // Exponential backoff: 100ms, 200ms, 400ms\n                        await new Promise(r => setTimeout(r, 100 * Math.pow(2, attempt)));\n                    }\n                }\n            }\n            \n            throw new Error(\n                `Failed to process item ${globalIndex} after ${maxRetries + 1} attempts`,\n                { cause: lastError }\n            );\n        });\n        \n        return Promise.all(batchPromises);\n    };\n    \n    try {\n        // Process all batches sequentially to control load\n        for (let i = 0; i < items.length; i += batchSize) {\n            const batch = items.slice(i, i + batchSize);\n            const batchResults = await processBatch(batch, i);\n            results.push(...batchResults);\n        }\n        \n        resolve(results);\n    } catch (error) {\n        reject(error);\n    }\n    \n    return promise;\n}\n", "import { getJson, parsedata, querySelector, getInputValue } from './utils.js';\nimport type { ApiResponse, InvoiceFormData } from './types.js';\n\n/**\n * Handle create credit confirmation\n * Converts an invoice to a credit note\n */\nexport class CreateCreditHandler {\n    private readonly confirmButtonSelector = '.create-credit-confirm';\n\n    constructor() {\n        this.initialize();\n    }\n\n    private initialize(): void {\n        document.addEventListener('click', this.handleClick.bind(this), true);\n    }\n\n    private async handleClick(event: MouseEvent): Promise<void> {\n        const target = event.target as Element;\n\n        if (!target || target.id !== 'create-credit-confirm') {\n            return;\n        }\n\n        event.preventDefault();\n\n        try {\n            await this.processCreateCredit();\n        } catch (error) {\n            console.error('Create credit error:', error);\n            alert(`Error: ${error instanceof Error ? error.message : 'Unknown error'}`);\n        }\n    }\n\n    private async processCreateCredit(): Promise<void> {\n        const url = `${location.origin}/invoice/inv/create_credit_confirm`;\n        const btn = querySelector<HTMLElement>(this.confirmButtonSelector);\n        const absoluteUrl = new URL(location.href);\n\n        // Show loading spinner\n        if (btn) {\n            btn.innerHTML = '<h6 class=\"text-center\"><i class=\"fa fa-spin fa-spinner\"></i></h6>';\n        }\n\n        // Extract invoice ID from URL\n        const invId = absoluteUrl.pathname.split('/').at(-1) || '';\n\n        // Collect form data with type safety\n        const formData: InvoiceFormData = {\n            inv_id: invId,\n            client_id: getInputValue('client_id'),\n            inv_date_created: getInputValue('inv_date_created'),\n            group_id: getInputValue('inv_group_id'),\n            password: getInputValue('inv_password'),\n            user_id: getInputValue('user_id'),\n        };\n\n        // Make API request\n        const data = await getJson(url, formData);\n        const response = parsedata(data) as ApiResponse;\n\n        if (response.success === 1) {\n            // Success\n            if (btn) {\n                btn.innerHTML = '<h2 class=\"text-center\"><i class=\"bi bi-check2-square\"></i></h2>';\n            }\n\n            if (response.flash_message) {\n                alert(response.flash_message);\n            }\n\n            // Redirect and reload\n            location.href = absoluteUrl.href;\n            location.reload();\n        } else {\n            // Failure\n            if (btn) {\n                btn.innerHTML = '<h2 class=\"text-center\"><i class=\"fa fa-times\"></i></h2>';\n            }\n\n            if (response.flash_message) {\n                alert(response.flash_message);\n            }\n\n            // Redirect and reload\n            location.href = absoluteUrl.href;\n            location.reload();\n        }\n    }\n}\n", "import { parsedata, getJson, ApiResponse, RequestParams } from './utils.js';\n\n// Secure navigation helper to prevent Open Redirect vulnerabilities\nfunction secureReload(): void {\n    // Safely reload the current page without using potentially manipulable URLs\n    window.location.reload();\n}\n\n// Secure HTML insertion helper to prevent XSS vulnerabilities\nfunction secureInsertHTML(element: Element, html: string): void {\n    const parser = new DOMParser();\n    const doc = parser.parseFromString(html, 'text/html');\n    const fragment = document.createDocumentFragment();\n    Array.from(doc.body.children).forEach(child => fragment.appendChild(child));\n    element.innerHTML = '';\n    element.appendChild(fragment);\n}\n\n// Quote-specific interfaces\ninterface QuoteFormData extends RequestParams {\n    client_id?: string;\n    quote_group_id?: string;\n    quote_password?: string;\n    url_key?: string;\n    client_po_number?: string;\n    client_po_person?: string;\n    quote_id?: string;\n    group_id?: string;\n    password?: string;\n    so_group_id?: string;\n    po_number?: string;\n    po_person?: string;\n    create_quote_client_id?: string;\n    user_id?: string;\n    tax_rate_id?: string;\n    include_item_tax?: string;\n}\n\ninterface ClientNoteData extends RequestParams {\n    client_id: string;\n    client_note: string;\n}\n\n// Helper to get URL parameter from current page URL\nfunction getQuoteIdFromUrl(): string {\n    const url = new URL(location.href);\n    return url.pathname.split('/').at(-1) || '';\n}\n\n// Helper to get form field value safely\nfunction getFieldValue(id: string): string {\n    const element = document.getElementById(id) as HTMLInputElement | HTMLSelectElement | null;\n    return element?.value || '';\n}\n\n// Helper to set button loading state\nfunction setButtonLoading(button: HTMLElement, isLoading: boolean, originalHtml?: string): void {\n    if (isLoading) {\n        button.innerHTML = '<h6 class=\"text-center\"><i class=\"fa fa-spin fa-spinner\"></i></h6>';\n        (button as HTMLButtonElement).disabled = true;\n    } else {\n        button.innerHTML =\n            originalHtml || '<h6 class=\"text-center\"><i class=\"fa fa-check\"></i></h6>';\n        (button as HTMLButtonElement).disabled = false;\n    }\n}\n\n// Quote handler class\nexport class QuoteHandler {\n    constructor() {\n        this.bindEventListeners();\n        this.initializeComponents();\n    }\n\n    private bindEventListeners(): void {\n        // Main click handler with delegation\n        document.addEventListener('click', this.handleClick.bind(this), true);\n\n        // Input handlers\n        document.addEventListener('input', this.handleInput.bind(this), true);\n\n        // Focus handlers\n        document.addEventListener('focus', this.handleFocus.bind(this), true);\n\n        // Client note save handler\n        document.addEventListener('click', this.handleClientNoteSave.bind(this), true);\n\n        // Quote tax submit handler\n        document.addEventListener('click', this.handleQuoteTaxSubmit.bind(this), true);\n    }\n\n    private handleClick(event: Event): void {\n        const target = event.target as HTMLElement;\n\n        // Delete single item\n        const deleteBtn = target.closest('.btn_delete_item') as HTMLElement;\n        if (deleteBtn) {\n            this.handleDeleteItem(deleteBtn);\n            return;\n        }\n\n        // Delete multiple items\n        const delMulti = target.closest('.delete-items-confirm-quote') as HTMLElement;\n        if (delMulti) {\n            this.handleDeleteMultipleItems(delMulti);\n            return;\n        }\n\n        // Add row via modal\n        const addRowModalBtn = target.closest('.btn_add_row_modal') as HTMLElement;\n        if (addRowModalBtn) {\n            this.handleAddRowModal();\n            return;\n        }\n\n        // Add new quote item row\n        const btnQuoteItemAddRow = target.closest('.btn_quote_item_add_row') as HTMLElement;\n        if (btnQuoteItemAddRow) {\n            this.handleAddQuoteItemRow();\n            return;\n        }\n\n        // Add generic new row\n        const addRowBtn = target.closest('.btn_add_row') as HTMLElement;\n        if (addRowBtn) {\n            this.handleAddGenericRow();\n            return;\n        }\n\n        // Add client modal\n        const addClientBtn = target.closest('.quote_add_client') as HTMLElement;\n        if (addClientBtn) {\n            this.handleAddClientModal();\n            return;\n        }\n\n        // Quote create confirm\n        const createConfirm = target.closest(\n            '#quote_create_confirm, .quote_create_confirm'\n        ) as HTMLElement;\n        if (createConfirm) {\n            this.handleQuoteCreateConfirm();\n            return;\n        }\n\n        // Quote with purchase order confirm\n        const poConfirm = target.closest(\n            '#quote_with_purchase_order_number_confirm, .quote_with_purchase_order_number_confirm'\n        ) as HTMLElement;\n        if (poConfirm) {\n            this.handleQuotePurchaseOrderConfirm(poConfirm);\n            return;\n        }\n\n        // Quote to invoice confirm\n        const toInvoice = target.closest(\n            '#quote_to_invoice_confirm, .quote_to_invoice_confirm'\n        ) as HTMLElement;\n        if (toInvoice) {\n            this.handleQuoteToInvoiceConfirm(toInvoice);\n            return;\n        }\n\n        // Quote to sales order confirm\n        const toSo = target.closest('#quote_to_so_confirm, .quote_to_so_confirm') as HTMLElement;\n        if (toSo) {\n            this.handleQuoteToSalesOrderConfirm(toSo);\n            return;\n        }\n\n        // Quote to quote confirm (copy)\n        const toQuote = target.closest(\n            '#quote_to_quote_confirm, .quote_to_quote_confirm'\n        ) as HTMLElement;\n        if (toQuote) {\n            this.handleQuoteToQuoteConfirm(toQuote);\n            return;\n        }\n\n        // PDF generation handlers\n        this.handlePdfGeneration(target);\n    }\n\n    private async handleDeleteItem(deleteBtn: HTMLElement): Promise<void> {\n        const id = deleteBtn.getAttribute('data-id');\n\n        if (!id) {\n            // Remove from DOM if no ID\n            const parentItem = deleteBtn.closest('.item') as HTMLElement;\n            parentItem?.remove();\n            return;\n        }\n\n        try {\n            const url = `${location.origin}/invoice/quote/delete_item/${encodeURIComponent(id)}`;\n            const response = await getJson<ApiResponse>(url, { id });\n            const data = parsedata(response);\n\n            if (data.success === 1) {\n                location.reload();\n                const parentItem = deleteBtn.closest('.item') as HTMLElement;\n                parentItem?.remove();\n                alert('Deleted');\n            } else {\n                console.warn('delete_item failed', data);\n            }\n        } catch (error) {\n            console.error('delete_item error', error);\n            alert('An error occurred while deleting item. See console for details.');\n        }\n    }\n\n    private async handleDeleteMultipleItems(delMulti: HTMLElement): Promise<void> {\n        const originalHtml = delMulti.innerHTML;\n        setButtonLoading(delMulti, true);\n\n        try {\n            const itemCheckboxes = document.querySelectorAll(\n                \"input[name='item_ids[]']:checked\"\n            ) as NodeListOf<HTMLInputElement>;\n            const item_ids = Array.from(itemCheckboxes)\n                .map(input => parseInt(input.value, 10))\n                .filter(Boolean)\n                .toSorted((a, b) => a - b); // ES2024: Sort for consistent ordering\n\n            const response = await getJson<ApiResponse>('/invoice/quoteitem/multiple', {\n                item_ids,\n            });\n            const data = parsedata(response);\n\n            if (data.success === 1) {\n                delMulti.innerHTML = '<h2 class=\"text-center\"><i class=\"fa fa-check\"></i></h2>';\n                location.reload();\n            } else {\n                console.warn('quoteitem/multiple failed', data);\n                setButtonLoading(delMulti, false, originalHtml);\n            }\n        } catch (error) {\n            console.error('quoteitem/multiple error', error);\n            setButtonLoading(delMulti, false, originalHtml);\n            alert('An error occurred while deleting items. See console for details.');\n        }\n    }\n\n    private async handleAddRowModal(): Promise<void> {\n        const quoteId = getQuoteIdFromUrl();\n        const url = `${location.origin}/invoice/quoteitem/add/${encodeURIComponent(quoteId)}`;\n        const placeholder = document.getElementById('modal-placeholder-quoteitem');\n\n        if (!placeholder) return;\n\n        try {\n            placeholder.innerHTML =\n                '<h2 class=\"text-center\"><i class=\"fa fa-spin fa-spinner\"></i></h2>';\n            const response = await fetch(url, { cache: 'no-store', credentials: 'same-origin' });\n            const html = await response.text();\n            // Secure HTML insertion to prevent XSS\n            secureInsertHTML(placeholder, html);\n        } catch (error) {\n            console.error('Failed to load quoteitem modal', error);\n        }\n    }\n\n    private handleAddQuoteItemRow(): void {\n        const template = document.getElementById('new_quote_item_row') as HTMLElement;\n        const table = document.getElementById('item_table') as HTMLElement;\n\n        if (template && table) {\n            const clone = template.cloneNode(true) as HTMLElement;\n            clone.removeAttribute('id');\n            clone.classList.add('item');\n            clone.style.display = '';\n            table.appendChild(clone);\n        }\n    }\n\n    private handleAddGenericRow(): void {\n        const template = document.getElementById('new_row') as HTMLElement;\n        const table = document.getElementById('item_table') as HTMLElement;\n\n        if (template && table) {\n            const clone = template.cloneNode(true) as HTMLElement;\n            clone.removeAttribute('id');\n            clone.classList.add('item');\n            clone.style.display = '';\n            table.appendChild(clone);\n        }\n    }\n\n    private async handleAddClientModal(): Promise<void> {\n        const url = `${location.origin}/invoice/add-a-client`;\n        const placeholder = document.getElementById('modal-placeholder-client');\n\n        if (!placeholder) return;\n\n        try {\n            placeholder.innerHTML =\n                '<h2 class=\"text-center\"><i class=\"fa fa-spin fa-spinner\"></i></h2>';\n            const response = await fetch(url, { cache: 'no-store', credentials: 'same-origin' });\n            const html = await response.text();\n            // Secure HTML insertion to prevent XSS\n            secureInsertHTML(placeholder, html);\n        } catch (error) {\n            console.error('Failed to load add-a-client modal', error);\n        }\n    }\n\n    private async handleQuoteCreateConfirm(): Promise<void> {\n        const url = `${location.origin}/invoice/quote/create_confirm`;\n        const btn = document.querySelector('.quote_create_confirm') as HTMLElement;\n        const originalHtml = btn?.innerHTML || '';\n\n        if (btn) {\n            setButtonLoading(btn, true);\n        }\n\n        try {\n            const payload: QuoteFormData = {\n                client_id: getFieldValue('create_quote_client_id'),\n                quote_group_id: getFieldValue('quote_group_id'),\n                quote_password: getFieldValue('quote_password'),\n            };\n\n            const response = await getJson<ApiResponse>(url, payload);\n            const data = parsedata(response);\n\n            if (data.success === 1) {\n                if (btn) btn.innerHTML = '<h2 class=\"text-center\"><i class=\"fa fa-check\"></i></h2>';\n                secureReload();\n            } else if (data.success === 0) {\n                if (btn) btn.innerHTML = '<h6 class=\"text-center\"><i class=\"fa fa-check\"></i></h6>';\n                secureReload();\n                if (data.message) alert(data.message);\n            }\n        } catch (error) {\n            console.error('create_confirm error', error);\n            if (btn) {\n                setButtonLoading(btn, false, originalHtml);\n            }\n            alert('An error occurred while creating quote. See console for details.');\n        }\n    }\n\n    private async handleQuotePurchaseOrderConfirm(poConfirm: HTMLElement): Promise<void> {\n        const url = `${location.origin}/invoice/quote/approve`;\n        const btn =\n            (document.querySelector('.quote_with_purchase_order_number_confirm') as HTMLElement) ||\n            poConfirm;\n\n        if (btn) {\n            setButtonLoading(btn, true);\n        }\n\n        try {\n            const payload: QuoteFormData = {\n                url_key: getFieldValue('url_key'),\n                client_po_number: getFieldValue('quote_with_purchase_order_number'),\n                client_po_person: getFieldValue('quote_with_purchase_order_person'),\n            };\n\n            const response = await getJson<ApiResponse>(url, payload);\n            const data = parsedata(response);\n\n            if (data.success === 1) {\n                if (btn) btn.innerHTML = '<h2 class=\"text-center\"><i class=\"fa fa-check\"></i></h2>';\n                secureReload();\n            }\n        } catch (error) {\n            console.error('approve error', error);\n            if (btn) {\n                setButtonLoading(btn, false);\n            }\n            alert('An error occurred while approving quote. See console for details.');\n        }\n    }\n\n    private async handleQuoteToInvoiceConfirm(toInvoice: HTMLElement): Promise<void> {\n        const url = `${location.origin}/invoice/quote/quote_to_invoice_confirm`;\n        const btn =\n            (document.querySelector('.quote_to_invoice_confirm') as HTMLElement) || toInvoice;\n        const originalHtml = btn?.innerHTML || '';\n\n        if (btn) {\n            setButtonLoading(btn, true);\n        }\n\n        try {\n            const quoteId = getQuoteIdFromUrl();\n            const payload: QuoteFormData = {\n                quote_id: quoteId,\n                client_id: getFieldValue('client_id'),\n                group_id: getFieldValue('group_id'),\n                password: getFieldValue('password'),\n            };\n\n            const response = await getJson<ApiResponse>(url, payload);\n            const data = parsedata(response);\n\n            if (btn) btn.innerHTML = '<h2 class=\"text-center\"><i class=\"fa fa-check\"></i></h2>';\n            \n            // Redirect to the created invoice if successful\n            if (data.success && data.redirect_url) {\n                window.location.href = data.redirect_url;\n            } else if (data.success && data.new_invoice_id) {\n                // Fallback to old behavior for backward compatibility\n                window.location.href = `${location.origin}/invoice/inv/view/${data.new_invoice_id}`;\n            } else {\n                // Fallback to reload if no redirect URL is provided\n                secureReload();\n            }\n            \n            if (data.flash_message) alert(data.flash_message);\n        } catch (error) {\n            console.error('quote_to_invoice_confirm error', error);\n            if (btn) {\n                setButtonLoading(btn, false, originalHtml);\n            }\n            alert('An error occurred while converting quote to invoice. See console for details.');\n        }\n    }\n\n    private async handleQuoteToSalesOrderConfirm(toSo: HTMLElement): Promise<void> {\n        const url = `${location.origin}/invoice/quote/quote_to_so_confirm`;\n        const btn = (document.querySelector('.quote_to_so_confirm') as HTMLElement) || toSo;\n        const originalHtml = btn?.innerHTML || '';\n\n        if (btn) {\n            setButtonLoading(btn, true);\n        }\n\n        try {\n            const quoteId = getQuoteIdFromUrl();\n            const payload: QuoteFormData = {\n                quote_id: quoteId,\n                client_id: getFieldValue('client_id'),\n                group_id: getFieldValue('so_group_id'),\n                po_number: getFieldValue('po_number'),\n                po_person: getFieldValue('po_person'),\n                password: getFieldValue('password'),\n            };\n\n            const response = await getJson<ApiResponse>(url, payload);\n            const data = parsedata(response);\n\n            if (btn) btn.innerHTML = '<h2 class=\"text-center\"><i class=\"fa fa-check\"></i></h2>';\n            \n            // Redirect to the created sales order if successful\n            if (data.success && data.redirect_url) {\n                window.location.href = data.redirect_url;\n            } else {\n                // Fallback to reload if no redirect URL is provided\n                secureReload();\n            }\n            \n            if (data.flash_message) alert(data.flash_message);\n        } catch (error) {\n            console.error('quote_to_so_confirm error', error);\n            if (btn) {\n                setButtonLoading(btn, false, originalHtml);\n            }\n            alert('An error occurred while converting quote to SO. See console for details.');\n        }\n    }\n\n    private async handleQuoteToQuoteConfirm(toQuote: HTMLElement): Promise<void> {\n        const url = `${location.origin}/invoice/quote/quote_to_quote_confirm`;\n        const btn = (document.querySelector('.quote_to_quote_confirm') as HTMLElement) || toQuote;\n        const originalHtml = btn?.innerHTML || '';\n\n        if (btn) {\n            setButtonLoading(btn, true);\n        }\n\n        try {\n            const quoteId = getQuoteIdFromUrl();\n            const payload: QuoteFormData = {\n                quote_id: quoteId,\n                client_id: getFieldValue('create_quote_client_id'),\n                user_id: getFieldValue('user_id'),\n            };\n\n            const response = await getJson<ApiResponse>(url, payload);\n            const data = parsedata(response);\n\n            if (data.success === 1) {\n                if (btn) btn.innerHTML = '<h2 class=\"text-center\"><i class=\"fa fa-check\"></i></h2>';\n                secureReload();\n                if (data.flash_message) alert(data.flash_message);\n            }\n        } catch (error) {\n            console.error('quote_to_quote_confirm error', error);\n            if (btn) {\n                setButtonLoading(btn, false, originalHtml);\n            }\n            alert('An error occurred while copying quote. See console for details.');\n        }\n    }\n\n    private handlePdfGeneration(target: HTMLElement): void {\n        // PDF with custom fields\n        if (target.closest('#quote_to_pdf_confirm_with_custom_fields')) {\n            const url = `${location.origin}/invoice/quote/pdf/1`;\n            window.open(url, '_blank');\n            return;\n        }\n\n        // PDF without custom fields\n        if (target.closest('#quote_to_pdf_confirm_without_custom_fields')) {\n            const url = `${location.origin}/invoice/quote/pdf/0`;\n            window.open(url, '_blank');\n            return;\n        }\n    }\n\n    private async handleClientNoteSave(event: Event): Promise<void> {\n        const target = event.target as HTMLElement;\n        const saveBtn = target.closest('#save_client_note');\n        if (!saveBtn) return;\n\n        const url = `${location.origin}/invoice/client/save_client_note`;\n        const loadUrl = `${location.origin}/invoice/client/load_client_notes`;\n\n        try {\n            const payload: ClientNoteData = {\n                client_id: getFieldValue('client_id'),\n                client_note: getFieldValue('client_note'),\n            };\n\n            const response = await getJson<ApiResponse>(url, payload);\n            const data = parsedata(response);\n\n            if (data.success === 1) {\n                // Remove error classes\n                document.querySelectorAll('.control-group').forEach(group => {\n                    group.classList.remove('error');\n                });\n\n                // Clear note field\n                const noteEl = document.getElementById('client_note') as HTMLInputElement;\n                if (noteEl) noteEl.value = '';\n\n                // Reload notes list\n                const notesList = document.getElementById('notes_list');\n                if (notesList) {\n                    const loadUrlWithParams = `${loadUrl}?client_id=${encodeURIComponent(payload.client_id)}`;\n                    const notesResponse = await fetch(loadUrlWithParams, {\n                        cache: 'no-store',\n                        credentials: 'same-origin',\n                    });\n                    const html = await notesResponse.text();\n                    // Secure HTML insertion to prevent XSS\n                    secureInsertHTML(notesList, html);\n                }\n            } else {\n                // Show validation errors\n                document.querySelectorAll('.control-group').forEach(group => {\n                    group.classList.remove('error');\n                });\n\n                if (data.validation_errors) {\n                    Object.entries(data.validation_errors).forEach(([key, errors]) => {\n                        const elm = document.getElementById(key);\n                        if (elm?.parentElement) {\n                            elm.parentElement.classList.add('has-error');\n                        }\n                    });\n                }\n            }\n        } catch (error) {\n            console.error('save_client_note error', error);\n            alert('Status: error An error occurred');\n        }\n    }\n\n    private async handleQuoteTaxSubmit(event: Event): Promise<void> {\n        const target = event.target as HTMLElement;\n        const submit = target.closest('#quote_tax_submit');\n        if (!submit) return;\n\n        const url = `${location.origin}/invoice/quote/save_quote_tax_rate`;\n        const btn =\n            (document.querySelector('.quote_tax_submit') as HTMLElement) || (submit as HTMLElement);\n\n        if (btn) {\n            setButtonLoading(btn, true);\n        }\n\n        try {\n            const quoteId = getQuoteIdFromUrl();\n            const payload: QuoteFormData = {\n                quote_id: quoteId,\n                tax_rate_id: getFieldValue('tax_rate_id'),\n                include_item_tax: getFieldValue('include_item_tax'),\n            };\n\n            const response = await getJson<ApiResponse>(url, payload);\n            const data = parsedata(response);\n\n            secureReload();\n            if (data.flash_message) alert(data.flash_message);\n        } catch (error) {\n            console.error('save_quote_tax_rate error', error);\n            alert('An error occurred while saving quote tax rate. See console for details.');\n        }\n    }\n\n    private handleInput(event: Event): void {\n        const target = event.target as HTMLInputElement;\n\n        // Discount amount input\n        if (target.id === 'quote_discount_amount') {\n            const percentEl = document.getElementById('quote_discount_percent') as HTMLInputElement;\n            if (target.value.length > 0) {\n                if (percentEl) {\n                    percentEl.value = '0.00';\n                    percentEl.disabled = true;\n                }\n            } else {\n                if (percentEl) percentEl.disabled = false;\n            }\n        }\n\n        // Discount percent input\n        if (target.id === 'quote_discount_percent') {\n            const amountEl = document.getElementById('quote_discount_amount') as HTMLInputElement;\n            if (target.value.length > 0) {\n                if (amountEl) {\n                    amountEl.value = '0.00';\n                    amountEl.disabled = true;\n                }\n            } else {\n                if (amountEl) amountEl.disabled = false;\n            }\n        }\n    }\n\n    private handleFocus(event: Event): void {\n        const target = event.target as HTMLElement;\n\n        // Datepicker initialization\n        if (target.id === 'datepicker') {\n            this.initializeDatepicker(target);\n        }\n\n        if (target.classList?.contains('datepicker')) {\n            this.initializeDatepicker(target);\n        }\n\n        // Taggable focus tracking\n        if (target.classList?.contains('taggable')) {\n            (window as any).lastTaggableClicked = target;\n        }\n    }\n\n    private initializeDatepicker(element: HTMLElement): void {\n        if ((window as any).jQuery?.fn?.datepicker) {\n            if (element.id === 'datepicker') {\n                (window as any).jQuery(element).datepicker({\n                    changeMonth: true,\n                    changeYear: true,\n                    showButtonPanel: true,\n                    dateFormat: 'dd-mm-yy',\n                });\n            } else {\n                (window as any).jQuery(element).datepicker({\n                    beforeShow: () => {\n                        setTimeout(() => {\n                            document.querySelectorAll('.datepicker').forEach(d => {\n                                (d as HTMLElement).style.zIndex = '9999';\n                            });\n                        }, 0);\n                    },\n                });\n            }\n        }\n    }\n\n    private initializeComponents(): void {\n        // Check if DOM is already loaded\n        if (document.readyState === 'loading') {\n            document.addEventListener('DOMContentLoaded', () => {\n                this.initializeTooltips();\n                this.initializeTagSelect();\n            });\n        } else {\n            // DOM is already loaded, initialize immediately\n            this.initializeTooltips();\n            this.initializeTagSelect();\n        }\n    }\n\n    private initializeTooltips(): void {\n        if (typeof (window as any).bootstrap?.Tooltip !== 'undefined') {\n            document.querySelectorAll('[data-bs-toggle=\"tooltip\"]').forEach(element => {\n                try {\n                    new (window as any).bootstrap.Tooltip(element);\n                } catch (error) {\n                    // Ignore tooltip initialization errors\n                }\n            });\n        }\n    }\n\n    private initializeTagSelect(): void {\n        document.querySelectorAll('.tag-select').forEach(select => {\n            const selectElement = select as HTMLSelectElement;\n            selectElement.addEventListener('change', event => {\n                const currentTarget = event.currentTarget as HTMLSelectElement;\n\n                if ((window as any).lastTaggableClicked) {\n                    this.insertAtCaret((window as any).lastTaggableClicked.id, currentTarget.value);\n                }\n\n                // Reset select value\n                if ((currentTarget as any)._tomselect?.clear) {\n                    (currentTarget as any)._tomselect.clear();\n                } else if ((currentTarget as any).tomselect?.clear) {\n                    (currentTarget as any).tomselect.clear();\n                } else if (currentTarget.multiple) {\n                    // ES2024: Process options in reverse order for UI consistency\n                    Array.from(currentTarget.options).toReversed().forEach(option => {\n                        option.selected = false;\n                    });\n                } else {\n                    currentTarget.value = '';\n                }\n\n                event.preventDefault();\n                return false;\n            });\n        });\n    }\n\n    private insertAtCaret(elementId: string, text: string): void {\n        const element = document.getElementById(elementId) as\n            | HTMLInputElement\n            | HTMLTextAreaElement;\n        if (!element) return;\n\n        const startPos = element.selectionStart || 0;\n        const endPos = element.selectionEnd || 0;\n        const value = element.value;\n\n        element.value = value.substring(0, startPos) + text + value.substring(endPos);\n        element.setSelectionRange(startPos + text.length, startPos + text.length);\n        element.focus();\n    }\n}\n", "import { parsedata, getJson, ApiResponse, RequestParams } from './utils.js';\n\n// Client-specific interfaces\ninterface ClientFormData extends RequestParams {\n    client_name: string;\n    client_surname: string;\n    client_email: string;\n}\n\ninterface ClientNoteData extends RequestParams {\n    client_id: string;\n    client_note: string;\n}\n\n// Helper to get form field value safely\nfunction getFieldValue(id: string): string {\n    const element = document.getElementById(id) as HTMLInputElement | HTMLSelectElement | null;\n    return element?.value || '';\n}\n\n// Secure navigation helper to prevent Open Redirect vulnerabilities\nfunction secureReload(): void {\n    // Safely reload the current page without using potentially manipulable URLs\n    window.location.reload();\n}\n\n// Helper function to safely create loading/success UI elements to prevent XSS\nfunction createSecureUIElement(type: string = 'h6', className: string = 'text-center', iconClass: string = 'fa fa-spin fa-spinner'): HTMLElement {\n    const element = document.createElement(type);\n    element.className = className;\n    const icon = document.createElement('i');\n    icon.className = iconClass;\n    element.appendChild(icon);\n    return element;\n}\n\n// Helper to set button loading state securely\nfunction setButtonLoading(button: HTMLElement, isLoading: boolean, originalHtml?: string): void {\n    if (isLoading) {\n        button.textContent = '';\n        button.appendChild(createSecureUIElement('h6', 'text-center', 'fa fa-spin fa-spinner'));\n        (button as HTMLButtonElement).disabled = true;\n    } else {\n        if (originalHtml) {\n            button.textContent = '';\n            button.appendChild(createSecureUIElement('h6', 'text-center', 'fa fa-check'));\n        } else {\n            button.textContent = '';\n            button.appendChild(createSecureUIElement('h6', 'text-center', 'fa fa-check'));\n        }\n        (button as HTMLButtonElement).disabled = false;\n    }\n}\n\n// Helper function to safely set button content\nfunction setSecureButtonContent(btn: HTMLElement | null, type: string = 'h6', className: string = 'text-center', iconClass: string = 'fa fa-spin fa-spinner'): void {\n    if (!btn) return;\n    btn.textContent = '';\n    btn.appendChild(createSecureUIElement(type, className, iconClass));\n}\n\n// Client handler class\nexport class ClientHandler {\n    constructor() {\n        this.bindEventListeners();\n    }\n\n    private bindEventListeners(): void {\n        document.addEventListener('click', this.handleClick.bind(this), true);\n        \n        // Instead of global submit listener, target specific forms only\n        this.bindSpecificFormHandlers();\n    }\n\n    private bindSpecificFormHandlers(): void {\n        // Wait for DOM to be ready, then bind to specific forms\n        const bindToForm = (formId: string, handler: (event: SubmitEvent) => void) => {\n            const form = document.getElementById(formId) as HTMLFormElement;\n            if (form) {\n                form.addEventListener('submit', handler.bind(this));\n            } else {\n                // If form not found immediately, try again after DOM loads\n                if (document.readyState === 'loading') {\n                    document.addEventListener('DOMContentLoaded', () => {\n                        const laterForm = document.getElementById(formId) as HTMLFormElement;\n                        if (laterForm) {\n                            laterForm.addEventListener('submit', handler.bind(this));\n                        }\n                    });\n                }\n            }\n        };\n\n        // Bind only to the forms we want to handle\n        bindToForm('QuoteForm', this.handleQuoteFormSubmit);\n        bindToForm('InvForm', this.handleInvoiceFormSubmit);\n    }\n\n    private handleClick(event: Event): void {\n        const target = event.target as HTMLElement;\n\n        // Client create confirm\n        const createBtn = target.closest('#client_create_confirm') as HTMLElement;\n        if (createBtn) {\n            this.handleClientCreateConfirm(createBtn);\n            return;\n        }\n\n        // Save client note\n        const saveNoteBtn = target.closest('#save_client_note_new') as HTMLElement;\n        if (saveNoteBtn) {\n            this.handleSaveClientNote(saveNoteBtn);\n            return;\n        }\n\n        // Delete client note\n        const deleteNoteBtn = target.closest('.client-note-delete-btn') as HTMLElement;\n        if (deleteNoteBtn) {\n            this.handleDeleteClientNote(deleteNoteBtn);\n            return;\n        }\n    }\n\n\n\n    private async handleClientCreateConfirm(createBtn: HTMLElement): Promise<void> {\n        const url = `${location.origin}/invoice/client/create_confirm`;\n        const btn = (document.querySelector('.client_create_confirm') as HTMLElement) || createBtn;\n\n        // Set loading state\n        if (btn) {\n            setButtonLoading(btn, true);\n        }\n\n        try {\n            const payload: ClientFormData = {\n                client_name: getFieldValue('client_name'),\n                client_surname: getFieldValue('client_surname'),\n                client_email: getFieldValue('client_email'),\n            };\n\n            const response = await getJson<ApiResponse>(url, payload);\n            const data = parsedata(response);\n\n            if (data.success === 1) {\n                if (btn) {\n                    setSecureButtonContent(btn, 'h2', 'text-center', 'fa fa-check');\n                }\n                // Secure reload without potentially manipulable URL\n                secureReload();\n            } else {\n                if (btn) {\n                    setButtonLoading(btn, false);\n                }\n                console.warn('create_confirm response', data);\n            }\n        } catch (error) {\n            console.warn(error);\n            if (btn) {\n                setButtonLoading(btn, false);\n            }\n            alert('An error occurred while creating client. See console for details.');\n        }\n    }\n\n    private async handleSaveClientNote(saveNoteBtn: HTMLElement): Promise<void> {\n        const url = `${location.origin}/invoice/client/save_client_note_new`;\n        const loadNotesUrl = `${location.origin}/invoice/client/load_client_notes`;\n        const btn = (document.querySelector('.save_client_note') as HTMLElement) || saveNoteBtn;\n        const currentUrl = new URL(location.href);\n\n        if (btn) {\n            setButtonLoading(btn, true);\n        }\n\n        try {\n            const payload: ClientNoteData = {\n                client_id: getFieldValue('client_id'),\n                client_note: getFieldValue('client_note'),\n            };\n\n            const response = await getJson<ApiResponse>(url, payload);\n            const data = parsedata(response);\n\n            if (data.success === 1) {\n                if (btn) {\n                    setSecureButtonContent(btn, 'h2', 'text-center', 'fa fa-check');\n                }\n\n                // Clear the client note field\n                const noteEl = document.getElementById('client_note') as HTMLInputElement;\n                if (noteEl) noteEl.value = '';\n\n                // Reload notes list (replacing jQuery .load behavior)\n                const notesList = document.getElementById('notes_list');\n                if (notesList) {\n                    const loadUrl = `${loadNotesUrl}?client_id=${encodeURIComponent(payload.client_id)}`;\n                    try {\n                        const notesResponse = await fetch(loadUrl, {\n                            cache: 'no-store',\n                            credentials: 'same-origin',\n                        });\n                        const html = await notesResponse.text();\n                        \n                        // Only update if we get valid partial HTML (not a full page)\n                        if (html && !html.includes('<!DOCTYPE') && !html.includes('<html')) {\n                            // Sanitize HTML content to prevent XSS attacks\n                            notesList.textContent = '';\n                            const parser = new DOMParser();\n                            try {\n                                const doc = parser.parseFromString(html, 'text/html');\n                                // Only append if parsing was successful and content is from trusted source\n                                if (doc && doc.body) {\n                                    const fragment = document.createDocumentFragment();\n                                    while (doc.body.firstChild) {\n                                        fragment.appendChild(doc.body.firstChild);\n                                    }\n                                    notesList.appendChild(fragment);\n                                }\n                            } catch (e) {\n                                console.error('HTML parsing error:', e);\n                                notesList.textContent = 'Error loading notes';\n                            }\n                        } else {\n                            console.warn('Received full page HTML instead of notes fragment, reloading page');\n                            window.location.reload();\n                            return;\n                        }\n                    } catch (loadError) {\n                        console.error('load_client_notes failed', loadError);\n                        // Fallback to page reload on error\n                        window.location.reload();\n                        return;\n                    }\n                }\n\n                // Reset button state without reloading\n                setTimeout(() => {\n                    if (btn) {\n                        setButtonLoading(btn, false, '<h6 class=\"text-center\"><i class=\"fa fa-save\"></i></h6>');\n                    }\n                }, 1000);\n            } else {\n                // Handle validation errors\n                this.clearValidationErrors();\n\n                if (data.validation_errors) {\n                    this.showValidationErrors(data.validation_errors);\n                }\n\n                if (btn) {\n                    setButtonLoading(btn, false);\n                }\n            }\n        } catch (error) {\n            console.warn(error);\n            if (btn) {\n                setButtonLoading(btn, false);\n            }\n            alert('An error occurred while saving client note. See console for details.');\n        }\n    }\n\n    private async handleDeleteClientNote(deleteBtn: HTMLElement): Promise<void> {\n        const noteId = deleteBtn.getAttribute('data-note-id');\n        if (!noteId) {\n            console.error('No note ID found on delete button');\n            return;\n        }\n\n        // Confirm deletion\n        if (!confirm('Are you sure you want to delete this note?')) {\n            return;\n        }\n\n        const url = `${location.origin}/invoice/client/delete_client_note`;\n        const originalHtml = deleteBtn.innerHTML;\n\n        try {\n            // Set loading state\n            deleteBtn.textContent = '';\n            const spinner = document.createElement('i');\n            spinner.className = 'fa fa-spin fa-spinner';\n            deleteBtn.appendChild(spinner);\n            (deleteBtn as HTMLButtonElement).disabled = true;\n\n            // Use the same pattern as other client note operations\n            const response = await fetch(`${url}?note_id=${encodeURIComponent(noteId)}`, {\n                method: 'GET',\n                credentials: 'same-origin',\n            });\n\n            if (response.ok) {\n                const data = await response.json();\n                if (data.success === 1) {\n                    // Remove the note panel from the DOM\n                    const notePanel = deleteBtn.closest('.panel');\n                    if (notePanel) {\n                        notePanel.remove();\n                    }\n                } else {\n                    // Server returned error\n                    deleteBtn.innerHTML = originalHtml;\n                    (deleteBtn as HTMLButtonElement).disabled = false;\n                    alert(data.message || 'Failed to delete note. Please try again.');\n                }\n            } else {\n                // HTTP error\n                const responseText = await response.text();\n                console.error('Delete client note HTTP error:', {\n                    status: response.status,\n                    statusText: response.statusText,\n                    body: responseText.substring(0, 500)\n                });\n                \n                deleteBtn.innerHTML = originalHtml;\n                (deleteBtn as HTMLButtonElement).disabled = false;\n                alert('Failed to delete note. Please try again.');\n            }\n        } catch (error) {\n            console.error('Delete client note error:', error);\n            // Restore button state on error\n            deleteBtn.innerHTML = originalHtml;\n            (deleteBtn as HTMLButtonElement).disabled = false;\n            alert('An error occurred while deleting the note. Please try again.');\n        }\n    }\n\n    private clearValidationErrors(): void {\n        document.querySelectorAll('.control-group').forEach(group => {\n            group.classList.remove('error');\n        });\n    }\n\n    private showValidationErrors(validationErrors: Record<string, string[]>): void {\n        Object.entries(validationErrors).forEach(([key, errors]) => {\n            const element = document.getElementById(key);\n            if (element?.parentElement) {\n                element.parentElement.classList.add('has-error');\n            }\n        });\n    }\n\n    private async handleQuoteFormSubmit(event: SubmitEvent): Promise<void> {\n        event.preventDefault(); // Prevent default form submission\n        \n        const form = event.target as HTMLFormElement;\n        const submitButton = form.querySelector('button[type=\"submit\"]') as HTMLButtonElement;\n        const originalHtml = submitButton?.innerHTML;\n        \n        if (submitButton) {\n            setButtonLoading(submitButton, true);\n        }\n\n        // Show success indicator and close modal immediately\n        if (submitButton) {\n            submitButton.textContent = '';\n            const checkIcon = document.createElement('i');\n            checkIcon.className = 'fa fa-check';\n            submitButton.appendChild(checkIcon);\n        }\n        \n        // Close the modal if it exists\n        const modal = document.getElementById('modal-add-quote') || document.getElementById('modal-add-client');\n        if (modal) {\n            const bootstrapModal = (window as any).bootstrap?.Modal?.getInstance(modal);\n            if (bootstrapModal) {\n                bootstrapModal.hide();\n            }\n        }\n\n        // Wait a moment for the modal to close, then submit the form normally\n        // This allows the server redirect to work properly\n        setTimeout(() => {\n            form.submit();\n        }, 300);\n    }\n\n    private async handleInvoiceFormSubmit(event: SubmitEvent): Promise<void> {\n        event.preventDefault(); // Prevent default form submission\n        \n        const form = event.target as HTMLFormElement;\n        const submitButton = form.querySelector('button[type=\"submit\"]') as HTMLButtonElement;\n        const originalHtml = submitButton?.innerHTML;\n        \n        if (submitButton) {\n            setButtonLoading(submitButton, true);\n        }\n\n        // Show success indicator and close modal immediately\n        if (submitButton) {\n            submitButton.textContent = '';\n            const checkIcon = document.createElement('i');\n            checkIcon.className = 'fa fa-check';\n            submitButton.appendChild(checkIcon);\n        }\n        \n        // Close the modal if it exists\n        const modal = document.getElementById('modal-add-inv') || document.getElementById('modal-add-client');\n        if (modal) {\n            const bootstrapModal = (window as any).bootstrap?.Modal?.getInstance(modal);\n            if (bootstrapModal) {\n                bootstrapModal.hide();\n            }\n        }\n\n        // Wait a moment for the modal to close, then submit the form normally\n        // This allows the server redirect to work properly\n        setTimeout(() => {\n            form.submit();\n        }, 300);\n    }\n}\n", "import { parsedata, getJson, ApiResponse, RequestParams, closestSafe } from './utils.js';\n\n// Invoice-specific interfaces\ninterface RecurringInvoiceData extends RequestParams {\n    keylist: string[];\n    recur_start_date: string;\n    recur_end_date?: string;\n    recur_frequency: string;\n}\n\ninterface DeleteInvoiceItemsData extends RequestParams {\n    item_ids: string[];\n    inv_id: string;\n}\n\ninterface CopyMultipleInvoicesData extends RequestParams {\n    keylist: string[];\n    modal_created_date: string;\n}\n\ninterface CopySingleInvoiceData extends RequestParams {\n    inv_id: string;\n    client_id: string;\n    user_id: string;\n}\n\ninterface AddInvoiceTaxData extends RequestParams {\n    inv_id: string;\n    inv_tax_rate_id: string;\n    include_inv_item_tax: string;\n}\n\ninterface PaymentData extends RequestParams {\n    amount: string;\n    payment_method: string;\n    payment_date: string;\n}\n\ninterface DeleteItemData extends RequestParams {\n    id: string;\n}\n\n// Helper to set button loading state\nfunction setButtonLoading(button: HTMLElement, isLoading: boolean, originalHtml?: string): void {\n    if (isLoading) {\n        button.innerHTML = '<h2 class=\"text-center\"><i class=\"fa fa-spin fa-spinner\"></i></h2>';\n        (button as HTMLButtonElement).disabled = true;\n    } else {\n        button.innerHTML =\n            originalHtml || '<h2 class=\"text-center\"><i class=\"fa fa-check\"></i></h2>';\n        (button as HTMLButtonElement).disabled = false;\n    }\n}\n\n// Helper to get form field value safely\nfunction getFieldValue(id: string): string {\n    const element = document.getElementById(id) as HTMLInputElement | HTMLSelectElement | null;\n    return element?.value || '';\n}\n\n// Invoice handler class\nexport class InvoiceHandler {\n    constructor() {\n        this.bindEventListeners();\n    }\n\n    private bindEventListeners(): void {\n        document.addEventListener('click', this.handleClick.bind(this), true);\n        document.addEventListener('change', this.handleChange.bind(this), true);\n        \n        // Initialize all clients check on page load\n        this.initializeAllClientsCheck();\n    }\n\n    private handleChange(event: Event): void {\n        const target = event.target as HTMLElement;\n\n        // Handle \"select all\" checkbox\n        const selectAll = target.closest('[name=\"checkbox-selection-all\"]') as HTMLInputElement;\n        if (selectAll) {\n            this.handleSelectAllCheckboxes(selectAll.checked);\n            return;\n        }\n\n        // Handle user all clients checkbox\n        const userAllClients = target.closest('#user_all_clients') as HTMLInputElement;\n        if (userAllClients) {\n            this.handleAllClientsCheck();\n            return;\n        }\n    }\n\n    private handleClick(event: Event): void {\n        const target = event.target as HTMLElement;\n\n        // Mark as sent\n        const markAsSent = closestSafe(target, '#btn-mark-as-sent');\n        if (markAsSent) {\n            this.handleMarkAsSent();\n            return;\n        }\n\n        // Mark sent as draft\n        const markDraft = closestSafe(target, '#btn-mark-sent-as-draft');\n        if (markDraft) {\n            this.handleMarkSentAsDraft();\n            return;\n        }\n\n        // Create recurring invoice\n        const createRecurring = closestSafe<HTMLElement>(\n            target,\n            '.create_recurring_confirm_multiple'\n        );\n        if (createRecurring) {\n            this.handleCreateRecurringMultiple(createRecurring);\n            return;\n        }\n\n        // Delete invoice items\n        const deleteItemsConfirm =\n            closestSafe<HTMLElement>(target, '.delete-items-confirm-inv') ||\n            closestSafe<HTMLElement>(target, '#delete-items-confirm-inv');\n        if (deleteItemsConfirm) {\n            this.handleDeleteInvoiceItems(deleteItemsConfirm);\n            return;\n        }\n\n        // Copy multiple invoices\n        const copyMultiple = closestSafe<HTMLElement>(target, '.modal_copy_inv_multiple_confirm');\n        if (copyMultiple) {\n            this.handleCopyMultipleInvoices(copyMultiple);\n            return;\n        }\n\n        // Copy single invoice\n        const invToInv =\n            closestSafe<HTMLElement>(target, '#inv_to_inv_confirm') ||\n            closestSafe<HTMLElement>(target, '.inv_to_inv_confirm');\n        if (invToInv) {\n            this.handleCopySingleInvoice(invToInv);\n            return;\n        }\n\n        // Add invoice tax\n        const invTaxSubmit = closestSafe<HTMLElement>(target, '#inv_tax_submit');\n        if (invTaxSubmit) {\n            event.preventDefault();\n            this.handleAddInvoiceTax(invTaxSubmit);\n            return;\n        }\n\n        // PDF Export with custom fields\n        const pdfWithCustom = closestSafe<HTMLElement>(target, '#inv_to_pdf_confirm_with_custom_fields');\n        if (pdfWithCustom) {\n            this.handlePdfExport(true);\n            return;\n        }\n\n        // PDF Export without custom fields\n        const pdfWithoutCustom = closestSafe<HTMLElement>(target, '#inv_to_pdf_confirm_without_custom_fields');\n        if (pdfWithoutCustom) {\n            this.handlePdfExport(false);\n            return;\n        }\n\n        // Modal PDF with custom fields\n        const modalPdfWithCustom = closestSafe<HTMLElement>(target, '#inv_to_modal_pdf_confirm_with_custom_fields');\n        if (modalPdfWithCustom) {\n            this.handleModalPdfView(true);\n            return;\n        }\n\n        // Modal PDF without custom fields\n        const modalPdfWithoutCustom = closestSafe<HTMLElement>(target, '#inv_to_modal_pdf_confirm_without_custom_fields');\n        if (modalPdfWithoutCustom) {\n            this.handleModalPdfView(false);\n            return;\n        }\n\n        // HTML Export with custom fields\n        const htmlWithCustom = closestSafe<HTMLElement>(target, '#inv_to_html_confirm_with_custom_fields');\n        if (htmlWithCustom) {\n            this.handleHtmlExport(true);\n            return;\n        }\n\n        // HTML Export without custom fields\n        const htmlWithoutCustom = closestSafe<HTMLElement>(target, '#inv_to_html_confirm_without_custom_fields');\n        if (htmlWithoutCustom) {\n            this.handleHtmlExport(false);\n            return;\n        }\n\n        // Payment modal submit\n        const paymentSubmit = closestSafe<HTMLElement>(target, '#btn_modal_payment_submit');\n        if (paymentSubmit) {\n            this.handlePaymentSubmit();\n            return;\n        }\n\n        // Add row modal\n        const addRowModal = closestSafe<HTMLElement>(target, '.btn_add_row_modal');\n        if (addRowModal) {\n            this.handleAddRowModal();\n            return;\n        }\n\n        // Add invoice item row\n        const addItemRow = closestSafe<HTMLElement>(target, '.btn_inv_item_add_row');\n        if (addItemRow) {\n            this.handleAddInvoiceItemRow();\n            return;\n        }\n\n        // Delete single item\n        const deleteItem = closestSafe<HTMLElement>(target, '.btn_delete_item');\n        if (deleteItem) {\n            this.handleDeleteSingleItem(deleteItem);\n            return;\n        }\n    }\n\n    private getCheckedInvoiceIds(): string[] {\n        const selected: string[] = [];\n        const table = document.getElementById('table-invoice');\n\n        if (!table) return selected;\n\n        const checkboxes = table.querySelectorAll(\n            'input[type=\"checkbox\"]:checked'\n        ) as NodeListOf<HTMLInputElement>;\n        checkboxes.forEach(checkbox => {\n            if (checkbox.id) {\n                selected.push(checkbox.id);\n            }\n        });\n\n        return selected;\n    }\n\n    private async handleMarkAsSent(): Promise<void> {\n        const btn = document.getElementById('btn-mark-as-sent');\n        const originalHtml = btn?.innerHTML;\n\n        if (btn) {\n            setButtonLoading(btn, true);\n        }\n\n        try {\n            const selected = this.getCheckedInvoiceIds();\n            const url = `${location.origin}/invoice/inv/mark_as_sent`;\n\n            const response = await getJson<ApiResponse>(url, { keylist: selected });\n            const data = parsedata(response);\n\n            if (data.success === 1) {\n                if (btn) btn.innerHTML = '<h2 class=\"text-center\"><i class=\"fa fa-check\"></i></h2>';\n                window.location.reload();\n            } else {\n                if (btn) btn.innerHTML = '<h2 class=\"text-center\"><i class=\"fa fa-times\"></i></h2>';\n                window.location.reload();\n            }\n        } catch (error) {\n            console.error('mark_as_sent error', error);\n            if (btn && originalHtml) {\n                setButtonLoading(btn, false, originalHtml);\n            }\n            alert('An error occurred. See console for details.');\n        }\n    }\n\n    private async handleMarkSentAsDraft(): Promise<void> {\n        const btn = document.getElementById('btn-mark-sent-as-draft');\n        const originalHtml = btn?.innerHTML;\n\n        if (btn) {\n            setButtonLoading(btn, true);\n        }\n\n        try {\n            const selected = this.getCheckedInvoiceIds();\n            const url = `${location.origin}/invoice/inv/mark_sent_as_draft`;\n\n            const response = await getJson<ApiResponse>(url, { keylist: selected });\n            const data = parsedata(response);\n\n            if (data.success === 1) {\n                if (btn) btn.innerHTML = '<h2 class=\"text-center\"><i class=\"fa fa-check\"></i></h2>';\n                window.location.reload();\n            } else {\n                if (btn) btn.innerHTML = '<h2 class=\"text-center\"><i class=\"fa fa-times\"></i></h2>';\n                window.location.reload();\n            }\n        } catch (error) {\n            console.error('mark_sent_as_draft error', error);\n            if (btn && originalHtml) {\n                setButtonLoading(btn, false, originalHtml);\n            }\n            alert('An error occurred. See console for details.');\n        }\n    }\n\n    private async handleCreateRecurringMultiple(createRecurring: HTMLElement): Promise<void> {\n        const btn =\n            (document.querySelector('.create_recurring_confirm_multiple') as HTMLElement) ||\n            createRecurring;\n        const originalHtml = btn?.innerHTML;\n\n        if (btn) {\n            btn.innerHTML = '<h6 class=\"text-center\"><i class=\"fa fa-spin fa-spinner\"></i></h6>';\n            (btn as HTMLButtonElement).disabled = true;\n        }\n\n        try {\n            // Get selected invoice checkboxes\n            const selected = this.getCheckedInvoiceIds();\n\n            if (selected.length === 0) {\n                alert('Please select invoices to create recurring invoices.');\n                if (btn && originalHtml) {\n                    btn.innerHTML = originalHtml;\n                    (btn as HTMLButtonElement).disabled = false;\n                }\n                return;\n            }\n\n            const payload: RecurringInvoiceData = {\n                keylist: selected,\n                recur_frequency: getFieldValue('recur_frequency'),\n                recur_start_date: getFieldValue('recur_start_date'),\n                recur_end_date: getFieldValue('recur_end_date'),\n            };\n\n            // Validate required fields\n            if (!payload.recur_frequency || !payload.recur_start_date) {\n                alert('Please select frequency and start date.');\n                if (btn && originalHtml) {\n                    btn.innerHTML = originalHtml;\n                    (btn as HTMLButtonElement).disabled = false;\n                }\n                return;\n            }\n\n            const url = `${location.origin}/invoice/invrecurring/multiple`;\n            const response = await getJson<ApiResponse>(url, payload);\n            const data = parsedata(response);\n\n            if (data.success === 1) {\n                if (btn) btn.innerHTML = '<h2 class=\"text-center\"><i class=\"fa fa-check\"></i></h2>';\n\n                // Close modal if using Bootstrap\n                this.closeModal('create-recurring-multiple');\n\n                setTimeout(() => {\n                    window.location.reload();\n                }, 500);\n            } else {\n                if (btn) btn.innerHTML = '<h2 class=\"text-center\"><i class=\"fa fa-times\"></i></h2>';\n                // Use the server's error message if available, otherwise fall back to generic message\n                const errorMessage = data.message || 'Failed to create recurring invoices. Please try again.';\n                alert(errorMessage);\n                if (btn && originalHtml) {\n                    btn.innerHTML = originalHtml;\n                    (btn as HTMLButtonElement).disabled = false;\n                }\n            }\n        } catch (error) {\n            console.error('invrecurring/multiple error', error);\n            if (btn && originalHtml) {\n                btn.innerHTML = originalHtml;\n                (btn as HTMLButtonElement).disabled = false;\n            }\n            alert('An error occurred while creating recurring invoices. See console for details.');\n        }\n    }\n\n    private async handleCopyMultipleInvoices(copyMultiple: HTMLElement): Promise<void> {\n        const btn =\n            (document.querySelector('.modal_copy_inv_multiple_confirm') as HTMLElement) ||\n            copyMultiple;\n        const originalHtml = btn?.innerHTML;\n\n        if (btn) {\n            btn.innerHTML = '<h2 class=\"text-center\"><i class=\"fa fa-spin fa-spinner\"></i></h2>';\n            (btn as HTMLButtonElement).disabled = true;\n        }\n\n        try {\n            const modalCreatedDate = getFieldValue('modal_created_date');\n            const selected = this.getCheckedInvoiceIds();\n\n            if (selected.length === 0) {\n                alert('Please select invoices to copy.');\n                if (btn && originalHtml) {\n                    btn.innerHTML = originalHtml;\n                    (btn as HTMLButtonElement).disabled = false;\n                }\n                return;\n            }\n\n            const payload: CopyMultipleInvoicesData = {\n                keylist: selected,\n                modal_created_date: modalCreatedDate,\n            };\n\n            const url = `${location.origin}/invoice/inv/multiplecopy`;\n            const response = await getJson<ApiResponse>(url, payload);\n            const data = parsedata(response);\n\n            if (data.success === 1) {\n                if (btn) btn.innerHTML = '<h2 class=\"text-center\"><i class=\"fa fa-check\"></i></h2>';\n                window.location.reload();\n            } else {\n                if (btn) btn.innerHTML = '<h2 class=\"text-center\"><i class=\"fa fa-times\"></i></h2>';\n                window.location.reload();\n            }\n        } catch (error) {\n            console.error('multiplecopy error', error);\n            if (btn && originalHtml) {\n                btn.innerHTML = originalHtml;\n                (btn as HTMLButtonElement).disabled = false;\n            }\n            alert('An error occurred. See console for details.');\n        }\n    }\n\n    private async handleAddInvoiceTax(invTaxSubmit: HTMLElement): Promise<void> {\n        const btn = document.getElementById('inv_tax_submit') as HTMLButtonElement;\n        const originalHtml = btn?.innerHTML;\n\n        if (btn) {\n            btn.innerHTML = '<i class=\"fa fa-spin fa-spinner\"></i>';\n            btn.disabled = true;\n        }\n\n        try {\n            // Get invoice ID from current URL\n            const currentUrl = new URL(location.href);\n            const inv_id = currentUrl.pathname.split('/').at(-1) || '';\n\n            const payload: AddInvoiceTaxData = {\n                inv_id: inv_id,\n                inv_tax_rate_id: getFieldValue('inv_tax_rate_id'),\n                include_inv_item_tax: getFieldValue('include_inv_item_tax'),\n            };\n\n            const url = `${location.origin}/invoice/inv/save_inv_tax_rate`;\n            const response = await getJson<ApiResponse>(url, payload);\n            const data = parsedata(response);\n\n            if (data.success === 1) {\n                if (btn) btn.innerHTML = '<i class=\"fa fa-check\"></i>';\n\n                // Close modal and reload page\n                this.closeModal('add-inv-tax');\n\n                setTimeout(() => {\n                    window.location.reload();\n                }, 500);\n            } else {\n                if (btn) btn.innerHTML = '<i class=\"fa fa-times\"></i>';\n                alert('Failed to add invoice tax. Please try again.');\n                if (btn && originalHtml) {\n                    btn.innerHTML = originalHtml;\n                    btn.disabled = false;\n                }\n            }\n        } catch (error) {\n            console.error('invoice tax add error', error);\n            if (btn && originalHtml) {\n                btn.innerHTML = originalHtml;\n                btn.disabled = false;\n            }\n            alert('An error occurred while adding invoice tax. See console for details.');\n        }\n    }\n\n    private async handleCopySingleInvoice(invToInv: HTMLElement): Promise<void> {\n        const btn =\n            (document.querySelector('.inv_to_inv_confirm') as HTMLElement) || invToInv;\n        const originalHtml = btn?.innerHTML;\n\n        if (btn) {\n            btn.innerHTML = '<h6 class=\"text-center\"><i class=\"fa fa-spin fa-spinner\"></i></h6>';\n            (btn as HTMLButtonElement).disabled = true;\n        }\n\n        try {\n            const absoluteUrl = new URL(location.href);\n            const inv_id = absoluteUrl.pathname.split('/').at(-1) || '';\n\n            const payload: CopySingleInvoiceData = {\n                inv_id: inv_id,\n                client_id: getFieldValue('create_inv_client_id'),\n                user_id: getFieldValue('user_id'),\n            };\n\n            const url = `${location.origin}/invoice/inv/inv_to_inv_confirm`;\n            const response = await getJson<ApiResponse>(url, payload);\n            const data = parsedata(response);\n\n            if (data.success === 1) {\n                if (btn) btn.innerHTML = '<h2 class=\"text-center\"><i class=\"fa fa-check\"></i></h2>';\n\n                // Redirect to the newly created invoice\n                if (data.new_invoice_id) {\n                    window.location.href = `${location.origin}/invoice/inv/view/${data.new_invoice_id}`;\n                } else {\n                    // Fallback to reload current page if new_invoice_id not provided\n                    window.location.reload();\n                }\n            } else {\n                if (btn) btn.innerHTML = '<h2 class=\"text-center\"><i class=\"fa fa-times\"></i></h2>';\n                window.location.reload();\n            }\n        } catch (error) {\n            console.error('inv_to_inv_confirm error', error);\n            if (btn && originalHtml) {\n                btn.innerHTML = originalHtml;\n                (btn as HTMLButtonElement).disabled = false;\n            }\n            alert('An error occurred. See console for details.');\n        }\n    }\n\n    private async handleDeleteInvoiceItems(deleteItemsConfirm: HTMLElement): Promise<void> {\n        const btn =\n            (document.querySelector('.delete-items-confirm-inv') as HTMLElement) ||\n            deleteItemsConfirm;\n        const originalHtml = btn?.innerHTML;\n\n        if (btn) {\n            btn.innerHTML = '<i class=\"fa fa-spin fa-spinner\"></i>';\n            (btn as HTMLButtonElement).disabled = true;\n        }\n\n        try {\n            // Get selected item checkboxes from the modal table\n            const selected: string[] = [];\n            \n            // Use the same selector pattern as quote for consistency\n            const checkboxes = document.querySelectorAll(\n                \"input[name='item_ids[]']:checked\"\n            ) as NodeListOf<HTMLInputElement>;\n            \n            checkboxes.forEach(checkbox => {\n                if (checkbox.value) {\n                    selected.push(checkbox.value);\n                }\n            });\n\n            // Get invoice ID from current URL\n            const currentUrl = new URL(location.href);\n            const inv_id = currentUrl.pathname.split('/').at(-1) || '';\n\n            if (selected.length === 0) {\n                alert('Please select items to delete.');\n                if (btn && originalHtml) {\n                    btn.innerHTML = originalHtml;\n                    (btn as HTMLButtonElement).disabled = false;\n                }\n                return;\n            }\n\n            const payload: DeleteInvoiceItemsData = {\n                item_ids: selected,\n                inv_id: inv_id,\n            };\n\n            const url = `${location.origin}/invoice/invitem/multiple`;\n            const response = await getJson<ApiResponse>(url, payload);\n            const data = parsedata(response);\n\n            if (data.success === 1) {\n                if (btn) btn.innerHTML = '<i class=\"fa fa-check\"></i>';\n\n                // Close modal and reload page\n                this.closeModal('delete-items');\n\n                setTimeout(() => {\n                    window.location.reload();\n                }, 500);\n            } else {\n                if (btn) btn.innerHTML = '<i class=\"fa fa-times\"></i>';\n                alert('Failed to delete items. Please try again.');\n                if (btn && originalHtml) {\n                    btn.innerHTML = originalHtml;\n                    (btn as HTMLButtonElement).disabled = false;\n                }\n            }\n        } catch (error) {\n            console.error('delete items error', error);\n            if (btn && originalHtml) {\n                btn.innerHTML = originalHtml;\n                (btn as HTMLButtonElement).disabled = false;\n            }\n            alert('An error occurred while deleting items. See console for details.');\n        }\n    }\n\n    private handlePdfExport(withCustomFields: boolean): void {\n        const endpoint = withCustomFields ? '1' : '0';\n        const url = `${location.origin}/invoice/inv/pdf/${endpoint}`;\n        window.open(url, '_blank');\n    }\n\n    private handleModalPdfView(withCustomFields: boolean): void {\n        const endpoint = withCustomFields ? '1' : '0';\n        const url = `${location.origin}/invoice/inv/pdf/${endpoint}`;\n        \n        // Set the iframe src to the URL of the PDF\n        const iframe = document.getElementById('modal-view-inv-pdf') as HTMLIFrameElement;\n        if (iframe) {\n            iframe.src = url;\n        }\n\n        // Open the modal using Bootstrap\n        try {\n            if (typeof (window as any).bootstrap?.Modal !== 'undefined') {\n                const modalEl = document.getElementById('modal-layout-modal-pdf-inv');\n                if (modalEl) {\n                    const modal = new (window as any).bootstrap.Modal(modalEl);\n                    modal.show();\n                }\n            }\n        } catch (e) {\n            console.warn('Failed to open PDF modal:', e);\n        }\n    }\n\n    private handleHtmlExport(withCustomFields: boolean): void {\n        const endpoint = withCustomFields ? '1' : '0';\n        const url = `${location.origin}/invoice/inv/html/${endpoint}`;\n        window.open(url, '_blank');\n    }\n\n    private async handlePaymentSubmit(): Promise<void> {\n        const url = `${location.origin}/invoice/payment/add_with_ajax`;\n        const btn = document.getElementById('btn_modal_payment_submit') as HTMLButtonElement;\n        const originalHtml = btn?.innerHTML;\n\n        if (btn) {\n            btn.innerHTML = '<i class=\"fa fa-spin fa-spinner\"></i>';\n            btn.disabled = true;\n        }\n\n        try {\n            // Get payment form data - adjust field names as needed\n            const payload = {\n                // Add payment form fields here based on the actual form structure\n                // This is a placeholder - you'll need to adjust based on the actual payment form\n                amount: getFieldValue('payment_amount'),\n                payment_method: getFieldValue('payment_method'),\n                payment_date: getFieldValue('payment_date'),\n                // Add other payment fields as needed\n            };\n\n            const response = await getJson<ApiResponse>(url, payload);\n            const data = parsedata(response);\n\n            if (data.success === 1) {\n                if (btn) btn.innerHTML = '<i class=\"fa fa-check\"></i>';\n                // Close payment modal and reload\n                this.closeModal('payment-modal'); // Adjust modal ID as needed\n                setTimeout(() => {\n                    window.location.reload();\n                }, 500);\n            } else {\n                if (btn && originalHtml) {\n                    btn.innerHTML = originalHtml;\n                    btn.disabled = false;\n                }\n                alert('Failed to process payment. Please try again.');\n            }\n        } catch (error) {\n            console.error('Payment submission error:', error);\n            if (btn && originalHtml) {\n                btn.innerHTML = originalHtml;\n                btn.disabled = false;\n            }\n            alert('An error occurred while processing payment. See console for details.');\n        }\n    }\n\n    private handleAddRowModal(): void {\n        const currentUrl = new URL(location.href);\n        const inv_id = currentUrl.pathname.split('/').at(-1) || '';\n        const url = `${location.origin}/invoice/invitem/add/${inv_id}`;\n        \n        // Load content into modal placeholder\n        const modalPlaceholder = document.getElementById('modal-placeholder-invitem');\n        if (modalPlaceholder) {\n            // Use fetch to load the content\n            fetch(url, { credentials: 'same-origin' })\n                .then(response => response.text())\n                .then(html => {\n                    // Sanitize HTML content to prevent XSS attacks\n                    modalPlaceholder.textContent = '';\n                    const tempDiv = document.createElement('div');\n                    tempDiv.textContent = html;\n                    // For trusted server content, use createDocumentFragment for better security\n                    const fragment = document.createDocumentFragment();\n                    const parser = new DOMParser();\n                    try {\n                        const doc = parser.parseFromString(html, 'text/html');\n                        // Only append if parsing was successful and content is from trusted source\n                        if (doc && doc.body) {\n                            while (doc.body.firstChild) {\n                                fragment.appendChild(doc.body.firstChild);\n                            }\n                            modalPlaceholder.appendChild(fragment);\n                        }\n                    } catch (e) {\n                        console.error('HTML parsing error:', e);\n                        modalPlaceholder.textContent = 'Error loading content';\n                    }\n                })\n                .catch(error => {\n                    console.error('Failed to load modal content:', error);\n                    modalPlaceholder.textContent = 'Failed to load item form. Please try again.';\n                });\n        }\n    }\n\n    private handleAddInvoiceItemRow(): void {\n        // Clone the new row template and append to item table\n        const newRow = document.getElementById('new_row');\n        const itemTable = document.getElementById('item_table');\n        \n        if (newRow && itemTable) {\n            const clonedRow = newRow.cloneNode(true) as HTMLElement;\n            clonedRow.removeAttribute('id');\n            clonedRow.classList.add('item');\n            clonedRow.style.display = 'block'; // Show the cloned row\n            itemTable.appendChild(clonedRow);\n        }\n    }\n\n    private async handleDeleteSingleItem(deleteItem: HTMLElement): Promise<void> {\n        const itemId = deleteItem.getAttribute('data-id');\n        \n        if (!itemId) {\n            // If no ID, just remove the DOM element (unsaved item)\n            const itemRow = deleteItem.closest('.item');\n            if (itemRow) {\n                itemRow.remove();\n            }\n            return;\n        }\n\n        try {\n            const url = `${location.origin}/invoice/inv/delete_item/${itemId}`;\n            const response = await getJson<ApiResponse>(url, { id: itemId });\n            const data = parsedata(response);\n\n            if (data.success === 1) {\n                // Remove the item row from DOM\n                const itemRow = deleteItem.closest('.item');\n                if (itemRow) {\n                    itemRow.remove();\n                }\n                alert('Deleted');\n                // Reload to update totals\n                window.location.reload();\n            } else {\n                alert('Failed to delete item. Please try again.');\n            }\n        } catch (error) {\n            console.error('Delete item error:', error);\n            alert('An error occurred while deleting the item. Please try again.');\n        }\n    }\n\n    private handleSelectAllCheckboxes(checked: boolean): void {\n        const checkboxes = document.querySelectorAll('input[type=\"checkbox\"]') as NodeListOf<HTMLInputElement>;\n        checkboxes.forEach(checkbox => {\n            checkbox.checked = checked;\n        });\n    }\n\n    private initializeAllClientsCheck(): void {\n        this.handleAllClientsCheck();\n    }\n\n    private handleAllClientsCheck(): void {\n        const userAllClientsCheckbox = document.getElementById('user_all_clients') as HTMLInputElement;\n        const listClientElement = document.getElementById('list_client');\n\n        if (userAllClientsCheckbox && listClientElement) {\n            if (userAllClientsCheckbox.checked) {\n                listClientElement.style.display = 'none';\n            } else {\n                listClientElement.style.display = 'block';\n            }\n        }\n    }\n\n    private closeModal(modalId: string): void {\n        try {\n            if (typeof (window as any).bootstrap?.Modal !== 'undefined') {\n                const modalEl = document.getElementById(modalId);\n                if (modalEl) {\n                    const modalInstance = (window as any).bootstrap.Modal.getInstance(modalEl);\n                    if (modalInstance) {\n                        modalInstance.hide();\n                    }\n                }\n            }\n        } catch (e) {\n            console.warn('Failed to close modal:', e);\n        }\n    }\n}\n", "import { parsedata, getJson, ApiResponse, RequestParams } from './utils.js';\n\n// Product-specific interfaces\ninterface ProductSearchData extends RequestParams {\n    product_sku: string;\n}\n\ninterface ProductSearchResponse extends ApiResponse {\n    success: 0 | 1;\n    message?: string;\n}\n\ninterface Product {\n    id: string;\n    product_name: string;\n    product_description: string;\n    product_price: string;\n    tax_rate_id: string;\n    unit_id: string;\n}\n\ninterface ProductSelectionResponse {\n    [key: string]: Product;\n}\n\ninterface Task {\n    id: string;\n    name: string;\n    description: string;\n    price: string;\n    tax_rate_id: string;\n}\n\ninterface TaskSelectionResponse {\n    [key: string]: Task;\n}\n\n// Helper to set button loading state\nfunction setButtonLoading(buttons: NodeListOf<HTMLElement>, isLoading: boolean): void {\n    buttons.forEach(button => {\n        if (isLoading) {\n            button.innerHTML = '<h6 class=\"text-center\"><i class=\"fa fa-spin fa-spinner\"></i></h6>';\n        } else {\n            button.innerHTML = '<h6 class=\"text-center\"><i class=\"fa fa-check\"></i></h6>';\n        }\n    });\n}\n\nfunction setButtonError(buttons: NodeListOf<HTMLElement>): void {\n    buttons.forEach(button => {\n        button.innerHTML = '<h6 class=\"text-center\"><i class=\"fa fa-error\"></i></h6>';\n    });\n}\n\n// Product handler class\nexport class ProductHandler {\n    constructor() {\n        this.bindEventListeners();\n        this.exposeGlobalFunctions();\n        this.initializeComponents();\n    }\n\n    private bindEventListeners(): void {\n        document.addEventListener('click', this.handleClick.bind(this), true);\n    }\n\n    private handleClick(event: Event): void {\n        const target = event.target as HTMLElement;\n\n        if (target.closest('#product_filters_submit')) {\n            this.submitProductFilters(event);\n            return;\n        }\n\n        if (target.closest('.select-items-confirm-quote')) {\n            event.preventDefault();\n            this.handleQuoteConfirm();\n            return;\n        }\n\n        if (target.closest('.select-items-confirm-inv')) {\n            event.preventDefault();\n            this.handleInvoiceConfirm();\n            return;\n        }\n\n        // Handle product row clicks (for checkbox toggling)\n        const productRow = target.closest('.product');\n        if (productRow && target.tagName !== 'INPUT') {\n            const checkbox = productRow.querySelector('input[type=\"checkbox\"]') as HTMLInputElement;\n            if (checkbox) {\n                checkbox.click();\n            }\n            return;\n        }\n\n        // Handle checkbox state changes\n        if (target.matches(\"input[name='product_ids[]']\")) {\n            this.updateButtonStates();\n        }\n    }\n\n    private initializeComponents(): void {\n        // Initialize TomSelect (replaces jQuery select2)\n        if (typeof (window as any).TomSelect !== 'undefined') {\n            document.querySelectorAll('.simple-select').forEach((el: Element) => {\n                if (!(el as any)._tomselect) {\n                    new (window as any).TomSelect(el, {});\n                    (el as any)._tomselect = true;\n                }\n            });\n        }\n        this.updateButtonStates();\n    }\n\n    private updateButtonStates(): void {\n        const checkedInputs = document.querySelectorAll(\"input[name='product_ids[]']:checked\");\n        const hasChecked = checkedInputs.length > 0;\n        \n        const quoteBtn = document.querySelector('.select-items-confirm-quote') as HTMLButtonElement;\n        const invBtn = document.querySelector('.select-items-confirm-inv') as HTMLButtonElement;\n        \n        if (quoteBtn) {\n            quoteBtn.disabled = !hasChecked;\n        }\n        if (invBtn) {\n            invBtn.disabled = !hasChecked;\n        }\n    }\n\n    /**\n     * Filter table rows by SKU (mirrors original tableFunction)\n     */\n    public filterTableBySku(): void {\n        const inputEl = document.getElementById('filter_product_sku') as HTMLInputElement;\n        if (!inputEl) return;\n\n        const input = inputEl.value || '';\n        const filter = input.toUpperCase();\n        const table = document.getElementById('table-product') as HTMLTableElement;\n\n        if (!table) return;\n\n        const rows = table.getElementsByTagName('tr');\n\n        // Loop through all table rows, and hide those who don't match the search query\n        for (let i = 0; i < rows.length; i++) {\n            // product_sku is 3rd column or index 2\n            const cell = rows[i].getElementsByTagName('td')[2] as HTMLTableCellElement;\n\n            if (cell) {\n                const textValue = cell.textContent || cell.innerText || '';\n\n                if (textValue.toUpperCase().indexOf(filter) > -1) {\n                    (rows[i] as HTMLTableRowElement).style.display = '';\n                } else {\n                    (rows[i] as HTMLTableRowElement).style.display = 'none';\n                }\n            }\n        }\n    }\n\n    /**\n     * Perform the product search request and update UI\n     */\n    private async submitProductFilters(event: Event): Promise<void> {\n        if (event?.preventDefault) {\n            event.preventDefault();\n        }\n\n        const url = `${location.origin}/invoice/product/search`;\n        const buttons = document.querySelectorAll(\n            '.product_filters_submit'\n        ) as NodeListOf<HTMLElement>;\n\n        // Show spinner on all matching buttons\n        setButtonLoading(buttons, true);\n\n        try {\n            const productSkuInput = document.getElementById(\n                'filter_product_sku'\n            ) as HTMLInputElement;\n            const productSku = productSkuInput?.value || '';\n\n            const payload: ProductSearchData = {\n                product_sku: productSku,\n            };\n\n            const response = await getJson<ProductSearchResponse>(url, payload);\n            const data = parsedata(response);\n\n            if (data.success === 1) {\n                this.filterTableBySku();\n                this.hideSummaryBar();\n                setButtonLoading(buttons, false);\n            } else {\n                setButtonError(buttons);\n                if (data.message) {\n                    alert(data.message);\n                }\n            }\n        } catch (error) {\n            console.error('product search failed', error);\n            setButtonError(buttons);\n            alert('An error occurred while searching products. See console for details.');\n        }\n    }\n\n    /**\n     * Hide the summary bar after filtering\n     */\n    private hideSummaryBar(): void {\n        const summary = document.querySelector('.mt-3.me-3.summary.text-end') as HTMLElement;\n        if (summary) {\n            summary.style.visibility = 'hidden';\n        }\n    }\n\n    private async handleQuoteConfirm(): Promise<void> {\n        const absoluteUrl = new URL(window.location.href);\n        const btn = document.querySelector('.select-items-confirm-quote') as HTMLElement;\n        this.setSecureButtonContent(btn, 'h2', 'text-center', 'fa fa-spin fa-spinner');\n        \n        const productIds: number[] = [];\n        const quoteId = (absoluteUrl.pathname.split('/').at(-1) || '').replace(/[^0-9]/g, '');\n        \n        document.querySelectorAll(\"input[name='product_ids[]']:checked\").forEach((input: Element) => {\n            const value = parseInt((input as HTMLInputElement).value);\n            if (!isNaN(value)) {\n                productIds.push(value);\n            }\n        });\n\n        // ES2024: Sort product IDs without mutation for consistent URL ordering\n        const sortedProductIds = productIds.toSorted((a, b) => a - b);\n        console.log('Processing products in sorted order:', sortedProductIds);\n\n        let url = `/invoice/product/selection_quote?quote_id=${quoteId}`;\n        sortedProductIds.forEach(id => {\n            url += `&product_ids[]=${id}`;\n        });\n        \n        try {\n            const response = await fetch(url, {\n                method: 'GET',\n                headers: {\n                    'Content-Type': 'application/json; charset=utf-8',\n                    'X-Requested-With': 'XMLHttpRequest'\n                }\n            });\n            \n            const data = await response.json() as ProductSelectionResponse;\n            this.processProducts(data);\n            this.setSecureButtonContent(btn, 'h2', 'text-center', 'fa fa-check');\n            window.location.reload();\n        } catch (error) {\n            console.error('Error:', error);\n            this.setSecureButtonContent(btn, 'h2', 'text-center', 'fa fa-times');\n        }\n    }\n\n    private async handleInvoiceConfirm(): Promise<void> {\n        const absoluteUrl = new URL(window.location.href);\n        const btn = document.querySelector('.select-items-confirm-inv') as HTMLElement;\n        this.setSecureButtonContent(btn, 'h2', 'text-center', 'fa fa-spin fa-spinner');\n        \n        const productIds: number[] = [];\n        const invId = absoluteUrl.pathname.split('/').at(-1) || '';\n        \n        document.querySelectorAll(\"input[name='product_ids[]']:checked\").forEach((input: Element) => {\n            const value = parseInt((input as HTMLInputElement).value);\n            if (!isNaN(value)) {\n                productIds.push(value);\n            }\n        });\n\n        // ES2024: Sort product IDs for consistent processing order\n        const sortedProductIds = productIds.toSorted((a, b) => a - b);\n\n        let url = `/invoice/product/selection_inv?inv_id=${invId}`;\n        sortedProductIds.forEach(id => {\n            url += `&product_ids[]=${id}`;\n        });\n        \n        try {\n            const response = await fetch(url, {\n                method: 'GET',\n                headers: {\n                    'Content-Type': 'application/json; charset=utf-8',\n                    'X-Requested-With': 'XMLHttpRequest'\n                }\n            });\n            \n            const data = await response.json() as ProductSelectionResponse;\n            this.processProducts(data);\n            this.setSecureButtonContent(btn, 'h2', 'text-center', 'fa fa-check');\n            window.location.reload();\n        } catch (error) {\n            console.error('Error:', error);\n            this.setSecureButtonContent(btn, 'h2', 'text-center', 'fa fa-times');\n        }\n    }\n\n    private processProducts(products: ProductSelectionResponse): void {\n        console.log('Processing', Object.keys(products).length, 'products');\n        \n        // ES2024: Group products by tax rate for analytics\n        const productsByTaxRate = Object.groupBy(\n            Object.entries(products).map(([key, product]) => ({ key, ...product })),\n            (product) => product.tax_rate_id || 'default'\n        );\n        console.log('Products grouped by tax rate:', Object.keys(productsByTaxRate));\n        \n        // Process each product - PHP backend handles row creation\n        for (const key in products) {\n            console.log('Processing product key:', key);\n            // Sanitize remote data before use\n            const product = products[key];\n            if (!product || typeof product !== 'object') continue;\n            \n            const currentTaxRateId = product.tax_rate_id;\n            let productDefaultTaxRateId: string;\n            \n            if (!currentTaxRateId) {\n                const defaultTaxRateEl = document.getElementById('default_item_tax_rate') as HTMLInputElement;\n                productDefaultTaxRateId = defaultTaxRateEl ? defaultTaxRateEl.getAttribute('value') || '' : '';\n            } else {\n                productDefaultTaxRateId = currentTaxRateId;\n            }\n            \n            // Get the last tbody element (matches original JavaScript exactly)\n            const lastItemRow = document.querySelector('#item_table tbody:last-of-type') as HTMLElement;\n            \n            if (lastItemRow) {\n                const itemName = lastItemRow.querySelector('input[name=item_name]') as HTMLInputElement;\n                if (itemName) itemName.value = product.product_name;\n                \n                const itemDesc = lastItemRow.querySelector('textarea[name=item_description]') as HTMLTextAreaElement;\n                if (itemDesc) itemDesc.value = product.product_description;\n                \n                const itemPrice = lastItemRow.querySelector('input[name=item_price]') as HTMLInputElement;\n                if (itemPrice) itemPrice.value = product.product_price;\n                \n                const itemQty = lastItemRow.querySelector('input[name=item_quantity]') as HTMLInputElement;\n                if (itemQty) itemQty.value = '1';\n                \n                const itemTaxRate = lastItemRow.querySelector('select[name=item_tax_rate_id]') as HTMLSelectElement;\n                if (itemTaxRate) itemTaxRate.value = productDefaultTaxRateId;\n                \n                const itemProductId = lastItemRow.querySelector('input[name=item_product_id]') as HTMLInputElement;\n                if (itemProductId) itemProductId.value = product.id;\n                \n                const itemUnitId = lastItemRow.querySelector('select[name=item_product_unit_id]') as HTMLSelectElement;\n                if (itemUnitId) itemUnitId.value = product.unit_id;\n            }\n        }\n    }\n\n    private setSecureButtonContent(button: HTMLElement, tagName: string, className: string, iconClass: string): void {\n        if (!button) return;\n        \n        // Clear existing content safely\n        while (button.firstChild) {\n            button.removeChild(button.firstChild);\n        }\n        \n        // Create elements securely\n        const element = document.createElement(tagName);\n        if (className) element.className = className;\n        \n        const icon = document.createElement('i');\n        if (iconClass) icon.className = iconClass;\n        \n        element.appendChild(icon);\n        button.appendChild(element);\n    }\n\n    /**\n     * Expose global functions for compatibility with existing code\n     */\n    private exposeGlobalFunctions(): void {\n        // Export tableFunction to global scope in case other scripts call it\n        (window as any).productTableFilter = this.filterTableBySku.bind(this);\n    }\n}\n", "import { parsedata } from './utils.js';\n\n// Task-specific interfaces\ninterface Task {\n    id: string;\n    name: string;\n    description: string;\n    price: string;\n    tax_rate_id: string;\n}\n\ninterface TaskSelectionResponse {\n    [key: string]: Task;\n}\n\n// Task handler class\nexport class TaskHandler {\n    constructor() {\n        this.bindEventListeners();\n        this.initializeComponents();\n    }\n\n    private bindEventListeners(): void {\n        // Delegated event handling for clicks\n        document.addEventListener('click', this.handleClick.bind(this), true);\n        \n        // Delegated change handling for checkboxes\n        document.addEventListener('change', this.handleChange.bind(this), true);\n        \n        // Handle Enter key for search\n        document.addEventListener('keydown', this.handleKeydown.bind(this), true);\n        \n        // Handle modal events to reinitialize components\n        document.addEventListener('shown.bs.modal', this.handleModalShown.bind(this), true);\n    }\n\n    private handleClick(event: Event): void {\n        const target = event.target as HTMLElement;\n\n        // Row toggle\n        const taskRow = target.closest('#tasks_table tr, .task, .task-row');\n        if (taskRow) {\n            this.rowClickToggle(event);\n            return;\n        }\n\n        // Confirm select tasks\n        const confirmTask = target.closest('.select-items-confirm-task, .select-items-confirm-task-inv, .select-items-confirm-task-quote');\n        if (confirmTask) {\n            this.handleSelectItemsConfirmTask(confirmTask as HTMLElement);\n            return;\n        }\n\n        // Reset / load actions\n        const resetButton = target.closest('#task-reset-button-inv');\n        if (resetButton) {\n            this.handleTaskReset();\n            return;\n        }\n    }\n\n    private handleChange(event: Event): void {\n        const target = event.target as HTMLElement;\n        \n        if (target.matches(\"input[name='task_ids[]']\")) {\n            const container = target.closest('#tasks_table') || document;\n            this.updateSelectTaskButtonState(container);\n        }\n    }\n\n    private handleKeydown(event: KeyboardEvent): void {\n        if (event.key === 'Enter') {\n            const active = document.activeElement as HTMLElement;\n            if (active && active.id === 'filter_task_inv') {\n                const btn = document.getElementById('filter-button-inv');\n                if (btn) {\n                    btn.click();\n                    event.preventDefault();\n                }\n            }\n        }\n    }\n\n    private initializeComponents(): void {\n        this.hideSelectedTasks();\n        this.updateSelectTaskButtonState(document);\n    }\n\n    /**\n     * Handle modal shown event to reinitialize components\n     */\n    private handleModalShown(event: Event): void {\n        const target = event.target as HTMLElement;\n        \n        // Check if this is a task modal\n        if (target.id === 'modal-choose-tasks' || target.id === 'modal-choose-tasks-inv') {\n            console.log('Task modal shown, reinitializing components...');\n            \n            // Reinitialize components for the new modal content\n            this.hideSelectedTasks();\n            this.updateSelectTaskButtonState(document);\n        }\n    }\n\n    /**\n     * Hide already-selected tasks (based on .item-task-id values)\n     */\n    private hideSelectedTasks(): void {\n        const selectedTasks: number[] = [];\n        \n        document.querySelectorAll('.item-task-id').forEach((el: Element) => {\n            const input = el as HTMLInputElement;\n            const currentVal = input.value || '';\n            if (currentVal.length) {\n                const taskId = parseInt(currentVal, 10);\n                if (!isNaN(taskId)) {\n                    selectedTasks.push(taskId);\n                }\n            }\n        });\n\n        let hiddenTasks = 0;\n        document.querySelectorAll('.modal-task-id').forEach((el: Element) => {\n            const idAttr = el.id || '';\n            const idNum = parseInt(idAttr.replace('task-id-', ''), 10);\n            \n            if (!Number.isNaN(idNum) && selectedTasks.includes(idNum)) {\n                // Hide the row containing this modal-task-id\n                const row = el.closest('tr') || \n                           (el.parentElement && el.parentElement.parentElement);\n                if (row) {\n                    (row as HTMLElement).style.display = 'none';\n                    hiddenTasks++;\n                }\n            }\n        });\n\n        const taskRows = document.querySelectorAll('.task-row');\n        if (hiddenTasks >= taskRows.length) {\n            const submitBtn = document.getElementById('task-modal-submit') || document.getElementById('task-modal-submit-quote');\n            if (submitBtn) {\n                submitBtn.style.display = 'none';\n            }\n        }\n    }\n\n    /**\n     * Toggle checkbox when clicking on row (unless click was on checkbox)\n     */\n    private rowClickToggle(event: Event): void {\n        const row = (event.target as HTMLElement).closest('#tasks_table tr, .task-row, .task');\n        if (!row) return;\n        \n        const target = event.target as HTMLInputElement;\n        if (target.type !== 'checkbox') {\n            const checkbox = row.querySelector('input[type=\"checkbox\"]') as HTMLInputElement;\n            if (checkbox) {\n                // Toggle and dispatch change\n                checkbox.checked = !checkbox.checked;\n                checkbox.dispatchEvent(new Event('change', { bubbles: true }));\n            }\n        }\n    }\n\n    /**\n     * Enable/disable select button based on checked tasks\n     */\n    private updateSelectTaskButtonState(root: Document | Element): void {\n        const ctx = root || document;\n        const checkboxes = ctx.querySelectorAll(\"input[name='task_ids[]']\");\n        const checkedBoxes = ctx.querySelectorAll(\"input[name='task_ids[]']:checked\");\n        const anyChecked = checkedBoxes.length > 0;\n        \n        console.log(`\uD83D\uDD0D Task button state update: ${checkboxes.length} total checkboxes, ${checkedBoxes.length} checked, anyChecked: ${anyChecked}`);\n        \n        // Multiple strategies to find the submit button\n        let buttons: NodeListOf<Element>;\n        \n        // Strategy 1: Look in the same context as checkboxes\n        buttons = ctx.querySelectorAll('.select-items-confirm-task, .select-items-confirm-task-inv, .select-items-confirm-task-quote');\n        \n        // Strategy 2: Fall back to document-wide search\n        if (buttons.length === 0) {\n            buttons = document.querySelectorAll('.select-items-confirm-task, .select-items-confirm-task-inv, .select-items-confirm-task-quote');\n        }\n        \n        // Strategy 3: Try finding by ID as fallback\n        if (buttons.length === 0) {\n            const buttonById = document.getElementById('task-modal-submit') || document.getElementById('task-modal-submit-quote');\n            if (buttonById) {\n                buttons = [buttonById] as any;\n                console.log('\uD83D\uDD0D Found button by ID fallback');\n            }\n        }\n        \n        // Strategy 4: Search in any open modal\n        if (buttons.length === 0) {\n            const modals = document.querySelectorAll('.modal');\n            modals.forEach(modal => {\n                const modalButtons = modal.querySelectorAll('.select-items-confirm-task, .select-items-confirm-task-inv, .select-items-confirm-task-quote, #task-modal-submit, #task-modal-submit-quote');\n                if (modalButtons.length > 0) {\n                    buttons = modalButtons;\n                    console.log('\uD83D\uDD0D Found button in modal fallback');\n                }\n            });\n        }\n        \n        console.log(`\uD83D\uDD0D Found ${buttons.length} task submit buttons`);\n        \n        buttons.forEach((btn: Element) => {\n            const button = btn as HTMLButtonElement;\n            if (anyChecked) {\n                button.removeAttribute('disabled');\n                button.removeAttribute('aria-disabled');\n                button.disabled = false;\n                console.log('\u2705 Task submit button enabled');\n            } else {\n                button.setAttribute('disabled', 'true');\n                button.setAttribute('aria-disabled', 'true');\n                button.disabled = true;\n                console.log('\u274C Task submit button disabled');\n            }\n        });\n    }\n\n    /**\n     * Handle confirm click: collect selected task ids and send to server, then populate items and reload\n     */\n    private async handleSelectItemsConfirmTask(btn: HTMLElement): Promise<void> {\n        const absoluteUrl = new URL(location.href);\n        const entityId = absoluteUrl.pathname.split('/').at(-1) || '';\n        \n        // Detect if we're on a quote or invoice page\n        const isQuotePage = absoluteUrl.pathname.includes('/quote/');\n        const isInvoicePage = absoluteUrl.pathname.includes('/inv/');\n\n        const taskIds = Array.from(\n            document.querySelectorAll(\"input[name='task_ids[]']:checked\")\n        )\n            .map((el: Element) => parseInt((el as HTMLInputElement).value, 10))\n            .filter((id: number) => !isNaN(id));\n\n        if (taskIds.length === 0) return;\n\n        // ES2024: Sort task IDs for consistent processing order\n        const sortedTaskIds = taskIds.toSorted((a, b) => a - b);\n        console.log('Processing tasks in sorted order:', sortedTaskIds);\n\n        const originalHtml = btn.innerHTML;\n        btn.innerHTML = '<h2 class=\"text-center\"><i class=\"fa fa-spin fa-spinner\"></i></h2>';\n        (btn as HTMLButtonElement).disabled = true;\n\n        const params = new URLSearchParams();\n        sortedTaskIds.forEach((id: number) => {\n            params.append('task_ids[]', id.toString());\n        });\n        \n        // Use appropriate parameter name and endpoint\n        if (isQuotePage) {\n            params.append('quote_id', entityId);\n        } else {\n            params.append('inv_id', entityId);\n        }\n\n        const endpoint = isQuotePage ? 'selection_quote' : 'selection_inv';\n\n        try {\n            const response = await fetch(`/invoice/task/${endpoint}?${params.toString()}`, {\n                method: 'GET',\n                credentials: 'same-origin',\n                cache: 'no-store',\n                headers: { 'Accept': 'application/json' }\n            });\n\n            if (!response.ok) {\n                throw new Error(`Network response not ok: ${response.status}`);\n            }\n\n            const text = await response.text();\n            let data: any;\n            try {\n                data = JSON.parse(text);\n            } catch (e) {\n                data = text;\n            }\n\n            const tasks = parsedata(data) as TaskSelectionResponse;\n            this.processTasks(tasks);\n\n            btn.innerHTML = '<h2 class=\"text-center\"><i class=\"fa fa-check\"></i></h2>';\n            \n            // Reload as original code does to sync state\n            location.reload();\n        } catch (error) {\n            console.error('selection_inv failed', error);\n            btn.innerHTML = originalHtml;\n            (btn as HTMLButtonElement).disabled = false;\n            \n            const userError = new Error('An error occurred while adding tasks to invoice. See console for details.', { \n                cause: error \n            });\n            alert(userError.message);\n        }\n    }\n\n    /**\n     * Process tasks and populate form fields\n     */\n    private processTasks(tasks: TaskSelectionResponse): void {\n        let productDefaultTaxRateId: string | null = null;\n\n        // ES2024: Group tasks by tax rate for batch processing\n        const tasksByTaxRate = Object.groupBy(\n            Object.entries(tasks).map(([key, task]) => ({ key, ...task })),\n            (task) => task.tax_rate_id || 'default'\n        );\n        \n        console.log('Tasks grouped by tax rate:', Object.keys(tasksByTaxRate));\n\n        // ES2024: Process tasks in reverse order for better form population strategy\n        Object.entries(tasks).toReversed().forEach(([key, task]) => {\n            const currentTaxRateId = task.tax_rate_id;\n            \n            if (!currentTaxRateId) {\n                const defaultTaxEl = document.getElementById('default_item_tax_rate') as HTMLInputElement ||\n                                   document.querySelector('#default_item_tax_rate') as HTMLInputElement;\n                productDefaultTaxRateId = defaultTaxEl ? defaultTaxEl.getAttribute('value') : '';\n            } else {\n                productDefaultTaxRateId = currentTaxRateId;\n            }\n\n            // Find last item row (matching original behaviour)\n            const lastTbody = document.querySelector('#item_table tbody:last-of-type') ||\n                             document.querySelector('#item_table tbody');\n            if (!lastTbody) return;\n\n            const nameEl = lastTbody.querySelector('input[name=\"item_name\"]') as HTMLInputElement;\n            const descEl = lastTbody.querySelector('textarea[name=\"item_description\"]') as HTMLTextAreaElement;\n            const priceEl = lastTbody.querySelector('input[name=\"item_price\"]') as HTMLInputElement;\n            const qtyEl = lastTbody.querySelector('input[name=\"item_quantity\"]') as HTMLInputElement;\n            const taxEl = lastTbody.querySelector('select[name=\"item_tax_rate_id\"]') as HTMLSelectElement;\n            const taskIdEl = lastTbody.querySelector('input[name=\"item_task_id\"]') as HTMLInputElement;\n\n            if (nameEl) nameEl.value = task.name || '';\n            if (descEl) descEl.value = task.description || '';\n            if (priceEl) priceEl.value = task.price || '';\n            if (qtyEl) qtyEl.value = '1';\n            if (taxEl) taxEl.value = productDefaultTaxRateId || '';\n            if (taskIdEl) taskIdEl.value = task.id || '';\n        });\n    }\n\n    /**\n     * Handle task reset button\n     */\n    private async handleTaskReset(): Promise<void> {\n        const tasksTable = document.querySelector('#tasks_table') as HTMLElement;\n        if (!tasksTable) return;\n\n        const lookupUrl = `${location.origin}/invoice/task/lookup?rt=true`;\n        tasksTable.innerHTML = '<h2 class=\"text-center\"><i class=\"fa fa-spin fa-spinner\"></i></h2>';\n\n        // ES2024: Use Promise.withResolvers for better async control\n        const { promise, resolve, reject } = Promise.withResolvers<void>();\n        \n        const timeoutId = setTimeout(() => {\n            reject(new Error('Task lookup timeout', {\n                cause: 'Server did not respond within expected timeframe'\n            }));\n        }, 10000); // 10 second timeout\n\n        try {\n            const response = await fetch(lookupUrl, {\n                cache: 'no-store',\n                credentials: 'same-origin'\n            });\n\n            const html = await response.text();\n            \n            // Secure HTML insertion using DOMParser to prevent XSS\n            const parser = new DOMParser();\n            const doc = parser.parseFromString(html, 'text/html');\n            const fragment = document.createDocumentFragment();\n            \n            // ES2024: Process DOM children in reverse order for better performance\n            Array.from(doc.body.children).toReversed().forEach(child => {\n                fragment.insertBefore(child, fragment.firstChild);\n            });\n            \n            tasksTable.innerHTML = '';\n            tasksTable.appendChild(fragment);\n            \n            this.updateSelectTaskButtonState(tasksTable);\n            clearTimeout(timeoutId);\n            resolve();\n        } catch (error) {\n            clearTimeout(timeoutId);\n            console.error('task lookup load failed', error);\n            reject(error);\n        }\n\n        // Use the promise to handle completion or errors\n        promise.then(() => {\n            // Enable button after successful reset\n            document.querySelectorAll('.select-items-confirm-task').forEach((btn: Element) => {\n                (btn as HTMLButtonElement).removeAttribute('disabled');\n            });\n        }).catch((error) => {\n            console.error('Task reset failed:', error);\n            // Still enable buttons even if reset failed\n            document.querySelectorAll('.select-items-confirm-task').forEach((btn: Element) => {\n                (btn as HTMLButtonElement).removeAttribute('disabled');\n            });\n        });\n    }\n}", "import { parsedata, getJson, ApiResponse } from './utils.js';\n\n// Secure HTML insertion helper to prevent XSS vulnerabilities\nfunction secureInsertHTML(element: Element, html: string): void {\n    const parser = new DOMParser();\n    const doc = parser.parseFromString(html, 'text/html');\n    const fragment = document.createDocumentFragment();\n    Array.from(doc.body.children).forEach(child => fragment.appendChild(child));\n    element.innerHTML = '';\n    element.appendChild(fragment);\n}\n\n// Secure reload helper to prevent Open Redirect vulnerabilities\nfunction secureReload(): void {\n    window.location.reload();\n}\n\ninterface SalesOrderConversionResponse {\n    success?: number;\n    validation_errors?: Record<string, any>;\n    inv_id?: string;\n}\n\n// SalesOrder-specific interfaces\ninterface SalesOrderFormData {\n    [key: string]: string | number | boolean;\n}\n\ninterface SalesOrderSaveResponse extends ApiResponse {\n    success: 0 | 1;\n    message?: string;\n}\n\n// SalesOrder uses global TomSelect and Bootstrap defined in types.ts\n\n// SalesOrder handler class\nexport class SalesOrderHandler {\n    constructor() {\n        this.bindEventListeners();\n        this.initializeOnLoad();\n    }\n\n    private bindEventListeners(): void {\n        document.addEventListener('click', this.handleClick.bind(this), true);\n    }\n\n    private initializeOnLoad(): void {\n        if (document.readyState === 'loading') {\n            document.addEventListener('DOMContentLoaded', () => {\n                this.initSelects();\n            });\n        } else {\n            this.initSelects();\n        }\n    }\n\n    private handleClick(event: Event): void {\n        const target = event.target as HTMLElement;\n\n        // PDF Export with custom fields\n        if (target.matches('#salesorder_to_pdf_confirm_with_custom_fields') || \n            target.closest('#salesorder_to_pdf_confirm_with_custom_fields')) {\n            this.handlePdfExport(true);\n            return;\n        }\n\n        // PDF Export without custom fields\n        if (target.matches('#salesorder_to_pdf_confirm_without_custom_fields') || \n            target.closest('#salesorder_to_pdf_confirm_without_custom_fields')) {\n            this.handlePdfExport(false);\n            return;\n        }\n\n        // SO to Invoice conversion\n        if (target.matches('#so_to_invoice_confirm') || \n            target.closest('#so_to_invoice_confirm')) {\n            this.handleSoToInvoiceConversion();\n            return;\n        }\n\n        // Open sales order modal\n        const openModalBtn = target.closest('.open-salesorder-modal') as HTMLElement;\n        if (openModalBtn) {\n            this.handleOpenModal(openModalBtn);\n            return;\n        }\n\n        // Save sales order via AJAX\n        const saveBtn = target.closest('.salesorder-save') as HTMLElement;\n        if (saveBtn) {\n            this.handleSaveSalesOrder();\n            return;\n        }\n    }\n\n    /**\n     * Initialize Tom Select if present for salesorder selects\n     */\n    private initSelects(): void {\n        if (typeof window.TomSelect === 'undefined') return;\n\n        const selects = document.querySelectorAll(\n            '.simple-select'\n        ) as NodeListOf<HTMLSelectElement>;\n        selects.forEach(element => {\n            // Check if already initialized\n            if (!(element as any)._tomselect) {\n                try {\n                    new window.TomSelect(element, {});\n                    (element as any)._tomselect = true;\n                } catch (error) {\n                    console.warn('Failed to initialize TomSelect:', error);\n                }\n            }\n        });\n    }\n\n    /**\n     * Handle opening the sales order modal\n     */\n    private async handleOpenModal(openBtn: HTMLElement): Promise<void> {\n        const url = openBtn.dataset.url || `${location.origin}/invoice/salesorder/modal`;\n        const targetId = openBtn.dataset.target || 'modal-placeholder-salesorder';\n        const target = document.getElementById(targetId);\n\n        if (!target) {\n            console.error(`Modal target element not found: ${targetId}`);\n            return;\n        }\n\n        try {\n            const response = await fetch(url, { cache: 'no-store', credentials: 'same-origin' });\n            const html = await response.text();\n\n            // Secure HTML insertion to prevent XSS\n            secureInsertHTML(target, html);\n\n            // Show modal using Bootstrap if available\n            const modalEl = target.querySelector('.modal') as HTMLElement;\n            if (modalEl && window.bootstrap?.Modal) {\n                const modalInstance = new window.bootstrap.Modal(modalEl);\n                modalInstance.show();\n            }\n\n            // Initialize selects in the new modal content\n            this.initSelects();\n        } catch (error) {\n            console.error('Failed to load sales order modal:', error);\n            alert('Failed to load modal. Please try again.');\n        }\n    }\n\n    /**\n     * Handle PDF export with or without custom fields\n     */\n    private handlePdfExport(withCustomFields: boolean): void {\n        const url = location.origin + \"/invoice/salesorder/pdf/\" + (withCustomFields ? \"1\" : \"0\");\n        window.location.reload();\n        window.open(url, '_blank');\n    }\n\n    /**\n     * Handle Sales Order to Invoice conversion\n     */\n    private async handleSoToInvoiceConversion(): Promise<void> {\n        const btn = document.querySelector('.so_to_invoice_confirm') as HTMLElement;\n        if (btn) {\n            btn.innerHTML = '<i class=\"fa fa-spin fa-spinner fa-margin\"></i>';\n        }\n\n        // Get required form data\n        const soIdEl = document.getElementById('so_id') as HTMLInputElement;\n        const clientIdEl = document.getElementById('client_id') as HTMLInputElement;\n        const groupIdEl = document.getElementById('group_id') as HTMLInputElement;\n        const passwordEl = document.getElementById('password') as HTMLInputElement;\n\n        if (!soIdEl?.value || !clientIdEl?.value || !groupIdEl?.value) {\n            console.error('Required fields missing for SO to Invoice conversion');\n            alert('Missing required data for conversion');\n            return;\n        }\n\n        const payload = {\n            so_id: soIdEl.value,\n            client_id: clientIdEl.value,\n            group_id: groupIdEl.value,\n            password: passwordEl?.value || ''\n        };\n\n        try {\n            const url = location.origin + \"/invoice/salesorder/so_to_invoice_confirm\";\n            const response = await getJson(url, payload) as SalesOrderConversionResponse;\n\n            if (response && response.success === 1) {\n                if (btn) {\n                    btn.innerHTML = '<h2 class=\"text-center\"><i class=\"fa fa-check\"></i></h2>';\n                }\n                // Navigate to the new invoice if inv_id is provided, otherwise reload\n                if (response.inv_id) {\n                    window.location.href = `${location.origin}/invoice/inv/view/${response.inv_id}`;\n                } else {\n                    secureReload();\n                }\n            } else {\n                // Handle validation errors or failures\n                if (response?.validation_errors) {\n                    document.querySelectorAll('.control-group').forEach(group => {\n                        group.classList.remove('error');\n                    });\n                    Object.entries(response.validation_errors).forEach(([key, error]) => {\n                        const field = document.getElementById(key);\n                        if (field?.parentElement) {\n                            field.parentElement.classList.add('has-error');\n                        }\n                    });\n                }\n                if (btn) {\n                    btn.innerHTML = '<h6 class=\"text-center\"><i class=\"fa fa-check\"></i></h6>';\n                }\n            }\n        } catch (error) {\n            console.error('SO to Invoice conversion failed:', error);\n            if (btn) {\n                btn.innerHTML = '<h6 class=\"text-center\"><i class=\"fa fa-check\"></i></h6>';\n            }\n            alert('An error occurred during conversion. Please try again.');\n        }\n    }\n\n    /**\n     * Handle saving the sales order form\n     */\n    private async handleSaveSalesOrder(): Promise<void> {\n        const form = document.querySelector('#salesorder_form') as HTMLFormElement;\n        if (!form) {\n            console.error('Sales order form not found');\n            return;\n        }\n\n        try {\n            const action =\n                form.getAttribute('action') || `${location.origin}/invoice/salesorder/save`;\n            const formData = new FormData(form);\n\n            // Convert FormData to URLSearchParams for GET request\n            const params = new URLSearchParams();\n            formData.forEach((value, key) => {\n                params.append(key, value.toString());\n            });\n\n            const url = `${action}?${params.toString()}`;\n            const response = await fetch(url, {\n                cache: 'no-store',\n                credentials: 'same-origin',\n                headers: {\n                    Accept: 'application/json',\n                },\n            });\n\n            const data = await response.json();\n            const parsedResponse = parsedata(data) as SalesOrderSaveResponse;\n\n            if (parsedResponse.success === 1) {\n                // Reload page on successful save\n                window.location.reload();\n            } else {\n                const message = parsedResponse.message || 'Save failed';\n                alert(message);\n            }\n        } catch (error) {\n            console.error('Sales order save failed:', error);\n            alert('An error occurred while saving. Please try again.');\n        }\n    }\n}\n", "import { parsedata, getJson, ApiResponse, RequestParams } from './utils.js';\n\n// Family-specific interfaces\ninterface FamilySecondaryRequest extends RequestParams {\n    category_primary_id: string;\n}\n\ninterface FamilyNamesRequest extends RequestParams {\n    category_secondary_id: string;\n}\n\ninterface FamilySecondaryResponse extends ApiResponse {\n    success: 0 | 1;\n    secondary_categories?: Record<string, string>;\n}\n\ninterface FamilyNamesResponse extends ApiResponse {\n    success: 0 | 1;\n    family_names?: Record<string, string>;\n}\n\ninterface FamilyGenerateRequest extends RequestParams {\n    family_ids: string[];\n    tax_rate_id: string;\n    unit_id: string;\n    _csrf: string;\n}\n\ninterface FamilyGenerateResponse extends ApiResponse {\n    success: boolean;\n    count?: number;\n    message?: string;\n    warnings?: string[];\n}\n\ninterface FamilyData {\n    family_id: string;\n    family_name: string;\n    family_productprefix: string;\n    family_commalist: string;\n}\n\n// Family handler class\nexport class FamilyHandler {\n    constructor() {\n        this.bindEventListeners();\n    }\n\n    private bindEventListeners(): void {\n        // Check if DOM is already loaded\n        if (document.readyState === 'loading') {\n            document.addEventListener('DOMContentLoaded', this.initializeSelectors.bind(this));\n        } else {\n            // DOM is already loaded, initialize immediately\n            this.initializeSelectors();\n        }\n        document.addEventListener('click', this.handleClick.bind(this), true);\n    }\n\n    private handleClick(event: Event): void {\n        const target = event.target as HTMLElement;\n        \n        if (target.closest('#process-generate-products')) {\n            this.processProductGeneration();\n            return;\n        }\n    }\n\n    private initializeSelectors(): void {\n        const primarySelect = document.getElementById(\n            'family-category-primary-id'\n        ) as HTMLSelectElement;\n        const secondarySelect = document.getElementById(\n            'family-category-secondary-id'\n        ) as HTMLSelectElement;\n\n        if (primarySelect) {\n            primarySelect.addEventListener('change', this.onPrimaryChange.bind(this), false);\n            // Trigger initial change to populate secondaries on load (if selection exists)\n            this.initializeSelector(() => this.onPrimaryChange());\n        }\n\n        if (secondarySelect) {\n            secondarySelect.addEventListener('change', this.onSecondaryChange.bind(this), false);\n            // Trigger initial load of family names if secondary already has a value\n            this.initializeSelector(() => this.onSecondaryChange());\n        }\n    }\n\n    /**\n     * Initialize selector with deferred execution using ES2024 Promise.withResolvers\n     * Enhanced with error handling and timeout protection\n     */\n    private initializeSelector(callback: () => void): void {\n        const { promise, resolve, reject } = Promise.withResolvers<void>();\n        \n        // Schedule callback with timeout protection\n        const timeoutId = setTimeout(() => {\n            reject(new Error('Selector initialization timeout', { \n                cause: 'DOM not ready within expected timeframe' \n            }));\n        }, 5000);\n        \n        // Schedule callback to run after current execution stack\n        setTimeout(() => {\n            clearTimeout(timeoutId);\n            resolve();\n        }, 0);\n        \n        promise\n            .then(() => callback())\n            .catch(error => {\n                console.error('Selector initialization failed:', error);\n                // Fallback: try to execute callback anyway\n                try {\n                    callback();\n                } catch (callbackError) {\n                    console.error('Callback execution failed:', callbackError);\n                }\n            });\n    }\n\n    /**\n     * Populate a <select> element with options from an object { key: value, ... }\n     */\n    private populateSelect(\n        selectEl: HTMLSelectElement | null,\n        items: Record<string, string> | string[] | null,\n        promptText?: string\n    ): void {\n        if (!selectEl) return;\n\n        // Clear existing options\n        selectEl.innerHTML = '';\n\n        // Add prompt/none option\n        const promptOption = document.createElement('option');\n        promptOption.value = '';\n        promptOption.textContent = promptText || 'None';\n        selectEl.appendChild(promptOption);\n\n        if (!items) return;\n\n        // Handle both array and object formats\n        if (Array.isArray(items)) {\n            items.forEach((value, index) => {\n                const option = document.createElement('option');\n                option.value = index.toString();\n                option.textContent = value;\n                selectEl.appendChild(option);\n            });\n        } else {\n            Object.entries(items).forEach(([key, value]) => {\n                const option = document.createElement('option');\n                option.value = key;\n                option.textContent = value;\n                selectEl.appendChild(option);\n            });\n        }\n    }\n\n    /**\n     * Handler: when primary category changes, load secondary categories\n     */\n    private async onPrimaryChange(): Promise<void> {\n        const primarySelect = document.getElementById(\n            'family-category-primary-id'\n        ) as HTMLSelectElement;\n        if (!primarySelect) return;\n\n        const primaryCategoryId = primarySelect.value || '';\n        const url = `${location.origin}/invoice/family/secondaries/${encodeURIComponent(primaryCategoryId)}`;\n\n        try {\n            const payload: FamilySecondaryRequest = {\n                category_primary_id: primaryCategoryId,\n            };\n\n            const response = await getJson<FamilySecondaryResponse>(url, payload);\n            const data = parsedata(response) as FamilySecondaryResponse;\n\n            if (data.success === 1) {\n                const secondaryCategories = data.secondary_categories || {};\n                const secondaryDropdown = document.getElementById(\n                    'family-category-secondary-id'\n                ) as HTMLSelectElement;\n                this.populateSelect(secondaryDropdown, secondaryCategories, 'None');\n\n                // Trigger change on secondary to cascade populate family names\n                if (secondaryDropdown) {\n                    const changeEvent = new Event('change', { bubbles: true });\n                    secondaryDropdown.dispatchEvent(changeEvent);\n                }\n            } else {\n                // In failure case, clear secondary and family name selects\n                this.populateSelect(\n                    document.getElementById('family-category-secondary-id') as HTMLSelectElement,\n                    {},\n                    'None'\n                );\n                this.populateSelect(\n                    document.getElementById('family-name') as HTMLSelectElement,\n                    {},\n                    'None'\n                );\n            }\n        } catch (error) {\n            console.error('Error loading secondary categories', error);\n            // Clear selects on error\n            this.populateSelect(\n                document.getElementById('family-category-secondary-id') as HTMLSelectElement,\n                {},\n                'None'\n            );\n            this.populateSelect(\n                document.getElementById('family-name') as HTMLSelectElement,\n                {},\n                'None'\n            );\n        }\n    }\n\n    /**\n     * Handler: when secondary category changes, load family names\n     */\n    private async onSecondaryChange(): Promise<void> {\n        const secondarySelect = document.getElementById(\n            'family-category-secondary-id'\n        ) as HTMLSelectElement;\n        if (!secondarySelect) return;\n\n        const secondaryCategoryId = secondarySelect.value || '';\n        const url = `${location.origin}/invoice/family/names/${encodeURIComponent(secondaryCategoryId)}`;\n\n        try {\n            const payload: FamilyNamesRequest = {\n                category_secondary_id: secondaryCategoryId,\n            };\n\n            const response = await getJson<FamilyNamesResponse>(url, payload);\n            const data = parsedata(response) as FamilyNamesResponse;\n\n            if (data.success === 1) {\n                const familyNames = data.family_names || {};\n                const familyNameDropdown = document.getElementById(\n                    'family-name'\n                ) as HTMLSelectElement;\n                this.populateSelect(familyNameDropdown, familyNames, 'None');\n            } else {\n                this.populateSelect(\n                    document.getElementById('family-name') as HTMLSelectElement,\n                    {},\n                    'None'\n                );\n            }\n        } catch (error) {\n            console.error('Error loading family names', error);\n            // Clear family names select on error\n            this.populateSelect(\n                document.getElementById('family-name') as HTMLSelectElement,\n                {},\n                'None'\n            );\n        }\n    }\n\n\n\n    /**\n     * Get family data from checked checkboxes\n     */\n    private getFamilyDataFromCheckedBoxes(): FamilyData[] {\n        const families: FamilyData[] = [];\n        const checkedBoxes = document.querySelectorAll<HTMLInputElement>('input[name=\"family_ids[]\"]:checked');\n        \n        checkedBoxes.forEach(checkbox => {\n            const row = checkbox.closest('tr');\n            if (!row) return;\n            \n            const familyId = checkbox.value;\n            const familyNameCell = row.querySelector('[data-family-name]') as HTMLElement;\n            const familyPrefixCell = row.querySelector('[data-family-prefix]') as HTMLElement;\n            const familyCommaListCell = row.querySelector('[data-family-commalist]') as HTMLElement;\n            \n            const familyData: FamilyData = {\n                family_id: familyId,\n                family_name: familyNameCell?.textContent?.trim() || '',\n                family_productprefix: familyPrefixCell?.textContent?.trim() || '',\n                family_commalist: familyCommaListCell?.textContent?.trim() || ''\n            };\n            \n            families.push(familyData);\n        });\n        \n        return families;\n    }\n\n\n\n    /**\n     * Process product generation\n     */\n    private async processProductGeneration(): Promise<void> {\n        const taxRateSelect = document.getElementById('tax_rate_id') as HTMLSelectElement;\n        const unitSelect = document.getElementById('unit_id') as HTMLSelectElement;\n        const processBtn = document.getElementById('process-generate-products') as HTMLButtonElement;\n        \n        if (!taxRateSelect?.value || !unitSelect?.value) {\n            alert('Please select both tax rate and unit.');\n            return;\n        }\n\n        const selectedFamilies = this.getFamilyDataFromCheckedBoxes();\n        if (selectedFamilies.length === 0) {\n            alert('No families selected.');\n            return;\n        }\n\n        // Show loading state\n        const originalText = processBtn.innerHTML;\n        processBtn.innerHTML = '<i class=\"fa fa-spin fa-spinner\"></i> Generating...';\n        processBtn.disabled = true;\n\n        try {\n            const familyIds = selectedFamilies.map(f => f.family_id);\n            const csrfToken = (document.querySelector('input[name=\"_csrf\"]') as HTMLInputElement)?.value || '';\n            \n            const payload: FamilyGenerateRequest = {\n                family_ids: familyIds,\n                tax_rate_id: taxRateSelect.value,\n                unit_id: unitSelect.value,\n                _csrf: csrfToken\n            };\n\n            const response = await fetch(`${location.origin}/invoice/family/generate_products`, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/x-www-form-urlencoded',\n                },\n                credentials: 'same-origin',\n                body: new URLSearchParams(payload as any).toString()\n            });\n\n            const data = (await response.json()) as FamilyGenerateResponse;\n\n            if (data.success) {\n                processBtn.innerHTML = '<i class=\"fa fa-check\"></i> Success!';\n                alert(data.message || `Successfully generated ${data.count || 0} products!`);\n                \n                if (data.warnings && data.warnings.length > 0) {\n                    console.warn('Warnings during product generation:', data.warnings);\n                }\n\n                // Close modal and reload page\n                const modal = document.getElementById('generate-products-modal');\n                if (modal && typeof (window as any).bootstrap?.Modal !== 'undefined') {\n                    const bsModal = (window as any).bootstrap.Modal.getInstance(modal);\n                    if (bsModal) {\n                        bsModal.hide();\n                    }\n                }\n                setTimeout(() => {\n                    window.location.reload();\n                }, 1000);\n            } else {\n                processBtn.innerHTML = originalText;\n                processBtn.disabled = false;\n                alert(`Error: ${data.message || 'Unknown error occurred'}`);\n            }\n        } catch (error) {\n            console.error('Product generation error:', error);\n            processBtn.innerHTML = originalText;\n            processBtn.disabled = false;\n            alert('An error occurred while generating products. Please try again.');\n        }\n    }\n\n\n}\n", "import { parsedata, ApiResponse } from './utils.js';\n\n// Settings-specific interfaces\ninterface FphGenerateRequest {\n    userAgent: string;\n    width: number;\n    height: number;\n    scalingFactor: number;\n    colourDepth: number;\n    windowInnerWidth: number;\n    windowInnerHeight: number;\n}\n\ninterface FphGenerateResponse extends ApiResponse {\n    success: 0 | 1;\n    userAgent?: string;\n    deviceId?: string;\n    width?: string;\n    height?: string;\n    scalingFactor?: string;\n    colourDepth?: string;\n    timestamp?: string;\n    windowSize?: string;\n    userUuid?: string;\n}\n\ninterface CronKeyResponse extends ApiResponse {\n    success: 0 | 1;\n    cronkey?: string;\n}\n\n// Settings handler class\nexport class SettingsHandler {\n    private originalDisplayStyles: Record<string, string> = {};\n    private originalDisabledStates: Record<string, { element: HTMLElement; disabled: boolean }> =\n        {};\n\n    constructor() {\n        this.bindEventListeners();\n    }\n\n    private bindEventListeners(): void {\n        // Check if DOM is already loaded\n        if (document.readyState === 'loading') {\n            document.addEventListener('DOMContentLoaded', this.initialize.bind(this));\n        } else {\n            // DOM is already loaded, initialize immediately\n            this.initialize();\n        }\n    }\n\n    private initialize(): void {\n        // Initialize SMTP toggle\n        this.toggleSmtpSettings();\n\n        // Email send method change handler\n        const emailSendMethodEl = document.getElementById('email_send_method') as HTMLSelectElement;\n        if (emailSendMethodEl) {\n            emailSendMethodEl.addEventListener('change', this.toggleSmtpSettings.bind(this));\n        }\n\n        // FPH generate button\n        const fphBtn = document.getElementById('btn_fph_generate') as HTMLButtonElement;\n        if (fphBtn) {\n            fphBtn.addEventListener('click', e => {\n                e.preventDefault();\n                this.handleFphGenerateClick();\n            });\n        }\n\n        // Submit button - only for settings form\n        const settingsForm = document.getElementById('form-settings');\n        const submitBtn = document.getElementById('btn-submit') as HTMLButtonElement;\n        if (submitBtn && settingsForm) {\n            // Only intercept if the button is inside the settings form\n            if (settingsForm.contains(submitBtn)) {\n                submitBtn.addEventListener('click', e => {\n                    e.preventDefault();\n                    this.handleSettingsSubmitClick();\n                });\n            }\n        }\n\n        // Online payment select\n        const onlineSelect = document.getElementById('online-payment-select') as HTMLSelectElement;\n        if (onlineSelect) {\n            onlineSelect.addEventListener(\n                'change',\n                this.handleOnlinePaymentSelectChange.bind(this)\n            );\n        }\n\n        // Run online payment handler once to ensure initial state\n        this.handleOnlinePaymentSelectChange();\n    }\n\n    /**\n     * Toggle visibility of SMTP settings based on email_send_method value\n     */\n    private toggleSmtpSettings(): void {\n        const emailSendMethodEl = document.getElementById('email_send_method') as HTMLSelectElement;\n        const div = document.getElementById('div-smtp-settings') as HTMLDivElement;\n\n        if (!div || !emailSendMethodEl) return;\n\n        if (emailSendMethodEl.value === 'smtp') {\n            div.style.display = '';\n        } else {\n            div.style.display = 'none';\n        }\n    }\n\n    /**\n     * Generate fingerprint / client metrics for FPH\n     */\n    private async handleFphGenerateClick(): Promise<void> {\n        const url = `${location.origin}/invoice/setting/fphgenerate`;\n\n        const requestData: FphGenerateRequest = {\n            userAgent: navigator.userAgent,\n            width: window.screen.width,\n            height: window.screen.height,\n            scalingFactor: Math.round(window.devicePixelRatio * 100) / 100,\n            colourDepth: window.screen.colorDepth,\n            windowInnerWidth: window.innerWidth,\n            windowInnerHeight: window.innerHeight,\n        };\n\n        const params = new URLSearchParams();\n        Object.entries(requestData).forEach(([key, value]) => {\n            params.append(key, value.toString());\n        });\n\n        try {\n            const response = await fetch(`${url}?${params.toString()}`, {\n                method: 'GET',\n                credentials: 'same-origin',\n                cache: 'no-store',\n                headers: { Accept: 'application/json' },\n            });\n\n            if (!response.ok) {\n                throw new Error(`Network response not ok: ${response.status}`);\n            }\n\n            const data = await response.json().catch(() => ({}));\n            const parsedResponse = parsedata(data) as FphGenerateResponse;\n\n            if (parsedResponse.success === 1) {\n                this.updateSettingField(\n                    'settings[fph_client_browser_js_user_agent]',\n                    parsedResponse.userAgent\n                );\n                this.updateSettingField('settings[fph_client_device_id]', parsedResponse.deviceId);\n                this.updateSettingField('settings[fph_screen_width]', parsedResponse.width);\n                this.updateSettingField('settings[fph_screen_height]', parsedResponse.height);\n                this.updateSettingField(\n                    'settings[fph_screen_scaling_factor]',\n                    parsedResponse.scalingFactor\n                );\n                this.updateSettingField(\n                    'settings[fph_screen_colour_depth]',\n                    parsedResponse.colourDepth\n                );\n                this.updateSettingField('settings[fph_timestamp]', parsedResponse.timestamp);\n                this.updateSettingField('settings[fph_window_size]', parsedResponse.windowSize);\n                this.updateSettingField(\n                    'settings[fph_gov_client_user_id]',\n                    parsedResponse.userUuid\n                );\n            }\n        } catch (error) {\n            console.error('FPH generate failed', error);\n        }\n    }\n\n    /**\n     * Helper to update a settings field value\n     */\n    private updateSettingField(fieldId: string, value?: string): void {\n        const element = document.getElementById(fieldId) as HTMLInputElement;\n        if (element && value !== undefined) {\n            element.value = value;\n        }\n    }\n\n\n    /**\n     * Submit settings form - ensure all tab elements are included\n     */\n    private handleSettingsSubmitClick(): void {\n        const form = document.getElementById('form-settings') as HTMLFormElement;\n        if (!form) return;\n\n        // Before submitting, temporarily make all tab panes visible\n        // to ensure all form elements are included in the submission\n        const tabPanes = form.querySelectorAll('.tab-pane') as NodeListOf<HTMLDivElement>;\n\n        this.originalDisplayStyles = {};\n        this.originalDisabledStates = {};\n\n        // ES2024: Process tabs in reverse order for proper layering\n        Array.from(tabPanes).toReversed().forEach(pane => {\n            if (pane.id) {\n                // Store and modify display style\n                this.originalDisplayStyles[pane.id] = pane.style.display;\n                pane.style.display = 'block';\n\n                // Temporarily enable any disabled form elements in hidden tabs\n                const disabledElements = pane.querySelectorAll(\n                    'input:disabled, select:disabled, textarea:disabled'\n                ) as NodeListOf<HTMLElement>;\n                disabledElements.forEach((element, index) => {\n                    const key = `${pane.id}_${index}`;\n                    this.originalDisabledStates[key] = { element, disabled: true };\n                    (\n                        element as HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement\n                    ).disabled = false;\n                });\n            }\n        });\n\n        // Small delay to ensure DOM updates, then submit\n        setTimeout(() => {\n            form.submit();\n            this.restoreFormState(tabPanes);\n        }, 10);\n    }\n\n    /**\n     * Restore form state after submission\n     */\n    private restoreFormState(tabPanes: NodeListOf<HTMLDivElement>): void {\n        // Restore original display styles\n        tabPanes.forEach(pane => {\n            if (pane.id && this.originalDisplayStyles[pane.id] !== undefined) {\n                pane.style.display = this.originalDisplayStyles[pane.id];\n            }\n        });\n\n        // Restore disabled states\n        Object.entries(this.originalDisabledStates).forEach(([_, state]) => {\n            if (state.element && state.disabled) {\n                (\n                    state.element as HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement\n                ).disabled = true;\n            }\n        });\n    }\n\n    /**\n     * Online payment select change handler (show/hide gateway settings)\n     */\n    private handleOnlinePaymentSelectChange(): void {\n        const select = document.getElementById('online-payment-select') as HTMLSelectElement;\n        if (!select) return;\n\n        const driver = select.value;\n\n        // Hide all gateway settings\n        const gatewaySettings = document.querySelectorAll(\n            '.gateway-settings'\n        ) as NodeListOf<HTMLElement>;\n        gatewaySettings.forEach(element => {\n            if (!element.classList.contains('active-gateway')) {\n                element.classList.add('hidden');\n            }\n        });\n\n        // Show selected gateway settings\n        const target = document.getElementById(`gateway-settings-${driver}`) as HTMLElement;\n        if (target) {\n            target.classList.remove('hidden');\n            target.classList.add('active-gateway');\n        }\n    }\n}\n", "// src/typescript/scripts.ts\n// Converted from scripts.js - Global UI utilities\n\nexport function initTooltips(): void {\n    const bootstrap = (window as any).bootstrap;\n    if (typeof bootstrap === 'undefined' || !bootstrap.Tooltip) return;\n    \n    const tooltipElements = document.querySelectorAll('[data-bs-toggle=\"tooltip\"]');\n    tooltipElements.forEach((el) => {\n        try { \n            new bootstrap.Tooltip(el); \n        } catch (e) { \n            // ignore init errors \n        }\n    });\n}\n\nexport function initSimpleSelects(root?: Document | Element): void {\n    const TomSelect = (window as any).TomSelect;\n    if (typeof TomSelect === 'undefined') return;\n    \n    const container = root || document;\n    const selectElements = container.querySelectorAll('.simple-select') as NodeListOf<HTMLSelectElement>;\n    \n    selectElements.forEach((el) => {\n        if (!(el as any)._tomselect) {\n            new TomSelect(el, {});\n            (el as any)._tomselect = true;\n        }\n    });\n}\n\n// Loader helpers\nexport function showFullpageLoader(): void {\n    const loader = document.getElementById('fullpage-loader');\n    const loaderError = document.getElementById('loader-error');\n    const loaderIcon = document.getElementById('loader-icon');\n\n    if (loader) loader.style.display = 'block';\n    if (loaderError) loaderError.style.display = 'none';\n    if (loaderIcon) {\n        loaderIcon.classList.add('fa-spin');\n        loaderIcon.classList.remove('text-danger');\n    }\n\n    // Set timeout for error display\n    setTimeout(() => {\n        if (loaderError) loaderError.style.display = 'block';\n        if (loaderIcon) {\n            loaderIcon.classList.remove('fa-spin');\n            loaderIcon.classList.add('text-danger');\n        }\n    }, 10000);\n}\n\nexport function hideFullpageLoader(): void {\n    const loader = document.getElementById('fullpage-loader');\n    const loaderError = document.getElementById('loader-error');\n    const loaderIcon = document.getElementById('loader-icon');\n\n    if (loader) loader.style.display = 'none';\n    if (loaderError) loaderError.style.display = 'none';\n    if (loaderIcon) {\n        loaderIcon.classList.add('fa-spin');\n        loaderIcon.classList.remove('text-danger');\n    }\n}\n\n// Password strength meter\nexport function initPasswordMeter(): void {\n    const passwordInput = document.querySelector('.passwordmeter-input') as HTMLInputElement;\n    if (!passwordInput) return;\n\n    passwordInput.addEventListener('input', () => {\n        // Simple strength calculation (you can enhance this)\n        const password = passwordInput.value;\n        const strength = calculatePasswordStrength(password);\n        \n        const meter2 = document.querySelector('.passmeter-2') as HTMLElement;\n        const meter3 = document.querySelector('.passmeter-3') as HTMLElement;\n        \n        if (meter2 && meter3) {\n            meter2.style.display = 'none';\n            meter3.style.display = 'none';\n            \n            if (strength >= 4) {\n                meter2.style.display = 'block';\n                meter3.style.display = 'block';\n            } else if (strength >= 3) {\n                meter2.style.display = 'block';\n            }\n        }\n    });\n}\n\nfunction calculatePasswordStrength(password: string): number {\n    let strength = 0;\n    if (password.length >= 8) strength++;\n    if (/[a-z]/.test(password)) strength++;\n    if (/[A-Z]/.test(password)) strength++;\n    if (/[0-9]/.test(password)) strength++;\n    if (/[^A-Za-z0-9]/.test(password)) strength++;\n    return strength;\n}\n\n// Initialize everything when DOM is ready\nexport function initializeScripts(): void {\n    document.addEventListener('DOMContentLoaded', () => {\n        initTooltips();\n        initSimpleSelects();\n        initPasswordMeter();\n        \n        // Add event listeners for fullpage loader\n        document.addEventListener('click', (e) => {\n            const target = e.target as HTMLElement;\n            if (target.classList.contains('ajax-loader')) {\n                showFullpageLoader();\n            }\n            if (target.classList.contains('fullpage-loader-close')) {\n                hideFullpageLoader();\n            }\n        });\n    });\n}\n\n// Auto-initialize if this module is loaded\ninitializeScripts();", "/**\n * Family Commalist Number Picker\n * A vanilla JavaScript alternative to the Angular component\n */\n\nclass FamilyCommalistPicker {\n    private container: HTMLElement;\n    private textarea: HTMLTextAreaElement;\n    private selectedNumbers: Set<number> = new Set();\n    private currentPage: number = 1;\n    private numbersPerPage: number = 50;\n    private totalPages: number = 4; // 200 numbers / 50 per page\n\n    constructor(containerId: string, textareaId: string) {\n        this.container = document.getElementById(containerId)!;\n        this.textarea = document.getElementById(textareaId) as HTMLTextAreaElement;\n        \n        if (!this.container || !this.textarea) {\n            throw new Error('Required elements not found');\n        }\n        \n        this.parseInitialValue();\n        this.render();\n        this.attachEventListeners();\n    }\n\n    private parseInitialValue(): void {\n        if (this.textarea.value) {\n            const existingNumbers = this.textarea.value\n                .split(',')\n                .map(n => parseInt(n.trim()))\n                .filter(n => !isNaN(n) && n >= 1 && n <= 200);\n            \n            this.selectedNumbers = new Set(existingNumbers);\n        }\n    }\n\n    private render(): void {\n        this.container.innerHTML = this.getHTML();\n    }\n\n    private getHTML(): string {\n        const paginatedNumbers = this.getPaginatedNumbers();\n        const selectedCount = this.selectedNumbers.size;\n        const pageInfo = this.getPageInfo();\n\n        return `\n            <div class=\"family-commalist-picker\">\n                <div class=\"picker-header mb-3\">\n                    <h5 class=\"mb-2\">\n                        <i class=\"bi bi-list-ol\"></i> \n                        Select Numbers (1-200)\n                    </h5>\n                    <div class=\"d-flex justify-content-between align-items-center flex-wrap gap-2\">\n                        <div class=\"selected-info\">\n                            <span class=\"badge bg-primary me-2\">\n                                ${selectedCount} selected\n                            </span>\n                            <span class=\"text-muted small\">${pageInfo}</span>\n                        </div>\n                        \n                        <div class=\"btn-group btn-group-sm\" role=\"group\">\n                            <button type=\"button\" class=\"btn btn-outline-success\" onclick=\"picker.selectPage()\" title=\"Select all numbers on current page\">\n                                <i class=\"bi bi-check-square\"></i> Page\n                            </button>\n                            <button type=\"button\" class=\"btn btn-outline-warning\" onclick=\"picker.deselectPage()\" title=\"Deselect all numbers on current page\">\n                                <i class=\"bi bi-square\"></i> Page\n                            </button>\n                            <button type=\"button\" class=\"btn btn-outline-danger\" onclick=\"picker.clearAll()\" title=\"Clear all selections\">\n                                <i class=\"bi bi-trash\"></i> Clear\n                            </button>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Quick Range Selection -->\n                <div class=\"quick-ranges mb-3\">\n                    <small class=\"text-muted d-block mb-2\">Quick ranges:</small>\n                    <div class=\"btn-group btn-group-sm flex-wrap\" role=\"group\">\n                        <button type=\"button\" class=\"btn btn-outline-secondary btn-sm\" onclick=\"picker.selectRange(1, 10)\" title=\"Select 1-10\">1-10</button>\n                        <button type=\"button\" class=\"btn btn-outline-secondary btn-sm\" onclick=\"picker.selectRange(11, 25)\" title=\"Select 11-25\">11-25</button>\n                        <button type=\"button\" class=\"btn btn-outline-secondary btn-sm\" onclick=\"picker.selectRange(26, 50)\" title=\"Select 26-50\">26-50</button>\n                        <button type=\"button\" class=\"btn btn-outline-secondary btn-sm\" onclick=\"picker.selectRange(51, 100)\" title=\"Select 51-100\">51-100</button>\n                        <button type=\"button\" class=\"btn btn-outline-secondary btn-sm\" onclick=\"picker.selectRange(101, 150)\" title=\"Select 101-150\">101-150</button>\n                        <button type=\"button\" class=\"btn btn-outline-secondary btn-sm\" onclick=\"picker.selectRange(151, 200)\" title=\"Select 151-200\">151-200</button>\n                    </div>\n                </div>\n\n                <!-- Number Grid -->\n                <div class=\"numbers-grid mb-3\">\n                    <div class=\"number-buttons\">\n                        ${paginatedNumbers.map(num => `\n                            <button type=\"button\" \n                                    class=\"btn number-btn ${this.selectedNumbers.has(num) ? 'btn-success' : 'btn-outline-secondary'}\"\n                                    onclick=\"picker.toggleNumber(${num})\"\n                                    title=\"Toggle number ${num}\">\n                                ${num}\n                            </button>\n                        `).join('')}\n                    </div>\n                </div>\n\n                <!-- Pagination -->\n                <div class=\"pagination-controls d-flex justify-content-between align-items-center\">\n                    <button type=\"button\" class=\"btn btn-outline-primary btn-sm\" onclick=\"picker.prevPage()\" ${this.currentPage === 1 ? 'disabled' : ''}>\n                        <i class=\"bi bi-chevron-left\"></i> Previous\n                    </button>\n                    \n                    <div class=\"page-buttons\">\n                        ${[1, 2, 3, 4].map(page => `\n                            <button type=\"button\" \n                                    class=\"btn btn-sm me-1 ${page === this.currentPage ? 'btn-primary' : 'btn-outline-primary'}\"\n                                    onclick=\"picker.goToPage(${page})\">\n                                ${page}\n                            </button>\n                        `).join('')}\n                    </div>\n                    \n                    <button type=\"button\" class=\"btn btn-outline-primary btn-sm\" onclick=\"picker.nextPage()\" ${this.currentPage === this.totalPages ? 'disabled' : ''}>\n                        Next <i class=\"bi bi-chevron-right\"></i>\n                    </button>\n                </div>\n\n                ${selectedCount > 0 ? `\n                    <div class=\"selected-preview mt-3\">\n                        <small class=\"text-muted d-block mb-1\">Selected numbers:</small>\n                        <div class=\"selected-numbers-display\">\n                            <span class=\"text-muted small\">${Array.from(this.selectedNumbers).sort((a, b) => a - b).join(', ')}</span>\n                        </div>\n                    </div>\n                ` : ''}\n            </div>\n        `;\n    }\n\n    private getPaginatedNumbers(): number[] {\n        const startIndex = (this.currentPage - 1) * this.numbersPerPage;\n        const endIndex = startIndex + this.numbersPerPage;\n        const allNumbers = Array.from({ length: 200 }, (_, i) => i + 1);\n        return allNumbers.slice(startIndex, endIndex);\n    }\n\n    private getPageInfo(): string {\n        const start = (this.currentPage - 1) * this.numbersPerPage + 1;\n        const end = Math.min(this.currentPage * this.numbersPerPage, 200);\n        return `${start}-${end} of 200`;\n    }\n\n    public toggleNumber(num: number): void {\n        if (this.selectedNumbers.has(num)) {\n            this.selectedNumbers.delete(num);\n        } else {\n            this.selectedNumbers.add(num);\n        }\n        this.updateTextarea();\n        this.render();\n    }\n\n    public clearAll(): void {\n        this.selectedNumbers.clear();\n        this.updateTextarea();\n        this.render();\n    }\n\n    public selectRange(start: number, end: number): void {\n        for (let i = start; i <= end; i++) {\n            if (i >= 1 && i <= 200) {\n                this.selectedNumbers.add(i);\n            }\n        }\n        this.updateTextarea();\n        this.render();\n    }\n\n    public selectPage(): void {\n        this.getPaginatedNumbers().forEach(num => {\n            this.selectedNumbers.add(num);\n        });\n        this.updateTextarea();\n        this.render();\n    }\n\n    public deselectPage(): void {\n        this.getPaginatedNumbers().forEach(num => {\n            this.selectedNumbers.delete(num);\n        });\n        this.updateTextarea();\n        this.render();\n    }\n\n    public goToPage(page: number): void {\n        if (page >= 1 && page <= this.totalPages) {\n            this.currentPage = page;\n            this.render();\n        }\n    }\n\n    public nextPage(): void {\n        if (this.currentPage < this.totalPages) {\n            this.currentPage++;\n            this.render();\n        }\n    }\n\n    public prevPage(): void {\n        if (this.currentPage > 1) {\n            this.currentPage--;\n            this.render();\n        }\n    }\n\n    private updateTextarea(): void {\n        const sortedNumbers = Array.from(this.selectedNumbers).sort((a, b) => a - b);\n        const commalistValue = sortedNumbers.join(', ');\n        this.textarea.value = commalistValue;\n        \n        // Trigger events for form validation\n        this.textarea.dispatchEvent(new Event('change', { bubbles: true }));\n        this.textarea.dispatchEvent(new Event('input', { bubbles: true }));\n    }\n\n    private attachEventListeners(): void {\n        // Listen for manual textarea changes\n        this.textarea.addEventListener('input', () => {\n            this.parseInitialValue();\n            this.render();\n        });\n    }\n}\n\n// Global instance\nlet picker: FamilyCommalistPicker | null = null;\n\n// Integration functions\ndeclare global {\n    interface Window {\n        toggleCommalistPicker: () => void;\n        picker: FamilyCommalistPicker | null;\n    }\n}\n\nexport function initializeCommalistPicker() {\n    window.toggleCommalistPicker = toggleCommalistPicker;\n    window.picker = null;\n}\n\nfunction toggleCommalistPicker() {\n    const container = document.getElementById('commalist-picker-container');\n    const button = document.getElementById('toggle-picker-btn');\n    \n    if (!container || !button) return;\n    \n    if (container.style.display === 'none') {\n        // Show picker\n        container.style.display = 'block';\n        button.innerHTML = '<i class=\"bi bi-grid-3x3-gap-fill\"></i> Hide Number Picker';\n        \n        // Initialize picker if not already done\n        if (!picker) {\n            // Create picker container\n            const pickerDiv = document.createElement('div');\n            pickerDiv.id = 'number-picker';\n            \n            const infoAlert = container.querySelector('.alert');\n            if (infoAlert && infoAlert.nextSibling) {\n                container.insertBefore(pickerDiv, infoAlert.nextSibling);\n            } else {\n                container.appendChild(pickerDiv);\n            }\n            \n            picker = new FamilyCommalistPicker('number-picker', 'family_commalist');\n            window.picker = picker;\n        }\n    } else {\n        // Hide picker\n        container.style.display = 'none';\n        button.innerHTML = '<i class=\"bi bi-grid-3x3-gap\"></i> Show Number Picker';\n    }\n}\n\n// Initialize when DOM is ready\nif (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', initializeCommalistPicker);\n} else {\n    initializeCommalistPicker();\n}"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;;;ACUO,WAAS,UAAU,MAAkD;AACxE,QAAI,CAAC,KAAM,QAAO,CAAC;AACnB,QAAI,OAAO,SAAS,YAAY,SAAS,KAAM,QAAO;AACtD,QAAI,OAAO,SAAS,UAAU;AAC1B,UAAI;AACA,eAAO,KAAK,MAAM,IAAI;AAAA,MAC1B,SAAS,GAAG;AACR,eAAO,CAAC;AAAA,MACZ;AAAA,IACJ;AACA,WAAO,CAAC;AAAA,EACZ;AASA,iBAAsB,QAClB,KACA,QACA,UAAwB,CAAC,GACf;AACV,QAAI,aAAa;AAEjB,QAAI,QAAQ;AACR,YAAM,eAAe,IAAI,gBAAgB;AAEzC,aAAO,QAAQ,MAAM,EAAE,QAAQ,CAAC,CAAC,KAAK,KAAK,MAAM;AAC7C,YAAI,MAAM,QAAQ,KAAK,GAAG;AAEtB,gBAAM,QAAQ,UAAQ;AAClB,gBAAI,SAAS,QAAQ,SAAS,QAAW;AACrC,2BAAa,OAAO,GAAG,GAAG,MAAM,OAAO,IAAI,CAAC;AAAA,YAChD;AAAA,UACJ,CAAC;AAAA,QACL,WAAW,UAAU,UAAa,UAAU,MAAM;AAC9C,uBAAa,OAAO,KAAK,OAAO,KAAK,CAAC;AAAA,QAC1C;AAAA,MACJ,CAAC;AAED,YAAM,YAAY,IAAI,SAAS,GAAG,IAAI,MAAM;AAC5C,mBAAa,GAAG,GAAG,GAAG,SAAS,GAAG,aAAa,SAAS,CAAC;AAAA,IAC7D;AAEA,UAAM,iBAA8B;AAAA,MAChC,QAAQ;AAAA,MACR,aAAa;AAAA,MACb,OAAO;AAAA,MACP,SAAS,EAAE,QAAQ,mBAAmB;AAAA,MACtC,GAAG;AAAA,IACP;AAEA,UAAM,WAAW,MAAM,MAAM,YAAY,cAAc;AAEvD,QAAI,CAAC,SAAS,IAAI;AACd,YAAM,IAAI,MAAM,4BAA4B,SAAS,MAAM,EAAE;AAAA,IACjE;AAEA,UAAM,OAAO,MAAM,SAAS,KAAK;AAEjC,QAAI;AACA,aAAO,KAAK,MAAM,IAAI;AAAA,IAC1B,SAAS,GAAG;AACR,aAAO;AAAA,IACX;AAAA,EACJ;AAQO,WAAS,YACZ,SACA,UACc;AACd,QAAI;AACA,UAAI,CAAC,QAAS,QAAO;AAErB,UAAI,OAAO,QAAQ,YAAY,YAAY;AACvC,eAAO,QAAQ,QAAQ,QAAQ;AAAA,MACnC;AAGA,UAAI,OAAO;AACX,aAAO,MAAM;AACT,YAAI,KAAK,WAAW,KAAK,QAAQ,QAAQ,GAAG;AACxC,iBAAO;AAAA,QACX;AACA,eAAO,KAAK;AAAA,MAChB;AAAA,IACJ,SAAS,GAAG;AACR,cAAQ,KAAK,sBAAsB,CAAC;AACpC,aAAO;AAAA,IACX;AAEA,WAAO;AAAA,EACX;AAOO,WAAS,eAAoD,IAA4B;AAC5F,WAAO,SAAS,eAAe,EAAE;AAAA,EACrC;AAOO,WAAS,cAA2C,UAAkC;AACzF,WAAO,SAAS,cAAc,QAAQ;AAAA,EAC1C;AAgBO,WAAS,cAAc,IAAoB;AAC9C,UAAM,UAAU,eAAiC,EAAE;AACnD,WAAO,SAAS,SAAS;AAAA,EAC7B;;;AC7IO,MAAM,sBAAN,MAA0B;AAAA,IACZ,wBAAwB;AAAA,IAEzC,cAAc;AACV,WAAK,WAAW;AAAA,IACpB;AAAA,IAEQ,aAAmB;AACvB,eAAS,iBAAiB,SAAS,KAAK,YAAY,KAAK,IAAI,GAAG,IAAI;AAAA,IACxE;AAAA,IAEA,MAAc,YAAY,OAAkC;AACxD,YAAM,SAAS,MAAM;AAErB,UAAI,CAAC,UAAU,OAAO,OAAO,yBAAyB;AAClD;AAAA,MACJ;AAEA,YAAM,eAAe;AAErB,UAAI;AACA,cAAM,KAAK,oBAAoB;AAAA,MACnC,SAAS,OAAO;AACZ,gBAAQ,MAAM,wBAAwB,KAAK;AAC3C,cAAM,UAAU,iBAAiB,QAAQ,MAAM,UAAU,eAAe,EAAE;AAAA,MAC9E;AAAA,IACJ;AAAA,IAEA,MAAc,sBAAqC;AAC/C,YAAM,MAAM,GAAG,SAAS,MAAM;AAC9B,YAAM,MAAM,cAA2B,KAAK,qBAAqB;AACjE,YAAM,cAAc,IAAI,IAAI,SAAS,IAAI;AAGzC,UAAI,KAAK;AACL,YAAI,YAAY;AAAA,MACpB;AAGA,YAAM,QAAQ,YAAY,SAAS,MAAM,GAAG,EAAE,GAAG,EAAE,KAAK;AAGxD,YAAM,WAA4B;AAAA,QAC9B,QAAQ;AAAA,QACR,WAAW,cAAc,WAAW;AAAA,QACpC,kBAAkB,cAAc,kBAAkB;AAAA,QAClD,UAAU,cAAc,cAAc;AAAA,QACtC,UAAU,cAAc,cAAc;AAAA,QACtC,SAAS,cAAc,SAAS;AAAA,MACpC;AAGA,YAAM,OAAO,MAAM,QAAQ,KAAK,QAAQ;AACxC,YAAM,WAAW,UAAU,IAAI;AAE/B,UAAI,SAAS,YAAY,GAAG;AAExB,YAAI,KAAK;AACL,cAAI,YAAY;AAAA,QACpB;AAEA,YAAI,SAAS,eAAe;AACxB,gBAAM,SAAS,aAAa;AAAA,QAChC;AAGA,iBAAS,OAAO,YAAY;AAC5B,iBAAS,OAAO;AAAA,MACpB,OAAO;AAEH,YAAI,KAAK;AACL,cAAI,YAAY;AAAA,QACpB;AAEA,YAAI,SAAS,eAAe;AACxB,gBAAM,SAAS,aAAa;AAAA,QAChC;AAGA,iBAAS,OAAO,YAAY;AAC5B,iBAAS,OAAO;AAAA,MACpB;AAAA,IACJ;AAAA,EACJ;;;ACvFA,WAAS,eAAqB;AAE1B,WAAO,SAAS,OAAO;AAAA,EAC3B;AAGA,WAAS,iBAAiB,SAAkB,MAAoB;AAC5D,UAAM,SAAS,IAAI,UAAU;AAC7B,UAAM,MAAM,OAAO,gBAAgB,MAAM,WAAW;AACpD,UAAM,WAAW,SAAS,uBAAuB;AACjD,UAAM,KAAK,IAAI,KAAK,QAAQ,EAAE,QAAQ,WAAS,SAAS,YAAY,KAAK,CAAC;AAC1E,YAAQ,YAAY;AACpB,YAAQ,YAAY,QAAQ;AAAA,EAChC;AA4BA,WAAS,oBAA4B;AACjC,UAAM,MAAM,IAAI,IAAI,SAAS,IAAI;AACjC,WAAO,IAAI,SAAS,MAAM,GAAG,EAAE,GAAG,EAAE,KAAK;AAAA,EAC7C;AAGA,WAAS,cAAc,IAAoB;AACvC,UAAM,UAAU,SAAS,eAAe,EAAE;AAC1C,WAAO,SAAS,SAAS;AAAA,EAC7B;AAGA,WAAS,iBAAiB,QAAqB,WAAoB,cAA6B;AAC5F,QAAI,WAAW;AACX,aAAO,YAAY;AACnB,MAAC,OAA6B,WAAW;AAAA,IAC7C,OAAO;AACH,aAAO,YACH,gBAAgB;AACpB,MAAC,OAA6B,WAAW;AAAA,IAC7C;AAAA,EACJ;AAGO,MAAM,eAAN,MAAmB;AAAA,IACtB,cAAc;AACV,WAAK,mBAAmB;AACxB,WAAK,qBAAqB;AAAA,IAC9B;AAAA,IAEQ,qBAA2B;AAE/B,eAAS,iBAAiB,SAAS,KAAK,YAAY,KAAK,IAAI,GAAG,IAAI;AAGpE,eAAS,iBAAiB,SAAS,KAAK,YAAY,KAAK,IAAI,GAAG,IAAI;AAGpE,eAAS,iBAAiB,SAAS,KAAK,YAAY,KAAK,IAAI,GAAG,IAAI;AAGpE,eAAS,iBAAiB,SAAS,KAAK,qBAAqB,KAAK,IAAI,GAAG,IAAI;AAG7E,eAAS,iBAAiB,SAAS,KAAK,qBAAqB,KAAK,IAAI,GAAG,IAAI;AAAA,IACjF;AAAA,IAEQ,YAAY,OAAoB;AACpC,YAAM,SAAS,MAAM;AAGrB,YAAM,YAAY,OAAO,QAAQ,kBAAkB;AACnD,UAAI,WAAW;AACX,aAAK,iBAAiB,SAAS;AAC/B;AAAA,MACJ;AAGA,YAAM,WAAW,OAAO,QAAQ,6BAA6B;AAC7D,UAAI,UAAU;AACV,aAAK,0BAA0B,QAAQ;AACvC;AAAA,MACJ;AAGA,YAAM,iBAAiB,OAAO,QAAQ,oBAAoB;AAC1D,UAAI,gBAAgB;AAChB,aAAK,kBAAkB;AACvB;AAAA,MACJ;AAGA,YAAM,qBAAqB,OAAO,QAAQ,yBAAyB;AACnE,UAAI,oBAAoB;AACpB,aAAK,sBAAsB;AAC3B;AAAA,MACJ;AAGA,YAAM,YAAY,OAAO,QAAQ,cAAc;AAC/C,UAAI,WAAW;AACX,aAAK,oBAAoB;AACzB;AAAA,MACJ;AAGA,YAAM,eAAe,OAAO,QAAQ,mBAAmB;AACvD,UAAI,cAAc;AACd,aAAK,qBAAqB;AAC1B;AAAA,MACJ;AAGA,YAAM,gBAAgB,OAAO;AAAA,QACzB;AAAA,MACJ;AACA,UAAI,eAAe;AACf,aAAK,yBAAyB;AAC9B;AAAA,MACJ;AAGA,YAAM,YAAY,OAAO;AAAA,QACrB;AAAA,MACJ;AACA,UAAI,WAAW;AACX,aAAK,gCAAgC,SAAS;AAC9C;AAAA,MACJ;AAGA,YAAM,YAAY,OAAO;AAAA,QACrB;AAAA,MACJ;AACA,UAAI,WAAW;AACX,aAAK,4BAA4B,SAAS;AAC1C;AAAA,MACJ;AAGA,YAAM,OAAO,OAAO,QAAQ,4CAA4C;AACxE,UAAI,MAAM;AACN,aAAK,+BAA+B,IAAI;AACxC;AAAA,MACJ;AAGA,YAAM,UAAU,OAAO;AAAA,QACnB;AAAA,MACJ;AACA,UAAI,SAAS;AACT,aAAK,0BAA0B,OAAO;AACtC;AAAA,MACJ;AAGA,WAAK,oBAAoB,MAAM;AAAA,IACnC;AAAA,IAEA,MAAc,iBAAiB,WAAuC;AAClE,YAAM,KAAK,UAAU,aAAa,SAAS;AAE3C,UAAI,CAAC,IAAI;AAEL,cAAM,aAAa,UAAU,QAAQ,OAAO;AAC5C,oBAAY,OAAO;AACnB;AAAA,MACJ;AAEA,UAAI;AACA,cAAM,MAAM,GAAG,SAAS,MAAM,8BAA8B,mBAAmB,EAAE,CAAC;AAClF,cAAM,WAAW,MAAM,QAAqB,KAAK,EAAE,GAAG,CAAC;AACvD,cAAM,OAAO,UAAU,QAAQ;AAE/B,YAAI,KAAK,YAAY,GAAG;AACpB,mBAAS,OAAO;AAChB,gBAAM,aAAa,UAAU,QAAQ,OAAO;AAC5C,sBAAY,OAAO;AACnB,gBAAM,SAAS;AAAA,QACnB,OAAO;AACH,kBAAQ,KAAK,sBAAsB,IAAI;AAAA,QAC3C;AAAA,MACJ,SAAS,OAAO;AACZ,gBAAQ,MAAM,qBAAqB,KAAK;AACxC,cAAM,iEAAiE;AAAA,MAC3E;AAAA,IACJ;AAAA,IAEA,MAAc,0BAA0B,UAAsC;AAC1E,YAAM,eAAe,SAAS;AAC9B,uBAAiB,UAAU,IAAI;AAE/B,UAAI;AACA,cAAM,iBAAiB,SAAS;AAAA,UAC5B;AAAA,QACJ;AACA,cAAM,WAAW,MAAM,KAAK,cAAc,EACrC,IAAI,WAAS,SAAS,MAAM,OAAO,EAAE,CAAC,EACtC,OAAO,OAAO,EACd,SAAS,CAAC,GAAG,MAAM,IAAI,CAAC;AAE7B,cAAM,WAAW,MAAM,QAAqB,+BAA+B;AAAA,UACvE;AAAA,QACJ,CAAC;AACD,cAAM,OAAO,UAAU,QAAQ;AAE/B,YAAI,KAAK,YAAY,GAAG;AACpB,mBAAS,YAAY;AACrB,mBAAS,OAAO;AAAA,QACpB,OAAO;AACH,kBAAQ,KAAK,6BAA6B,IAAI;AAC9C,2BAAiB,UAAU,OAAO,YAAY;AAAA,QAClD;AAAA,MACJ,SAAS,OAAO;AACZ,gBAAQ,MAAM,4BAA4B,KAAK;AAC/C,yBAAiB,UAAU,OAAO,YAAY;AAC9C,cAAM,kEAAkE;AAAA,MAC5E;AAAA,IACJ;AAAA,IAEA,MAAc,oBAAmC;AAC7C,YAAM,UAAU,kBAAkB;AAClC,YAAM,MAAM,GAAG,SAAS,MAAM,0BAA0B,mBAAmB,OAAO,CAAC;AACnF,YAAM,cAAc,SAAS,eAAe,6BAA6B;AAEzE,UAAI,CAAC,YAAa;AAElB,UAAI;AACA,oBAAY,YACR;AACJ,cAAM,WAAW,MAAM,MAAM,KAAK,EAAE,OAAO,YAAY,aAAa,cAAc,CAAC;AACnF,cAAM,OAAO,MAAM,SAAS,KAAK;AAEjC,yBAAiB,aAAa,IAAI;AAAA,MACtC,SAAS,OAAO;AACZ,gBAAQ,MAAM,kCAAkC,KAAK;AAAA,MACzD;AAAA,IACJ;AAAA,IAEQ,wBAA8B;AAClC,YAAM,WAAW,SAAS,eAAe,oBAAoB;AAC7D,YAAM,QAAQ,SAAS,eAAe,YAAY;AAElD,UAAI,YAAY,OAAO;AACnB,cAAM,QAAQ,SAAS,UAAU,IAAI;AACrC,cAAM,gBAAgB,IAAI;AAC1B,cAAM,UAAU,IAAI,MAAM;AAC1B,cAAM,MAAM,UAAU;AACtB,cAAM,YAAY,KAAK;AAAA,MAC3B;AAAA,IACJ;AAAA,IAEQ,sBAA4B;AAChC,YAAM,WAAW,SAAS,eAAe,SAAS;AAClD,YAAM,QAAQ,SAAS,eAAe,YAAY;AAElD,UAAI,YAAY,OAAO;AACnB,cAAM,QAAQ,SAAS,UAAU,IAAI;AACrC,cAAM,gBAAgB,IAAI;AAC1B,cAAM,UAAU,IAAI,MAAM;AAC1B,cAAM,MAAM,UAAU;AACtB,cAAM,YAAY,KAAK;AAAA,MAC3B;AAAA,IACJ;AAAA,IAEA,MAAc,uBAAsC;AAChD,YAAM,MAAM,GAAG,SAAS,MAAM;AAC9B,YAAM,cAAc,SAAS,eAAe,0BAA0B;AAEtE,UAAI,CAAC,YAAa;AAElB,UAAI;AACA,oBAAY,YACR;AACJ,cAAM,WAAW,MAAM,MAAM,KAAK,EAAE,OAAO,YAAY,aAAa,cAAc,CAAC;AACnF,cAAM,OAAO,MAAM,SAAS,KAAK;AAEjC,yBAAiB,aAAa,IAAI;AAAA,MACtC,SAAS,OAAO;AACZ,gBAAQ,MAAM,qCAAqC,KAAK;AAAA,MAC5D;AAAA,IACJ;AAAA,IAEA,MAAc,2BAA0C;AACpD,YAAM,MAAM,GAAG,SAAS,MAAM;AAC9B,YAAM,MAAM,SAAS,cAAc,uBAAuB;AAC1D,YAAM,eAAe,KAAK,aAAa;AAEvC,UAAI,KAAK;AACL,yBAAiB,KAAK,IAAI;AAAA,MAC9B;AAEA,UAAI;AACA,cAAM,UAAyB;AAAA,UAC3B,WAAW,cAAc,wBAAwB;AAAA,UACjD,gBAAgB,cAAc,gBAAgB;AAAA,UAC9C,gBAAgB,cAAc,gBAAgB;AAAA,QAClD;AAEA,cAAM,WAAW,MAAM,QAAqB,KAAK,OAAO;AACxD,cAAM,OAAO,UAAU,QAAQ;AAE/B,YAAI,KAAK,YAAY,GAAG;AACpB,cAAI,IAAK,KAAI,YAAY;AACzB,uBAAa;AAAA,QACjB,WAAW,KAAK,YAAY,GAAG;AAC3B,cAAI,IAAK,KAAI,YAAY;AACzB,uBAAa;AACb,cAAI,KAAK,QAAS,OAAM,KAAK,OAAO;AAAA,QACxC;AAAA,MACJ,SAAS,OAAO;AACZ,gBAAQ,MAAM,wBAAwB,KAAK;AAC3C,YAAI,KAAK;AACL,2BAAiB,KAAK,OAAO,YAAY;AAAA,QAC7C;AACA,cAAM,kEAAkE;AAAA,MAC5E;AAAA,IACJ;AAAA,IAEA,MAAc,gCAAgC,WAAuC;AACjF,YAAM,MAAM,GAAG,SAAS,MAAM;AAC9B,YAAM,MACD,SAAS,cAAc,2CAA2C,KACnE;AAEJ,UAAI,KAAK;AACL,yBAAiB,KAAK,IAAI;AAAA,MAC9B;AAEA,UAAI;AACA,cAAM,UAAyB;AAAA,UAC3B,SAAS,cAAc,SAAS;AAAA,UAChC,kBAAkB,cAAc,kCAAkC;AAAA,UAClE,kBAAkB,cAAc,kCAAkC;AAAA,QACtE;AAEA,cAAM,WAAW,MAAM,QAAqB,KAAK,OAAO;AACxD,cAAM,OAAO,UAAU,QAAQ;AAE/B,YAAI,KAAK,YAAY,GAAG;AACpB,cAAI,IAAK,KAAI,YAAY;AACzB,uBAAa;AAAA,QACjB;AAAA,MACJ,SAAS,OAAO;AACZ,gBAAQ,MAAM,iBAAiB,KAAK;AACpC,YAAI,KAAK;AACL,2BAAiB,KAAK,KAAK;AAAA,QAC/B;AACA,cAAM,mEAAmE;AAAA,MAC7E;AAAA,IACJ;AAAA,IAEA,MAAc,4BAA4B,WAAuC;AAC7E,YAAM,MAAM,GAAG,SAAS,MAAM;AAC9B,YAAM,MACD,SAAS,cAAc,2BAA2B,KAAqB;AAC5E,YAAM,eAAe,KAAK,aAAa;AAEvC,UAAI,KAAK;AACL,yBAAiB,KAAK,IAAI;AAAA,MAC9B;AAEA,UAAI;AACA,cAAM,UAAU,kBAAkB;AAClC,cAAM,UAAyB;AAAA,UAC3B,UAAU;AAAA,UACV,WAAW,cAAc,WAAW;AAAA,UACpC,UAAU,cAAc,UAAU;AAAA,UAClC,UAAU,cAAc,UAAU;AAAA,QACtC;AAEA,cAAM,WAAW,MAAM,QAAqB,KAAK,OAAO;AACxD,cAAM,OAAO,UAAU,QAAQ;AAE/B,YAAI,IAAK,KAAI,YAAY;AAGzB,YAAI,KAAK,WAAW,KAAK,cAAc;AACnC,iBAAO,SAAS,OAAO,KAAK;AAAA,QAChC,WAAW,KAAK,WAAW,KAAK,gBAAgB;AAE5C,iBAAO,SAAS,OAAO,GAAG,SAAS,MAAM,qBAAqB,KAAK,cAAc;AAAA,QACrF,OAAO;AAEH,uBAAa;AAAA,QACjB;AAEA,YAAI,KAAK,cAAe,OAAM,KAAK,aAAa;AAAA,MACpD,SAAS,OAAO;AACZ,gBAAQ,MAAM,kCAAkC,KAAK;AACrD,YAAI,KAAK;AACL,2BAAiB,KAAK,OAAO,YAAY;AAAA,QAC7C;AACA,cAAM,+EAA+E;AAAA,MACzF;AAAA,IACJ;AAAA,IAEA,MAAc,+BAA+B,MAAkC;AAC3E,YAAM,MAAM,GAAG,SAAS,MAAM;AAC9B,YAAM,MAAO,SAAS,cAAc,sBAAsB,KAAqB;AAC/E,YAAM,eAAe,KAAK,aAAa;AAEvC,UAAI,KAAK;AACL,yBAAiB,KAAK,IAAI;AAAA,MAC9B;AAEA,UAAI;AACA,cAAM,UAAU,kBAAkB;AAClC,cAAM,UAAyB;AAAA,UAC3B,UAAU;AAAA,UACV,WAAW,cAAc,WAAW;AAAA,UACpC,UAAU,cAAc,aAAa;AAAA,UACrC,WAAW,cAAc,WAAW;AAAA,UACpC,WAAW,cAAc,WAAW;AAAA,UACpC,UAAU,cAAc,UAAU;AAAA,QACtC;AAEA,cAAM,WAAW,MAAM,QAAqB,KAAK,OAAO;AACxD,cAAM,OAAO,UAAU,QAAQ;AAE/B,YAAI,IAAK,KAAI,YAAY;AAGzB,YAAI,KAAK,WAAW,KAAK,cAAc;AACnC,iBAAO,SAAS,OAAO,KAAK;AAAA,QAChC,OAAO;AAEH,uBAAa;AAAA,QACjB;AAEA,YAAI,KAAK,cAAe,OAAM,KAAK,aAAa;AAAA,MACpD,SAAS,OAAO;AACZ,gBAAQ,MAAM,6BAA6B,KAAK;AAChD,YAAI,KAAK;AACL,2BAAiB,KAAK,OAAO,YAAY;AAAA,QAC7C;AACA,cAAM,0EAA0E;AAAA,MACpF;AAAA,IACJ;AAAA,IAEA,MAAc,0BAA0B,SAAqC;AACzE,YAAM,MAAM,GAAG,SAAS,MAAM;AAC9B,YAAM,MAAO,SAAS,cAAc,yBAAyB,KAAqB;AAClF,YAAM,eAAe,KAAK,aAAa;AAEvC,UAAI,KAAK;AACL,yBAAiB,KAAK,IAAI;AAAA,MAC9B;AAEA,UAAI;AACA,cAAM,UAAU,kBAAkB;AAClC,cAAM,UAAyB;AAAA,UAC3B,UAAU;AAAA,UACV,WAAW,cAAc,wBAAwB;AAAA,UACjD,SAAS,cAAc,SAAS;AAAA,QACpC;AAEA,cAAM,WAAW,MAAM,QAAqB,KAAK,OAAO;AACxD,cAAM,OAAO,UAAU,QAAQ;AAE/B,YAAI,KAAK,YAAY,GAAG;AACpB,cAAI,IAAK,KAAI,YAAY;AACzB,uBAAa;AACb,cAAI,KAAK,cAAe,OAAM,KAAK,aAAa;AAAA,QACpD;AAAA,MACJ,SAAS,OAAO;AACZ,gBAAQ,MAAM,gCAAgC,KAAK;AACnD,YAAI,KAAK;AACL,2BAAiB,KAAK,OAAO,YAAY;AAAA,QAC7C;AACA,cAAM,iEAAiE;AAAA,MAC3E;AAAA,IACJ;AAAA,IAEQ,oBAAoB,QAA2B;AAEnD,UAAI,OAAO,QAAQ,0CAA0C,GAAG;AAC5D,cAAM,MAAM,GAAG,SAAS,MAAM;AAC9B,eAAO,KAAK,KAAK,QAAQ;AACzB;AAAA,MACJ;AAGA,UAAI,OAAO,QAAQ,6CAA6C,GAAG;AAC/D,cAAM,MAAM,GAAG,SAAS,MAAM;AAC9B,eAAO,KAAK,KAAK,QAAQ;AACzB;AAAA,MACJ;AAAA,IACJ;AAAA,IAEA,MAAc,qBAAqB,OAA6B;AAC5D,YAAM,SAAS,MAAM;AACrB,YAAM,UAAU,OAAO,QAAQ,mBAAmB;AAClD,UAAI,CAAC,QAAS;AAEd,YAAM,MAAM,GAAG,SAAS,MAAM;AAC9B,YAAM,UAAU,GAAG,SAAS,MAAM;AAElC,UAAI;AACA,cAAM,UAA0B;AAAA,UAC5B,WAAW,cAAc,WAAW;AAAA,UACpC,aAAa,cAAc,aAAa;AAAA,QAC5C;AAEA,cAAM,WAAW,MAAM,QAAqB,KAAK,OAAO;AACxD,cAAM,OAAO,UAAU,QAAQ;AAE/B,YAAI,KAAK,YAAY,GAAG;AAEpB,mBAAS,iBAAiB,gBAAgB,EAAE,QAAQ,WAAS;AACzD,kBAAM,UAAU,OAAO,OAAO;AAAA,UAClC,CAAC;AAGD,gBAAM,SAAS,SAAS,eAAe,aAAa;AACpD,cAAI,OAAQ,QAAO,QAAQ;AAG3B,gBAAM,YAAY,SAAS,eAAe,YAAY;AACtD,cAAI,WAAW;AACX,kBAAM,oBAAoB,GAAG,OAAO,cAAc,mBAAmB,QAAQ,SAAS,CAAC;AACvF,kBAAM,gBAAgB,MAAM,MAAM,mBAAmB;AAAA,cACjD,OAAO;AAAA,cACP,aAAa;AAAA,YACjB,CAAC;AACD,kBAAM,OAAO,MAAM,cAAc,KAAK;AAEtC,6BAAiB,WAAW,IAAI;AAAA,UACpC;AAAA,QACJ,OAAO;AAEH,mBAAS,iBAAiB,gBAAgB,EAAE,QAAQ,WAAS;AACzD,kBAAM,UAAU,OAAO,OAAO;AAAA,UAClC,CAAC;AAED,cAAI,KAAK,mBAAmB;AACxB,mBAAO,QAAQ,KAAK,iBAAiB,EAAE,QAAQ,CAAC,CAAC,KAAK,MAAM,MAAM;AAC9D,oBAAM,MAAM,SAAS,eAAe,GAAG;AACvC,kBAAI,KAAK,eAAe;AACpB,oBAAI,cAAc,UAAU,IAAI,WAAW;AAAA,cAC/C;AAAA,YACJ,CAAC;AAAA,UACL;AAAA,QACJ;AAAA,MACJ,SAAS,OAAO;AACZ,gBAAQ,MAAM,0BAA0B,KAAK;AAC7C,cAAM,iCAAiC;AAAA,MAC3C;AAAA,IACJ;AAAA,IAEA,MAAc,qBAAqB,OAA6B;AAC5D,YAAM,SAAS,MAAM;AACrB,YAAM,SAAS,OAAO,QAAQ,mBAAmB;AACjD,UAAI,CAAC,OAAQ;AAEb,YAAM,MAAM,GAAG,SAAS,MAAM;AAC9B,YAAM,MACD,SAAS,cAAc,mBAAmB,KAAsB;AAErE,UAAI,KAAK;AACL,yBAAiB,KAAK,IAAI;AAAA,MAC9B;AAEA,UAAI;AACA,cAAM,UAAU,kBAAkB;AAClC,cAAM,UAAyB;AAAA,UAC3B,UAAU;AAAA,UACV,aAAa,cAAc,aAAa;AAAA,UACxC,kBAAkB,cAAc,kBAAkB;AAAA,QACtD;AAEA,cAAM,WAAW,MAAM,QAAqB,KAAK,OAAO;AACxD,cAAM,OAAO,UAAU,QAAQ;AAE/B,qBAAa;AACb,YAAI,KAAK,cAAe,OAAM,KAAK,aAAa;AAAA,MACpD,SAAS,OAAO;AACZ,gBAAQ,MAAM,6BAA6B,KAAK;AAChD,cAAM,yEAAyE;AAAA,MACnF;AAAA,IACJ;AAAA,IAEQ,YAAY,OAAoB;AACpC,YAAM,SAAS,MAAM;AAGrB,UAAI,OAAO,OAAO,yBAAyB;AACvC,cAAM,YAAY,SAAS,eAAe,wBAAwB;AAClE,YAAI,OAAO,MAAM,SAAS,GAAG;AACzB,cAAI,WAAW;AACX,sBAAU,QAAQ;AAClB,sBAAU,WAAW;AAAA,UACzB;AAAA,QACJ,OAAO;AACH,cAAI,UAAW,WAAU,WAAW;AAAA,QACxC;AAAA,MACJ;AAGA,UAAI,OAAO,OAAO,0BAA0B;AACxC,cAAM,WAAW,SAAS,eAAe,uBAAuB;AAChE,YAAI,OAAO,MAAM,SAAS,GAAG;AACzB,cAAI,UAAU;AACV,qBAAS,QAAQ;AACjB,qBAAS,WAAW;AAAA,UACxB;AAAA,QACJ,OAAO;AACH,cAAI,SAAU,UAAS,WAAW;AAAA,QACtC;AAAA,MACJ;AAAA,IACJ;AAAA,IAEQ,YAAY,OAAoB;AACpC,YAAM,SAAS,MAAM;AAGrB,UAAI,OAAO,OAAO,cAAc;AAC5B,aAAK,qBAAqB,MAAM;AAAA,MACpC;AAEA,UAAI,OAAO,WAAW,SAAS,YAAY,GAAG;AAC1C,aAAK,qBAAqB,MAAM;AAAA,MACpC;AAGA,UAAI,OAAO,WAAW,SAAS,UAAU,GAAG;AACxC,QAAC,OAAe,sBAAsB;AAAA,MAC1C;AAAA,IACJ;AAAA,IAEQ,qBAAqB,SAA4B;AACrD,UAAK,OAAe,QAAQ,IAAI,YAAY;AACxC,YAAI,QAAQ,OAAO,cAAc;AAC7B,UAAC,OAAe,OAAO,OAAO,EAAE,WAAW;AAAA,YACvC,aAAa;AAAA,YACb,YAAY;AAAA,YACZ,iBAAiB;AAAA,YACjB,YAAY;AAAA,UAChB,CAAC;AAAA,QACL,OAAO;AACH,UAAC,OAAe,OAAO,OAAO,EAAE,WAAW;AAAA,YACvC,YAAY,MAAM;AACd,yBAAW,MAAM;AACb,yBAAS,iBAAiB,aAAa,EAAE,QAAQ,OAAK;AAClD,kBAAC,EAAkB,MAAM,SAAS;AAAA,gBACtC,CAAC;AAAA,cACL,GAAG,CAAC;AAAA,YACR;AAAA,UACJ,CAAC;AAAA,QACL;AAAA,MACJ;AAAA,IACJ;AAAA,IAEQ,uBAA6B;AAEjC,UAAI,SAAS,eAAe,WAAW;AACnC,iBAAS,iBAAiB,oBAAoB,MAAM;AAChD,eAAK,mBAAmB;AACxB,eAAK,oBAAoB;AAAA,QAC7B,CAAC;AAAA,MACL,OAAO;AAEH,aAAK,mBAAmB;AACxB,aAAK,oBAAoB;AAAA,MAC7B;AAAA,IACJ;AAAA,IAEQ,qBAA2B;AAC/B,UAAI,OAAQ,OAAe,WAAW,YAAY,aAAa;AAC3D,iBAAS,iBAAiB,4BAA4B,EAAE,QAAQ,aAAW;AACvE,cAAI;AACA,gBAAK,OAAe,UAAU,QAAQ,OAAO;AAAA,UACjD,SAAS,OAAO;AAAA,UAEhB;AAAA,QACJ,CAAC;AAAA,MACL;AAAA,IACJ;AAAA,IAEQ,sBAA4B;AAChC,eAAS,iBAAiB,aAAa,EAAE,QAAQ,YAAU;AACvD,cAAM,gBAAgB;AACtB,sBAAc,iBAAiB,UAAU,WAAS;AAC9C,gBAAM,gBAAgB,MAAM;AAE5B,cAAK,OAAe,qBAAqB;AACrC,iBAAK,cAAe,OAAe,oBAAoB,IAAI,cAAc,KAAK;AAAA,UAClF;AAGA,cAAK,cAAsB,YAAY,OAAO;AAC1C,YAAC,cAAsB,WAAW,MAAM;AAAA,UAC5C,WAAY,cAAsB,WAAW,OAAO;AAChD,YAAC,cAAsB,UAAU,MAAM;AAAA,UAC3C,WAAW,cAAc,UAAU;AAE/B,kBAAM,KAAK,cAAc,OAAO,EAAE,WAAW,EAAE,QAAQ,YAAU;AAC7D,qBAAO,WAAW;AAAA,YACtB,CAAC;AAAA,UACL,OAAO;AACH,0BAAc,QAAQ;AAAA,UAC1B;AAEA,gBAAM,eAAe;AACrB,iBAAO;AAAA,QACX,CAAC;AAAA,MACL,CAAC;AAAA,IACL;AAAA,IAEQ,cAAc,WAAmB,MAAoB;AACzD,YAAM,UAAU,SAAS,eAAe,SAAS;AAGjD,UAAI,CAAC,QAAS;AAEd,YAAM,WAAW,QAAQ,kBAAkB;AAC3C,YAAM,SAAS,QAAQ,gBAAgB;AACvC,YAAM,QAAQ,QAAQ;AAEtB,cAAQ,QAAQ,MAAM,UAAU,GAAG,QAAQ,IAAI,OAAO,MAAM,UAAU,MAAM;AAC5E,cAAQ,kBAAkB,WAAW,KAAK,QAAQ,WAAW,KAAK,MAAM;AACxE,cAAQ,MAAM;AAAA,IAClB;AAAA,EACJ;;;AC5tBA,WAASA,eAAc,IAAoB;AACvC,UAAM,UAAU,SAAS,eAAe,EAAE;AAC1C,WAAO,SAAS,SAAS;AAAA,EAC7B;AAGA,WAASC,gBAAqB;AAE1B,WAAO,SAAS,OAAO;AAAA,EAC3B;AAGA,WAAS,sBAAsB,OAAe,MAAM,YAAoB,eAAe,YAAoB,yBAAsC;AAC7I,UAAM,UAAU,SAAS,cAAc,IAAI;AAC3C,YAAQ,YAAY;AACpB,UAAM,OAAO,SAAS,cAAc,GAAG;AACvC,SAAK,YAAY;AACjB,YAAQ,YAAY,IAAI;AACxB,WAAO;AAAA,EACX;AAGA,WAASC,kBAAiB,QAAqB,WAAoB,cAA6B;AAC5F,QAAI,WAAW;AACX,aAAO,cAAc;AACrB,aAAO,YAAY,sBAAsB,MAAM,eAAe,uBAAuB,CAAC;AACtF,MAAC,OAA6B,WAAW;AAAA,IAC7C,OAAO;AACH,UAAI,cAAc;AACd,eAAO,cAAc;AACrB,eAAO,YAAY,sBAAsB,MAAM,eAAe,aAAa,CAAC;AAAA,MAChF,OAAO;AACH,eAAO,cAAc;AACrB,eAAO,YAAY,sBAAsB,MAAM,eAAe,aAAa,CAAC;AAAA,MAChF;AACA,MAAC,OAA6B,WAAW;AAAA,IAC7C;AAAA,EACJ;AAGA,WAAS,uBAAuB,KAAyB,OAAe,MAAM,YAAoB,eAAe,YAAoB,yBAA+B;AAChK,QAAI,CAAC,IAAK;AACV,QAAI,cAAc;AAClB,QAAI,YAAY,sBAAsB,MAAM,WAAW,SAAS,CAAC;AAAA,EACrE;AAGO,MAAM,gBAAN,MAAoB;AAAA,IACvB,cAAc;AACV,WAAK,mBAAmB;AAAA,IAC5B;AAAA,IAEQ,qBAA2B;AAC/B,eAAS,iBAAiB,SAAS,KAAK,YAAY,KAAK,IAAI,GAAG,IAAI;AAGpE,WAAK,yBAAyB;AAAA,IAClC;AAAA,IAEQ,2BAAiC;AAErC,YAAM,aAAa,CAAC,QAAgB,YAA0C;AAC1E,cAAM,OAAO,SAAS,eAAe,MAAM;AAC3C,YAAI,MAAM;AACN,eAAK,iBAAiB,UAAU,QAAQ,KAAK,IAAI,CAAC;AAAA,QACtD,OAAO;AAEH,cAAI,SAAS,eAAe,WAAW;AACnC,qBAAS,iBAAiB,oBAAoB,MAAM;AAChD,oBAAM,YAAY,SAAS,eAAe,MAAM;AAChD,kBAAI,WAAW;AACX,0BAAU,iBAAiB,UAAU,QAAQ,KAAK,IAAI,CAAC;AAAA,cAC3D;AAAA,YACJ,CAAC;AAAA,UACL;AAAA,QACJ;AAAA,MACJ;AAGA,iBAAW,aAAa,KAAK,qBAAqB;AAClD,iBAAW,WAAW,KAAK,uBAAuB;AAAA,IACtD;AAAA,IAEQ,YAAY,OAAoB;AACpC,YAAM,SAAS,MAAM;AAGrB,YAAM,YAAY,OAAO,QAAQ,wBAAwB;AACzD,UAAI,WAAW;AACX,aAAK,0BAA0B,SAAS;AACxC;AAAA,MACJ;AAGA,YAAM,cAAc,OAAO,QAAQ,uBAAuB;AAC1D,UAAI,aAAa;AACb,aAAK,qBAAqB,WAAW;AACrC;AAAA,MACJ;AAGA,YAAM,gBAAgB,OAAO,QAAQ,yBAAyB;AAC9D,UAAI,eAAe;AACf,aAAK,uBAAuB,aAAa;AACzC;AAAA,MACJ;AAAA,IACJ;AAAA,IAIA,MAAc,0BAA0B,WAAuC;AAC3E,YAAM,MAAM,GAAG,SAAS,MAAM;AAC9B,YAAM,MAAO,SAAS,cAAc,wBAAwB,KAAqB;AAGjF,UAAI,KAAK;AACL,QAAAA,kBAAiB,KAAK,IAAI;AAAA,MAC9B;AAEA,UAAI;AACA,cAAM,UAA0B;AAAA,UAC5B,aAAaF,eAAc,aAAa;AAAA,UACxC,gBAAgBA,eAAc,gBAAgB;AAAA,UAC9C,cAAcA,eAAc,cAAc;AAAA,QAC9C;AAEA,cAAM,WAAW,MAAM,QAAqB,KAAK,OAAO;AACxD,cAAM,OAAO,UAAU,QAAQ;AAE/B,YAAI,KAAK,YAAY,GAAG;AACpB,cAAI,KAAK;AACL,mCAAuB,KAAK,MAAM,eAAe,aAAa;AAAA,UAClE;AAEA,UAAAC,cAAa;AAAA,QACjB,OAAO;AACH,cAAI,KAAK;AACL,YAAAC,kBAAiB,KAAK,KAAK;AAAA,UAC/B;AACA,kBAAQ,KAAK,2BAA2B,IAAI;AAAA,QAChD;AAAA,MACJ,SAAS,OAAO;AACZ,gBAAQ,KAAK,KAAK;AAClB,YAAI,KAAK;AACL,UAAAA,kBAAiB,KAAK,KAAK;AAAA,QAC/B;AACA,cAAM,mEAAmE;AAAA,MAC7E;AAAA,IACJ;AAAA,IAEA,MAAc,qBAAqB,aAAyC;AACxE,YAAM,MAAM,GAAG,SAAS,MAAM;AAC9B,YAAM,eAAe,GAAG,SAAS,MAAM;AACvC,YAAM,MAAO,SAAS,cAAc,mBAAmB,KAAqB;AAC5E,YAAM,aAAa,IAAI,IAAI,SAAS,IAAI;AAExC,UAAI,KAAK;AACL,QAAAA,kBAAiB,KAAK,IAAI;AAAA,MAC9B;AAEA,UAAI;AACA,cAAM,UAA0B;AAAA,UAC5B,WAAWF,eAAc,WAAW;AAAA,UACpC,aAAaA,eAAc,aAAa;AAAA,QAC5C;AAEA,cAAM,WAAW,MAAM,QAAqB,KAAK,OAAO;AACxD,cAAM,OAAO,UAAU,QAAQ;AAE/B,YAAI,KAAK,YAAY,GAAG;AACpB,cAAI,KAAK;AACL,mCAAuB,KAAK,MAAM,eAAe,aAAa;AAAA,UAClE;AAGA,gBAAM,SAAS,SAAS,eAAe,aAAa;AACpD,cAAI,OAAQ,QAAO,QAAQ;AAG3B,gBAAM,YAAY,SAAS,eAAe,YAAY;AACtD,cAAI,WAAW;AACX,kBAAM,UAAU,GAAG,YAAY,cAAc,mBAAmB,QAAQ,SAAS,CAAC;AAClF,gBAAI;AACA,oBAAM,gBAAgB,MAAM,MAAM,SAAS;AAAA,gBACvC,OAAO;AAAA,gBACP,aAAa;AAAA,cACjB,CAAC;AACD,oBAAM,OAAO,MAAM,cAAc,KAAK;AAGtC,kBAAI,QAAQ,CAAC,KAAK,SAAS,WAAW,KAAK,CAAC,KAAK,SAAS,OAAO,GAAG;AAEhE,0BAAU,cAAc;AACxB,sBAAM,SAAS,IAAI,UAAU;AAC7B,oBAAI;AACA,wBAAM,MAAM,OAAO,gBAAgB,MAAM,WAAW;AAEpD,sBAAI,OAAO,IAAI,MAAM;AACjB,0BAAM,WAAW,SAAS,uBAAuB;AACjD,2BAAO,IAAI,KAAK,YAAY;AACxB,+BAAS,YAAY,IAAI,KAAK,UAAU;AAAA,oBAC5C;AACA,8BAAU,YAAY,QAAQ;AAAA,kBAClC;AAAA,gBACJ,SAAS,GAAG;AACR,0BAAQ,MAAM,uBAAuB,CAAC;AACtC,4BAAU,cAAc;AAAA,gBAC5B;AAAA,cACJ,OAAO;AACH,wBAAQ,KAAK,mEAAmE;AAChF,uBAAO,SAAS,OAAO;AACvB;AAAA,cACJ;AAAA,YACJ,SAAS,WAAW;AAChB,sBAAQ,MAAM,4BAA4B,SAAS;AAEnD,qBAAO,SAAS,OAAO;AACvB;AAAA,YACJ;AAAA,UACJ;AAGA,qBAAW,MAAM;AACb,gBAAI,KAAK;AACL,cAAAE,kBAAiB,KAAK,OAAO,yDAAyD;AAAA,YAC1F;AAAA,UACJ,GAAG,GAAI;AAAA,QACX,OAAO;AAEH,eAAK,sBAAsB;AAE3B,cAAI,KAAK,mBAAmB;AACxB,iBAAK,qBAAqB,KAAK,iBAAiB;AAAA,UACpD;AAEA,cAAI,KAAK;AACL,YAAAA,kBAAiB,KAAK,KAAK;AAAA,UAC/B;AAAA,QACJ;AAAA,MACJ,SAAS,OAAO;AACZ,gBAAQ,KAAK,KAAK;AAClB,YAAI,KAAK;AACL,UAAAA,kBAAiB,KAAK,KAAK;AAAA,QAC/B;AACA,cAAM,sEAAsE;AAAA,MAChF;AAAA,IACJ;AAAA,IAEA,MAAc,uBAAuB,WAAuC;AACxE,YAAM,SAAS,UAAU,aAAa,cAAc;AACpD,UAAI,CAAC,QAAQ;AACT,gBAAQ,MAAM,mCAAmC;AACjD;AAAA,MACJ;AAGA,UAAI,CAAC,QAAQ,4CAA4C,GAAG;AACxD;AAAA,MACJ;AAEA,YAAM,MAAM,GAAG,SAAS,MAAM;AAC9B,YAAM,eAAe,UAAU;AAE/B,UAAI;AAEA,kBAAU,cAAc;AACxB,cAAM,UAAU,SAAS,cAAc,GAAG;AAC1C,gBAAQ,YAAY;AACpB,kBAAU,YAAY,OAAO;AAC7B,QAAC,UAAgC,WAAW;AAG5C,cAAM,WAAW,MAAM,MAAM,GAAG,GAAG,YAAY,mBAAmB,MAAM,CAAC,IAAI;AAAA,UACzE,QAAQ;AAAA,UACR,aAAa;AAAA,QACjB,CAAC;AAED,YAAI,SAAS,IAAI;AACb,gBAAM,OAAO,MAAM,SAAS,KAAK;AACjC,cAAI,KAAK,YAAY,GAAG;AAEpB,kBAAM,YAAY,UAAU,QAAQ,QAAQ;AAC5C,gBAAI,WAAW;AACX,wBAAU,OAAO;AAAA,YACrB;AAAA,UACJ,OAAO;AAEH,sBAAU,YAAY;AACtB,YAAC,UAAgC,WAAW;AAC5C,kBAAM,KAAK,WAAW,0CAA0C;AAAA,UACpE;AAAA,QACJ,OAAO;AAEH,gBAAM,eAAe,MAAM,SAAS,KAAK;AACzC,kBAAQ,MAAM,kCAAkC;AAAA,YAC5C,QAAQ,SAAS;AAAA,YACjB,YAAY,SAAS;AAAA,YACrB,MAAM,aAAa,UAAU,GAAG,GAAG;AAAA,UACvC,CAAC;AAED,oBAAU,YAAY;AACtB,UAAC,UAAgC,WAAW;AAC5C,gBAAM,0CAA0C;AAAA,QACpD;AAAA,MACJ,SAAS,OAAO;AACZ,gBAAQ,MAAM,6BAA6B,KAAK;AAEhD,kBAAU,YAAY;AACtB,QAAC,UAAgC,WAAW;AAC5C,cAAM,8DAA8D;AAAA,MACxE;AAAA,IACJ;AAAA,IAEQ,wBAA8B;AAClC,eAAS,iBAAiB,gBAAgB,EAAE,QAAQ,WAAS;AACzD,cAAM,UAAU,OAAO,OAAO;AAAA,MAClC,CAAC;AAAA,IACL;AAAA,IAEQ,qBAAqB,kBAAkD;AAC3E,aAAO,QAAQ,gBAAgB,EAAE,QAAQ,CAAC,CAAC,KAAK,MAAM,MAAM;AACxD,cAAM,UAAU,SAAS,eAAe,GAAG;AAC3C,YAAI,SAAS,eAAe;AACxB,kBAAQ,cAAc,UAAU,IAAI,WAAW;AAAA,QACnD;AAAA,MACJ,CAAC;AAAA,IACL;AAAA,IAEA,MAAc,sBAAsB,OAAmC;AACnE,YAAM,eAAe;AAErB,YAAM,OAAO,MAAM;AACnB,YAAM,eAAe,KAAK,cAAc,uBAAuB;AAC/D,YAAM,eAAe,cAAc;AAEnC,UAAI,cAAc;AACd,QAAAA,kBAAiB,cAAc,IAAI;AAAA,MACvC;AAGA,UAAI,cAAc;AACd,qBAAa,cAAc;AAC3B,cAAM,YAAY,SAAS,cAAc,GAAG;AAC5C,kBAAU,YAAY;AACtB,qBAAa,YAAY,SAAS;AAAA,MACtC;AAGA,YAAM,QAAQ,SAAS,eAAe,iBAAiB,KAAK,SAAS,eAAe,kBAAkB;AACtG,UAAI,OAAO;AACP,cAAM,iBAAkB,OAAe,WAAW,OAAO,YAAY,KAAK;AAC1E,YAAI,gBAAgB;AAChB,yBAAe,KAAK;AAAA,QACxB;AAAA,MACJ;AAIA,iBAAW,MAAM;AACb,aAAK,OAAO;AAAA,MAChB,GAAG,GAAG;AAAA,IACV;AAAA,IAEA,MAAc,wBAAwB,OAAmC;AACrE,YAAM,eAAe;AAErB,YAAM,OAAO,MAAM;AACnB,YAAM,eAAe,KAAK,cAAc,uBAAuB;AAC/D,YAAM,eAAe,cAAc;AAEnC,UAAI,cAAc;AACd,QAAAA,kBAAiB,cAAc,IAAI;AAAA,MACvC;AAGA,UAAI,cAAc;AACd,qBAAa,cAAc;AAC3B,cAAM,YAAY,SAAS,cAAc,GAAG;AAC5C,kBAAU,YAAY;AACtB,qBAAa,YAAY,SAAS;AAAA,MACtC;AAGA,YAAM,QAAQ,SAAS,eAAe,eAAe,KAAK,SAAS,eAAe,kBAAkB;AACpG,UAAI,OAAO;AACP,cAAM,iBAAkB,OAAe,WAAW,OAAO,YAAY,KAAK;AAC1E,YAAI,gBAAgB;AAChB,yBAAe,KAAK;AAAA,QACxB;AAAA,MACJ;AAIA,iBAAW,MAAM;AACb,aAAK,OAAO;AAAA,MAChB,GAAG,GAAG;AAAA,IACV;AAAA,EACJ;;;ACjXA,WAASC,kBAAiB,QAAqB,WAAoB,cAA6B;AAC5F,QAAI,WAAW;AACX,aAAO,YAAY;AACnB,MAAC,OAA6B,WAAW;AAAA,IAC7C,OAAO;AACH,aAAO,YACH,gBAAgB;AACpB,MAAC,OAA6B,WAAW;AAAA,IAC7C;AAAA,EACJ;AAGA,WAASC,eAAc,IAAoB;AACvC,UAAM,UAAU,SAAS,eAAe,EAAE;AAC1C,WAAO,SAAS,SAAS;AAAA,EAC7B;AAGO,MAAM,iBAAN,MAAqB;AAAA,IACxB,cAAc;AACV,WAAK,mBAAmB;AAAA,IAC5B;AAAA,IAEQ,qBAA2B;AAC/B,eAAS,iBAAiB,SAAS,KAAK,YAAY,KAAK,IAAI,GAAG,IAAI;AACpE,eAAS,iBAAiB,UAAU,KAAK,aAAa,KAAK,IAAI,GAAG,IAAI;AAGtE,WAAK,0BAA0B;AAAA,IACnC;AAAA,IAEQ,aAAa,OAAoB;AACrC,YAAM,SAAS,MAAM;AAGrB,YAAM,YAAY,OAAO,QAAQ,iCAAiC;AAClE,UAAI,WAAW;AACX,aAAK,0BAA0B,UAAU,OAAO;AAChD;AAAA,MACJ;AAGA,YAAM,iBAAiB,OAAO,QAAQ,mBAAmB;AACzD,UAAI,gBAAgB;AAChB,aAAK,sBAAsB;AAC3B;AAAA,MACJ;AAAA,IACJ;AAAA,IAEQ,YAAY,OAAoB;AACpC,YAAM,SAAS,MAAM;AAGrB,YAAM,aAAa,YAAY,QAAQ,mBAAmB;AAC1D,UAAI,YAAY;AACZ,aAAK,iBAAiB;AACtB;AAAA,MACJ;AAGA,YAAM,YAAY,YAAY,QAAQ,yBAAyB;AAC/D,UAAI,WAAW;AACX,aAAK,sBAAsB;AAC3B;AAAA,MACJ;AAGA,YAAM,kBAAkB;AAAA,QACpB;AAAA,QACA;AAAA,MACJ;AACA,UAAI,iBAAiB;AACjB,aAAK,8BAA8B,eAAe;AAClD;AAAA,MACJ;AAGA,YAAM,qBACF,YAAyB,QAAQ,2BAA2B,KAC5D,YAAyB,QAAQ,2BAA2B;AAChE,UAAI,oBAAoB;AACpB,aAAK,yBAAyB,kBAAkB;AAChD;AAAA,MACJ;AAGA,YAAM,eAAe,YAAyB,QAAQ,kCAAkC;AACxF,UAAI,cAAc;AACd,aAAK,2BAA2B,YAAY;AAC5C;AAAA,MACJ;AAGA,YAAM,WACF,YAAyB,QAAQ,qBAAqB,KACtD,YAAyB,QAAQ,qBAAqB;AAC1D,UAAI,UAAU;AACV,aAAK,wBAAwB,QAAQ;AACrC;AAAA,MACJ;AAGA,YAAM,eAAe,YAAyB,QAAQ,iBAAiB;AACvE,UAAI,cAAc;AACd,cAAM,eAAe;AACrB,aAAK,oBAAoB,YAAY;AACrC;AAAA,MACJ;AAGA,YAAM,gBAAgB,YAAyB,QAAQ,wCAAwC;AAC/F,UAAI,eAAe;AACf,aAAK,gBAAgB,IAAI;AACzB;AAAA,MACJ;AAGA,YAAM,mBAAmB,YAAyB,QAAQ,2CAA2C;AACrG,UAAI,kBAAkB;AAClB,aAAK,gBAAgB,KAAK;AAC1B;AAAA,MACJ;AAGA,YAAM,qBAAqB,YAAyB,QAAQ,8CAA8C;AAC1G,UAAI,oBAAoB;AACpB,aAAK,mBAAmB,IAAI;AAC5B;AAAA,MACJ;AAGA,YAAM,wBAAwB,YAAyB,QAAQ,iDAAiD;AAChH,UAAI,uBAAuB;AACvB,aAAK,mBAAmB,KAAK;AAC7B;AAAA,MACJ;AAGA,YAAM,iBAAiB,YAAyB,QAAQ,yCAAyC;AACjG,UAAI,gBAAgB;AAChB,aAAK,iBAAiB,IAAI;AAC1B;AAAA,MACJ;AAGA,YAAM,oBAAoB,YAAyB,QAAQ,4CAA4C;AACvG,UAAI,mBAAmB;AACnB,aAAK,iBAAiB,KAAK;AAC3B;AAAA,MACJ;AAGA,YAAM,gBAAgB,YAAyB,QAAQ,2BAA2B;AAClF,UAAI,eAAe;AACf,aAAK,oBAAoB;AACzB;AAAA,MACJ;AAGA,YAAM,cAAc,YAAyB,QAAQ,oBAAoB;AACzE,UAAI,aAAa;AACb,aAAK,kBAAkB;AACvB;AAAA,MACJ;AAGA,YAAM,aAAa,YAAyB,QAAQ,uBAAuB;AAC3E,UAAI,YAAY;AACZ,aAAK,wBAAwB;AAC7B;AAAA,MACJ;AAGA,YAAM,aAAa,YAAyB,QAAQ,kBAAkB;AACtE,UAAI,YAAY;AACZ,aAAK,uBAAuB,UAAU;AACtC;AAAA,MACJ;AAAA,IACJ;AAAA,IAEQ,uBAAiC;AACrC,YAAM,WAAqB,CAAC;AAC5B,YAAM,QAAQ,SAAS,eAAe,eAAe;AAErD,UAAI,CAAC,MAAO,QAAO;AAEnB,YAAM,aAAa,MAAM;AAAA,QACrB;AAAA,MACJ;AACA,iBAAW,QAAQ,cAAY;AAC3B,YAAI,SAAS,IAAI;AACb,mBAAS,KAAK,SAAS,EAAE;AAAA,QAC7B;AAAA,MACJ,CAAC;AAED,aAAO;AAAA,IACX;AAAA,IAEA,MAAc,mBAAkC;AAC5C,YAAM,MAAM,SAAS,eAAe,kBAAkB;AACtD,YAAM,eAAe,KAAK;AAE1B,UAAI,KAAK;AACL,QAAAD,kBAAiB,KAAK,IAAI;AAAA,MAC9B;AAEA,UAAI;AACA,cAAM,WAAW,KAAK,qBAAqB;AAC3C,cAAM,MAAM,GAAG,SAAS,MAAM;AAE9B,cAAM,WAAW,MAAM,QAAqB,KAAK,EAAE,SAAS,SAAS,CAAC;AACtE,cAAM,OAAO,UAAU,QAAQ;AAE/B,YAAI,KAAK,YAAY,GAAG;AACpB,cAAI,IAAK,KAAI,YAAY;AACzB,iBAAO,SAAS,OAAO;AAAA,QAC3B,OAAO;AACH,cAAI,IAAK,KAAI,YAAY;AACzB,iBAAO,SAAS,OAAO;AAAA,QAC3B;AAAA,MACJ,SAAS,OAAO;AACZ,gBAAQ,MAAM,sBAAsB,KAAK;AACzC,YAAI,OAAO,cAAc;AACrB,UAAAA,kBAAiB,KAAK,OAAO,YAAY;AAAA,QAC7C;AACA,cAAM,6CAA6C;AAAA,MACvD;AAAA,IACJ;AAAA,IAEA,MAAc,wBAAuC;AACjD,YAAM,MAAM,SAAS,eAAe,wBAAwB;AAC5D,YAAM,eAAe,KAAK;AAE1B,UAAI,KAAK;AACL,QAAAA,kBAAiB,KAAK,IAAI;AAAA,MAC9B;AAEA,UAAI;AACA,cAAM,WAAW,KAAK,qBAAqB;AAC3C,cAAM,MAAM,GAAG,SAAS,MAAM;AAE9B,cAAM,WAAW,MAAM,QAAqB,KAAK,EAAE,SAAS,SAAS,CAAC;AACtE,cAAM,OAAO,UAAU,QAAQ;AAE/B,YAAI,KAAK,YAAY,GAAG;AACpB,cAAI,IAAK,KAAI,YAAY;AACzB,iBAAO,SAAS,OAAO;AAAA,QAC3B,OAAO;AACH,cAAI,IAAK,KAAI,YAAY;AACzB,iBAAO,SAAS,OAAO;AAAA,QAC3B;AAAA,MACJ,SAAS,OAAO;AACZ,gBAAQ,MAAM,4BAA4B,KAAK;AAC/C,YAAI,OAAO,cAAc;AACrB,UAAAA,kBAAiB,KAAK,OAAO,YAAY;AAAA,QAC7C;AACA,cAAM,6CAA6C;AAAA,MACvD;AAAA,IACJ;AAAA,IAEA,MAAc,8BAA8B,iBAA6C;AACrF,YAAM,MACD,SAAS,cAAc,oCAAoC,KAC5D;AACJ,YAAM,eAAe,KAAK;AAE1B,UAAI,KAAK;AACL,YAAI,YAAY;AAChB,QAAC,IAA0B,WAAW;AAAA,MAC1C;AAEA,UAAI;AAEA,cAAM,WAAW,KAAK,qBAAqB;AAE3C,YAAI,SAAS,WAAW,GAAG;AACvB,gBAAM,sDAAsD;AAC5D,cAAI,OAAO,cAAc;AACrB,gBAAI,YAAY;AAChB,YAAC,IAA0B,WAAW;AAAA,UAC1C;AACA;AAAA,QACJ;AAEA,cAAM,UAAgC;AAAA,UAClC,SAAS;AAAA,UACT,iBAAiBC,eAAc,iBAAiB;AAAA,UAChD,kBAAkBA,eAAc,kBAAkB;AAAA,UAClD,gBAAgBA,eAAc,gBAAgB;AAAA,QAClD;AAGA,YAAI,CAAC,QAAQ,mBAAmB,CAAC,QAAQ,kBAAkB;AACvD,gBAAM,yCAAyC;AAC/C,cAAI,OAAO,cAAc;AACrB,gBAAI,YAAY;AAChB,YAAC,IAA0B,WAAW;AAAA,UAC1C;AACA;AAAA,QACJ;AAEA,cAAM,MAAM,GAAG,SAAS,MAAM;AAC9B,cAAM,WAAW,MAAM,QAAqB,KAAK,OAAO;AACxD,cAAM,OAAO,UAAU,QAAQ;AAE/B,YAAI,KAAK,YAAY,GAAG;AACpB,cAAI,IAAK,KAAI,YAAY;AAGzB,eAAK,WAAW,2BAA2B;AAE3C,qBAAW,MAAM;AACb,mBAAO,SAAS,OAAO;AAAA,UAC3B,GAAG,GAAG;AAAA,QACV,OAAO;AACH,cAAI,IAAK,KAAI,YAAY;AAEzB,gBAAM,eAAe,KAAK,WAAW;AACrC,gBAAM,YAAY;AAClB,cAAI,OAAO,cAAc;AACrB,gBAAI,YAAY;AAChB,YAAC,IAA0B,WAAW;AAAA,UAC1C;AAAA,QACJ;AAAA,MACJ,SAAS,OAAO;AACZ,gBAAQ,MAAM,+BAA+B,KAAK;AAClD,YAAI,OAAO,cAAc;AACrB,cAAI,YAAY;AAChB,UAAC,IAA0B,WAAW;AAAA,QAC1C;AACA,cAAM,+EAA+E;AAAA,MACzF;AAAA,IACJ;AAAA,IAEA,MAAc,2BAA2B,cAA0C;AAC/E,YAAM,MACD,SAAS,cAAc,kCAAkC,KAC1D;AACJ,YAAM,eAAe,KAAK;AAE1B,UAAI,KAAK;AACL,YAAI,YAAY;AAChB,QAAC,IAA0B,WAAW;AAAA,MAC1C;AAEA,UAAI;AACA,cAAM,mBAAmBA,eAAc,oBAAoB;AAC3D,cAAM,WAAW,KAAK,qBAAqB;AAE3C,YAAI,SAAS,WAAW,GAAG;AACvB,gBAAM,iCAAiC;AACvC,cAAI,OAAO,cAAc;AACrB,gBAAI,YAAY;AAChB,YAAC,IAA0B,WAAW;AAAA,UAC1C;AACA;AAAA,QACJ;AAEA,cAAM,UAAoC;AAAA,UACtC,SAAS;AAAA,UACT,oBAAoB;AAAA,QACxB;AAEA,cAAM,MAAM,GAAG,SAAS,MAAM;AAC9B,cAAM,WAAW,MAAM,QAAqB,KAAK,OAAO;AACxD,cAAM,OAAO,UAAU,QAAQ;AAE/B,YAAI,KAAK,YAAY,GAAG;AACpB,cAAI,IAAK,KAAI,YAAY;AACzB,iBAAO,SAAS,OAAO;AAAA,QAC3B,OAAO;AACH,cAAI,IAAK,KAAI,YAAY;AACzB,iBAAO,SAAS,OAAO;AAAA,QAC3B;AAAA,MACJ,SAAS,OAAO;AACZ,gBAAQ,MAAM,sBAAsB,KAAK;AACzC,YAAI,OAAO,cAAc;AACrB,cAAI,YAAY;AAChB,UAAC,IAA0B,WAAW;AAAA,QAC1C;AACA,cAAM,6CAA6C;AAAA,MACvD;AAAA,IACJ;AAAA,IAEA,MAAc,oBAAoB,cAA0C;AACxE,YAAM,MAAM,SAAS,eAAe,gBAAgB;AACpD,YAAM,eAAe,KAAK;AAE1B,UAAI,KAAK;AACL,YAAI,YAAY;AAChB,YAAI,WAAW;AAAA,MACnB;AAEA,UAAI;AAEA,cAAM,aAAa,IAAI,IAAI,SAAS,IAAI;AACxC,cAAM,SAAS,WAAW,SAAS,MAAM,GAAG,EAAE,GAAG,EAAE,KAAK;AAExD,cAAM,UAA6B;AAAA,UAC/B;AAAA,UACA,iBAAiBA,eAAc,iBAAiB;AAAA,UAChD,sBAAsBA,eAAc,sBAAsB;AAAA,QAC9D;AAEA,cAAM,MAAM,GAAG,SAAS,MAAM;AAC9B,cAAM,WAAW,MAAM,QAAqB,KAAK,OAAO;AACxD,cAAM,OAAO,UAAU,QAAQ;AAE/B,YAAI,KAAK,YAAY,GAAG;AACpB,cAAI,IAAK,KAAI,YAAY;AAGzB,eAAK,WAAW,aAAa;AAE7B,qBAAW,MAAM;AACb,mBAAO,SAAS,OAAO;AAAA,UAC3B,GAAG,GAAG;AAAA,QACV,OAAO;AACH,cAAI,IAAK,KAAI,YAAY;AACzB,gBAAM,8CAA8C;AACpD,cAAI,OAAO,cAAc;AACrB,gBAAI,YAAY;AAChB,gBAAI,WAAW;AAAA,UACnB;AAAA,QACJ;AAAA,MACJ,SAAS,OAAO;AACZ,gBAAQ,MAAM,yBAAyB,KAAK;AAC5C,YAAI,OAAO,cAAc;AACrB,cAAI,YAAY;AAChB,cAAI,WAAW;AAAA,QACnB;AACA,cAAM,sEAAsE;AAAA,MAChF;AAAA,IACJ;AAAA,IAEA,MAAc,wBAAwB,UAAsC;AACxE,YAAM,MACD,SAAS,cAAc,qBAAqB,KAAqB;AACtE,YAAM,eAAe,KAAK;AAE1B,UAAI,KAAK;AACL,YAAI,YAAY;AAChB,QAAC,IAA0B,WAAW;AAAA,MAC1C;AAEA,UAAI;AACA,cAAM,cAAc,IAAI,IAAI,SAAS,IAAI;AACzC,cAAM,SAAS,YAAY,SAAS,MAAM,GAAG,EAAE,GAAG,EAAE,KAAK;AAEzD,cAAM,UAAiC;AAAA,UACnC;AAAA,UACA,WAAWA,eAAc,sBAAsB;AAAA,UAC/C,SAASA,eAAc,SAAS;AAAA,QACpC;AAEA,cAAM,MAAM,GAAG,SAAS,MAAM;AAC9B,cAAM,WAAW,MAAM,QAAqB,KAAK,OAAO;AACxD,cAAM,OAAO,UAAU,QAAQ;AAE/B,YAAI,KAAK,YAAY,GAAG;AACpB,cAAI,IAAK,KAAI,YAAY;AAGzB,cAAI,KAAK,gBAAgB;AACrB,mBAAO,SAAS,OAAO,GAAG,SAAS,MAAM,qBAAqB,KAAK,cAAc;AAAA,UACrF,OAAO;AAEH,mBAAO,SAAS,OAAO;AAAA,UAC3B;AAAA,QACJ,OAAO;AACH,cAAI,IAAK,KAAI,YAAY;AACzB,iBAAO,SAAS,OAAO;AAAA,QAC3B;AAAA,MACJ,SAAS,OAAO;AACZ,gBAAQ,MAAM,4BAA4B,KAAK;AAC/C,YAAI,OAAO,cAAc;AACrB,cAAI,YAAY;AAChB,UAAC,IAA0B,WAAW;AAAA,QAC1C;AACA,cAAM,6CAA6C;AAAA,MACvD;AAAA,IACJ;AAAA,IAEA,MAAc,yBAAyB,oBAAgD;AACnF,YAAM,MACD,SAAS,cAAc,2BAA2B,KACnD;AACJ,YAAM,eAAe,KAAK;AAE1B,UAAI,KAAK;AACL,YAAI,YAAY;AAChB,QAAC,IAA0B,WAAW;AAAA,MAC1C;AAEA,UAAI;AAEA,cAAM,WAAqB,CAAC;AAG5B,cAAM,aAAa,SAAS;AAAA,UACxB;AAAA,QACJ;AAEA,mBAAW,QAAQ,cAAY;AAC3B,cAAI,SAAS,OAAO;AAChB,qBAAS,KAAK,SAAS,KAAK;AAAA,UAChC;AAAA,QACJ,CAAC;AAGD,cAAM,aAAa,IAAI,IAAI,SAAS,IAAI;AACxC,cAAM,SAAS,WAAW,SAAS,MAAM,GAAG,EAAE,GAAG,EAAE,KAAK;AAExD,YAAI,SAAS,WAAW,GAAG;AACvB,gBAAM,gCAAgC;AACtC,cAAI,OAAO,cAAc;AACrB,gBAAI,YAAY;AAChB,YAAC,IAA0B,WAAW;AAAA,UAC1C;AACA;AAAA,QACJ;AAEA,cAAM,UAAkC;AAAA,UACpC,UAAU;AAAA,UACV;AAAA,QACJ;AAEA,cAAM,MAAM,GAAG,SAAS,MAAM;AAC9B,cAAM,WAAW,MAAM,QAAqB,KAAK,OAAO;AACxD,cAAM,OAAO,UAAU,QAAQ;AAE/B,YAAI,KAAK,YAAY,GAAG;AACpB,cAAI,IAAK,KAAI,YAAY;AAGzB,eAAK,WAAW,cAAc;AAE9B,qBAAW,MAAM;AACb,mBAAO,SAAS,OAAO;AAAA,UAC3B,GAAG,GAAG;AAAA,QACV,OAAO;AACH,cAAI,IAAK,KAAI,YAAY;AACzB,gBAAM,2CAA2C;AACjD,cAAI,OAAO,cAAc;AACrB,gBAAI,YAAY;AAChB,YAAC,IAA0B,WAAW;AAAA,UAC1C;AAAA,QACJ;AAAA,MACJ,SAAS,OAAO;AACZ,gBAAQ,MAAM,sBAAsB,KAAK;AACzC,YAAI,OAAO,cAAc;AACrB,cAAI,YAAY;AAChB,UAAC,IAA0B,WAAW;AAAA,QAC1C;AACA,cAAM,kEAAkE;AAAA,MAC5E;AAAA,IACJ;AAAA,IAEQ,gBAAgB,kBAAiC;AACrD,YAAM,WAAW,mBAAmB,MAAM;AAC1C,YAAM,MAAM,GAAG,SAAS,MAAM,oBAAoB,QAAQ;AAC1D,aAAO,KAAK,KAAK,QAAQ;AAAA,IAC7B;AAAA,IAEQ,mBAAmB,kBAAiC;AACxD,YAAM,WAAW,mBAAmB,MAAM;AAC1C,YAAM,MAAM,GAAG,SAAS,MAAM,oBAAoB,QAAQ;AAG1D,YAAM,SAAS,SAAS,eAAe,oBAAoB;AAC3D,UAAI,QAAQ;AACR,eAAO,MAAM;AAAA,MACjB;AAGA,UAAI;AACA,YAAI,OAAQ,OAAe,WAAW,UAAU,aAAa;AACzD,gBAAM,UAAU,SAAS,eAAe,4BAA4B;AACpE,cAAI,SAAS;AACT,kBAAM,QAAQ,IAAK,OAAe,UAAU,MAAM,OAAO;AACzD,kBAAM,KAAK;AAAA,UACf;AAAA,QACJ;AAAA,MACJ,SAAS,GAAG;AACR,gBAAQ,KAAK,6BAA6B,CAAC;AAAA,MAC/C;AAAA,IACJ;AAAA,IAEQ,iBAAiB,kBAAiC;AACtD,YAAM,WAAW,mBAAmB,MAAM;AAC1C,YAAM,MAAM,GAAG,SAAS,MAAM,qBAAqB,QAAQ;AAC3D,aAAO,KAAK,KAAK,QAAQ;AAAA,IAC7B;AAAA,IAEA,MAAc,sBAAqC;AAC/C,YAAM,MAAM,GAAG,SAAS,MAAM;AAC9B,YAAM,MAAM,SAAS,eAAe,0BAA0B;AAC9D,YAAM,eAAe,KAAK;AAE1B,UAAI,KAAK;AACL,YAAI,YAAY;AAChB,YAAI,WAAW;AAAA,MACnB;AAEA,UAAI;AAEA,cAAM,UAAU;AAAA;AAAA;AAAA,UAGZ,QAAQA,eAAc,gBAAgB;AAAA,UACtC,gBAAgBA,eAAc,gBAAgB;AAAA,UAC9C,cAAcA,eAAc,cAAc;AAAA;AAAA,QAE9C;AAEA,cAAM,WAAW,MAAM,QAAqB,KAAK,OAAO;AACxD,cAAM,OAAO,UAAU,QAAQ;AAE/B,YAAI,KAAK,YAAY,GAAG;AACpB,cAAI,IAAK,KAAI,YAAY;AAEzB,eAAK,WAAW,eAAe;AAC/B,qBAAW,MAAM;AACb,mBAAO,SAAS,OAAO;AAAA,UAC3B,GAAG,GAAG;AAAA,QACV,OAAO;AACH,cAAI,OAAO,cAAc;AACrB,gBAAI,YAAY;AAChB,gBAAI,WAAW;AAAA,UACnB;AACA,gBAAM,8CAA8C;AAAA,QACxD;AAAA,MACJ,SAAS,OAAO;AACZ,gBAAQ,MAAM,6BAA6B,KAAK;AAChD,YAAI,OAAO,cAAc;AACrB,cAAI,YAAY;AAChB,cAAI,WAAW;AAAA,QACnB;AACA,cAAM,sEAAsE;AAAA,MAChF;AAAA,IACJ;AAAA,IAEQ,oBAA0B;AAC9B,YAAM,aAAa,IAAI,IAAI,SAAS,IAAI;AACxC,YAAM,SAAS,WAAW,SAAS,MAAM,GAAG,EAAE,GAAG,EAAE,KAAK;AACxD,YAAM,MAAM,GAAG,SAAS,MAAM,wBAAwB,MAAM;AAG5D,YAAM,mBAAmB,SAAS,eAAe,2BAA2B;AAC5E,UAAI,kBAAkB;AAElB,cAAM,KAAK,EAAE,aAAa,cAAc,CAAC,EACpC,KAAK,cAAY,SAAS,KAAK,CAAC,EAChC,KAAK,UAAQ;AAEV,2BAAiB,cAAc;AAC/B,gBAAM,UAAU,SAAS,cAAc,KAAK;AAC5C,kBAAQ,cAAc;AAEtB,gBAAM,WAAW,SAAS,uBAAuB;AACjD,gBAAM,SAAS,IAAI,UAAU;AAC7B,cAAI;AACA,kBAAM,MAAM,OAAO,gBAAgB,MAAM,WAAW;AAEpD,gBAAI,OAAO,IAAI,MAAM;AACjB,qBAAO,IAAI,KAAK,YAAY;AACxB,yBAAS,YAAY,IAAI,KAAK,UAAU;AAAA,cAC5C;AACA,+BAAiB,YAAY,QAAQ;AAAA,YACzC;AAAA,UACJ,SAAS,GAAG;AACR,oBAAQ,MAAM,uBAAuB,CAAC;AACtC,6BAAiB,cAAc;AAAA,UACnC;AAAA,QACJ,CAAC,EACA,MAAM,WAAS;AACZ,kBAAQ,MAAM,iCAAiC,KAAK;AACpD,2BAAiB,cAAc;AAAA,QACnC,CAAC;AAAA,MACT;AAAA,IACJ;AAAA,IAEQ,0BAAgC;AAEpC,YAAM,SAAS,SAAS,eAAe,SAAS;AAChD,YAAM,YAAY,SAAS,eAAe,YAAY;AAEtD,UAAI,UAAU,WAAW;AACrB,cAAM,YAAY,OAAO,UAAU,IAAI;AACvC,kBAAU,gBAAgB,IAAI;AAC9B,kBAAU,UAAU,IAAI,MAAM;AAC9B,kBAAU,MAAM,UAAU;AAC1B,kBAAU,YAAY,SAAS;AAAA,MACnC;AAAA,IACJ;AAAA,IAEA,MAAc,uBAAuB,YAAwC;AACzE,YAAM,SAAS,WAAW,aAAa,SAAS;AAEhD,UAAI,CAAC,QAAQ;AAET,cAAM,UAAU,WAAW,QAAQ,OAAO;AAC1C,YAAI,SAAS;AACT,kBAAQ,OAAO;AAAA,QACnB;AACA;AAAA,MACJ;AAEA,UAAI;AACA,cAAM,MAAM,GAAG,SAAS,MAAM,4BAA4B,MAAM;AAChE,cAAM,WAAW,MAAM,QAAqB,KAAK,EAAE,IAAI,OAAO,CAAC;AAC/D,cAAM,OAAO,UAAU,QAAQ;AAE/B,YAAI,KAAK,YAAY,GAAG;AAEpB,gBAAM,UAAU,WAAW,QAAQ,OAAO;AAC1C,cAAI,SAAS;AACT,oBAAQ,OAAO;AAAA,UACnB;AACA,gBAAM,SAAS;AAEf,iBAAO,SAAS,OAAO;AAAA,QAC3B,OAAO;AACH,gBAAM,0CAA0C;AAAA,QACpD;AAAA,MACJ,SAAS,OAAO;AACZ,gBAAQ,MAAM,sBAAsB,KAAK;AACzC,cAAM,8DAA8D;AAAA,MACxE;AAAA,IACJ;AAAA,IAEQ,0BAA0B,SAAwB;AACtD,YAAM,aAAa,SAAS,iBAAiB,wBAAwB;AACrE,iBAAW,QAAQ,cAAY;AAC3B,iBAAS,UAAU;AAAA,MACvB,CAAC;AAAA,IACL;AAAA,IAEQ,4BAAkC;AACtC,WAAK,sBAAsB;AAAA,IAC/B;AAAA,IAEQ,wBAA8B;AAClC,YAAM,yBAAyB,SAAS,eAAe,kBAAkB;AACzE,YAAM,oBAAoB,SAAS,eAAe,aAAa;AAE/D,UAAI,0BAA0B,mBAAmB;AAC7C,YAAI,uBAAuB,SAAS;AAChC,4BAAkB,MAAM,UAAU;AAAA,QACtC,OAAO;AACH,4BAAkB,MAAM,UAAU;AAAA,QACtC;AAAA,MACJ;AAAA,IACJ;AAAA,IAEQ,WAAW,SAAuB;AACtC,UAAI;AACA,YAAI,OAAQ,OAAe,WAAW,UAAU,aAAa;AACzD,gBAAM,UAAU,SAAS,eAAe,OAAO;AAC/C,cAAI,SAAS;AACT,kBAAM,gBAAiB,OAAe,UAAU,MAAM,YAAY,OAAO;AACzE,gBAAI,eAAe;AACf,4BAAc,KAAK;AAAA,YACvB;AAAA,UACJ;AAAA,QACJ;AAAA,MACJ,SAAS,GAAG;AACR,gBAAQ,KAAK,0BAA0B,CAAC;AAAA,MAC5C;AAAA,IACJ;AAAA,EACJ;;;ACvwBA,WAASC,kBAAiB,SAAkC,WAA0B;AAClF,YAAQ,QAAQ,YAAU;AACtB,UAAI,WAAW;AACX,eAAO,YAAY;AAAA,MACvB,OAAO;AACH,eAAO,YAAY;AAAA,MACvB;AAAA,IACJ,CAAC;AAAA,EACL;AAEA,WAAS,eAAe,SAAwC;AAC5D,YAAQ,QAAQ,YAAU;AACtB,aAAO,YAAY;AAAA,IACvB,CAAC;AAAA,EACL;AAGO,MAAM,iBAAN,MAAqB;AAAA,IACxB,cAAc;AACV,WAAK,mBAAmB;AACxB,WAAK,sBAAsB;AAC3B,WAAK,qBAAqB;AAAA,IAC9B;AAAA,IAEQ,qBAA2B;AAC/B,eAAS,iBAAiB,SAAS,KAAK,YAAY,KAAK,IAAI,GAAG,IAAI;AAAA,IACxE;AAAA,IAEQ,YAAY,OAAoB;AACpC,YAAM,SAAS,MAAM;AAErB,UAAI,OAAO,QAAQ,yBAAyB,GAAG;AAC3C,aAAK,qBAAqB,KAAK;AAC/B;AAAA,MACJ;AAEA,UAAI,OAAO,QAAQ,6BAA6B,GAAG;AAC/C,cAAM,eAAe;AACrB,aAAK,mBAAmB;AACxB;AAAA,MACJ;AAEA,UAAI,OAAO,QAAQ,2BAA2B,GAAG;AAC7C,cAAM,eAAe;AACrB,aAAK,qBAAqB;AAC1B;AAAA,MACJ;AAGA,YAAM,aAAa,OAAO,QAAQ,UAAU;AAC5C,UAAI,cAAc,OAAO,YAAY,SAAS;AAC1C,cAAM,WAAW,WAAW,cAAc,wBAAwB;AAClE,YAAI,UAAU;AACV,mBAAS,MAAM;AAAA,QACnB;AACA;AAAA,MACJ;AAGA,UAAI,OAAO,QAAQ,6BAA6B,GAAG;AAC/C,aAAK,mBAAmB;AAAA,MAC5B;AAAA,IACJ;AAAA,IAEQ,uBAA6B;AAEjC,UAAI,OAAQ,OAAe,cAAc,aAAa;AAClD,iBAAS,iBAAiB,gBAAgB,EAAE,QAAQ,CAAC,OAAgB;AACjE,cAAI,CAAE,GAAW,YAAY;AACzB,gBAAK,OAAe,UAAU,IAAI,CAAC,CAAC;AACpC,YAAC,GAAW,aAAa;AAAA,UAC7B;AAAA,QACJ,CAAC;AAAA,MACL;AACA,WAAK,mBAAmB;AAAA,IAC5B;AAAA,IAEQ,qBAA2B;AAC/B,YAAM,gBAAgB,SAAS,iBAAiB,qCAAqC;AACrF,YAAM,aAAa,cAAc,SAAS;AAE1C,YAAM,WAAW,SAAS,cAAc,6BAA6B;AACrE,YAAM,SAAS,SAAS,cAAc,2BAA2B;AAEjE,UAAI,UAAU;AACV,iBAAS,WAAW,CAAC;AAAA,MACzB;AACA,UAAI,QAAQ;AACR,eAAO,WAAW,CAAC;AAAA,MACvB;AAAA,IACJ;AAAA;AAAA;AAAA;AAAA,IAKO,mBAAyB;AAC5B,YAAM,UAAU,SAAS,eAAe,oBAAoB;AAC5D,UAAI,CAAC,QAAS;AAEd,YAAM,QAAQ,QAAQ,SAAS;AAC/B,YAAM,SAAS,MAAM,YAAY;AACjC,YAAM,QAAQ,SAAS,eAAe,eAAe;AAErD,UAAI,CAAC,MAAO;AAEZ,YAAM,OAAO,MAAM,qBAAqB,IAAI;AAG5C,eAAS,IAAI,GAAG,IAAI,KAAK,QAAQ,KAAK;AAElC,cAAM,OAAO,KAAK,CAAC,EAAE,qBAAqB,IAAI,EAAE,CAAC;AAEjD,YAAI,MAAM;AACN,gBAAM,YAAY,KAAK,eAAe,KAAK,aAAa;AAExD,cAAI,UAAU,YAAY,EAAE,QAAQ,MAAM,IAAI,IAAI;AAC9C,YAAC,KAAK,CAAC,EAA0B,MAAM,UAAU;AAAA,UACrD,OAAO;AACH,YAAC,KAAK,CAAC,EAA0B,MAAM,UAAU;AAAA,UACrD;AAAA,QACJ;AAAA,MACJ;AAAA,IACJ;AAAA;AAAA;AAAA;AAAA,IAKA,MAAc,qBAAqB,OAA6B;AAC5D,UAAI,OAAO,gBAAgB;AACvB,cAAM,eAAe;AAAA,MACzB;AAEA,YAAM,MAAM,GAAG,SAAS,MAAM;AAC9B,YAAM,UAAU,SAAS;AAAA,QACrB;AAAA,MACJ;AAGA,MAAAA,kBAAiB,SAAS,IAAI;AAE9B,UAAI;AACA,cAAM,kBAAkB,SAAS;AAAA,UAC7B;AAAA,QACJ;AACA,cAAM,aAAa,iBAAiB,SAAS;AAE7C,cAAM,UAA6B;AAAA,UAC/B,aAAa;AAAA,QACjB;AAEA,cAAM,WAAW,MAAM,QAA+B,KAAK,OAAO;AAClE,cAAM,OAAO,UAAU,QAAQ;AAE/B,YAAI,KAAK,YAAY,GAAG;AACpB,eAAK,iBAAiB;AACtB,eAAK,eAAe;AACpB,UAAAA,kBAAiB,SAAS,KAAK;AAAA,QACnC,OAAO;AACH,yBAAe,OAAO;AACtB,cAAI,KAAK,SAAS;AACd,kBAAM,KAAK,OAAO;AAAA,UACtB;AAAA,QACJ;AAAA,MACJ,SAAS,OAAO;AACZ,gBAAQ,MAAM,yBAAyB,KAAK;AAC5C,uBAAe,OAAO;AACtB,cAAM,sEAAsE;AAAA,MAChF;AAAA,IACJ;AAAA;AAAA;AAAA;AAAA,IAKQ,iBAAuB;AAC3B,YAAM,UAAU,SAAS,cAAc,6BAA6B;AACpE,UAAI,SAAS;AACT,gBAAQ,MAAM,aAAa;AAAA,MAC/B;AAAA,IACJ;AAAA,IAEA,MAAc,qBAAoC;AAC9C,YAAM,cAAc,IAAI,IAAI,OAAO,SAAS,IAAI;AAChD,YAAM,MAAM,SAAS,cAAc,6BAA6B;AAChE,WAAK,uBAAuB,KAAK,MAAM,eAAe,uBAAuB;AAE7E,YAAM,aAAuB,CAAC;AAC9B,YAAM,WAAW,YAAY,SAAS,MAAM,GAAG,EAAE,GAAG,EAAE,KAAK,IAAI,QAAQ,WAAW,EAAE;AAEpF,eAAS,iBAAiB,qCAAqC,EAAE,QAAQ,CAAC,UAAmB;AACzF,cAAM,QAAQ,SAAU,MAA2B,KAAK;AACxD,YAAI,CAAC,MAAM,KAAK,GAAG;AACf,qBAAW,KAAK,KAAK;AAAA,QACzB;AAAA,MACJ,CAAC;AAGD,YAAM,mBAAmB,WAAW,SAAS,CAAC,GAAG,MAAM,IAAI,CAAC;AAC5D,cAAQ,IAAI,wCAAwC,gBAAgB;AAEpE,UAAI,MAAM,6CAA6C,OAAO;AAC9D,uBAAiB,QAAQ,QAAM;AAC3B,eAAO,kBAAkB,EAAE;AAAA,MAC/B,CAAC;AAED,UAAI;AACA,cAAM,WAAW,MAAM,MAAM,KAAK;AAAA,UAC9B,QAAQ;AAAA,UACR,SAAS;AAAA,YACL,gBAAgB;AAAA,YAChB,oBAAoB;AAAA,UACxB;AAAA,QACJ,CAAC;AAED,cAAM,OAAO,MAAM,SAAS,KAAK;AACjC,aAAK,gBAAgB,IAAI;AACzB,aAAK,uBAAuB,KAAK,MAAM,eAAe,aAAa;AACnE,eAAO,SAAS,OAAO;AAAA,MAC3B,SAAS,OAAO;AACZ,gBAAQ,MAAM,UAAU,KAAK;AAC7B,aAAK,uBAAuB,KAAK,MAAM,eAAe,aAAa;AAAA,MACvE;AAAA,IACJ;AAAA,IAEA,MAAc,uBAAsC;AAChD,YAAM,cAAc,IAAI,IAAI,OAAO,SAAS,IAAI;AAChD,YAAM,MAAM,SAAS,cAAc,2BAA2B;AAC9D,WAAK,uBAAuB,KAAK,MAAM,eAAe,uBAAuB;AAE7E,YAAM,aAAuB,CAAC;AAC9B,YAAM,QAAQ,YAAY,SAAS,MAAM,GAAG,EAAE,GAAG,EAAE,KAAK;AAExD,eAAS,iBAAiB,qCAAqC,EAAE,QAAQ,CAAC,UAAmB;AACzF,cAAM,QAAQ,SAAU,MAA2B,KAAK;AACxD,YAAI,CAAC,MAAM,KAAK,GAAG;AACf,qBAAW,KAAK,KAAK;AAAA,QACzB;AAAA,MACJ,CAAC;AAGD,YAAM,mBAAmB,WAAW,SAAS,CAAC,GAAG,MAAM,IAAI,CAAC;AAE5D,UAAI,MAAM,yCAAyC,KAAK;AACxD,uBAAiB,QAAQ,QAAM;AAC3B,eAAO,kBAAkB,EAAE;AAAA,MAC/B,CAAC;AAED,UAAI;AACA,cAAM,WAAW,MAAM,MAAM,KAAK;AAAA,UAC9B,QAAQ;AAAA,UACR,SAAS;AAAA,YACL,gBAAgB;AAAA,YAChB,oBAAoB;AAAA,UACxB;AAAA,QACJ,CAAC;AAED,cAAM,OAAO,MAAM,SAAS,KAAK;AACjC,aAAK,gBAAgB,IAAI;AACzB,aAAK,uBAAuB,KAAK,MAAM,eAAe,aAAa;AACnE,eAAO,SAAS,OAAO;AAAA,MAC3B,SAAS,OAAO;AACZ,gBAAQ,MAAM,UAAU,KAAK;AAC7B,aAAK,uBAAuB,KAAK,MAAM,eAAe,aAAa;AAAA,MACvE;AAAA,IACJ;AAAA,IAEQ,gBAAgB,UAA0C;AAC9D,cAAQ,IAAI,cAAc,OAAO,KAAK,QAAQ,EAAE,QAAQ,UAAU;AAGlE,YAAM,oBAAoB,OAAO;AAAA,QAC7B,OAAO,QAAQ,QAAQ,EAAE,IAAI,CAAC,CAAC,KAAK,OAAO,OAAO,EAAE,KAAK,GAAG,QAAQ,EAAE;AAAA,QACtE,CAAC,YAAY,QAAQ,eAAe;AAAA,MACxC;AACA,cAAQ,IAAI,iCAAiC,OAAO,KAAK,iBAAiB,CAAC;AAG3E,iBAAW,OAAO,UAAU;AACxB,gBAAQ,IAAI,2BAA2B,GAAG;AAE1C,cAAM,UAAU,SAAS,GAAG;AAC5B,YAAI,CAAC,WAAW,OAAO,YAAY,SAAU;AAE7C,cAAM,mBAAmB,QAAQ;AACjC,YAAI;AAEJ,YAAI,CAAC,kBAAkB;AACnB,gBAAM,mBAAmB,SAAS,eAAe,uBAAuB;AACxE,oCAA0B,mBAAmB,iBAAiB,aAAa,OAAO,KAAK,KAAK;AAAA,QAChG,OAAO;AACH,oCAA0B;AAAA,QAC9B;AAGA,cAAM,cAAc,SAAS,cAAc,gCAAgC;AAE3E,YAAI,aAAa;AACb,gBAAM,WAAW,YAAY,cAAc,uBAAuB;AAClE,cAAI,SAAU,UAAS,QAAQ,QAAQ;AAEvC,gBAAM,WAAW,YAAY,cAAc,iCAAiC;AAC5E,cAAI,SAAU,UAAS,QAAQ,QAAQ;AAEvC,gBAAM,YAAY,YAAY,cAAc,wBAAwB;AACpE,cAAI,UAAW,WAAU,QAAQ,QAAQ;AAEzC,gBAAM,UAAU,YAAY,cAAc,2BAA2B;AACrE,cAAI,QAAS,SAAQ,QAAQ;AAE7B,gBAAM,cAAc,YAAY,cAAc,+BAA+B;AAC7E,cAAI,YAAa,aAAY,QAAQ;AAErC,gBAAM,gBAAgB,YAAY,cAAc,6BAA6B;AAC7E,cAAI,cAAe,eAAc,QAAQ,QAAQ;AAEjD,gBAAM,aAAa,YAAY,cAAc,mCAAmC;AAChF,cAAI,WAAY,YAAW,QAAQ,QAAQ;AAAA,QAC/C;AAAA,MACJ;AAAA,IACJ;AAAA,IAEQ,uBAAuB,QAAqB,SAAiB,WAAmB,WAAyB;AAC7G,UAAI,CAAC,OAAQ;AAGb,aAAO,OAAO,YAAY;AACtB,eAAO,YAAY,OAAO,UAAU;AAAA,MACxC;AAGA,YAAM,UAAU,SAAS,cAAc,OAAO;AAC9C,UAAI,UAAW,SAAQ,YAAY;AAEnC,YAAM,OAAO,SAAS,cAAc,GAAG;AACvC,UAAI,UAAW,MAAK,YAAY;AAEhC,cAAQ,YAAY,IAAI;AACxB,aAAO,YAAY,OAAO;AAAA,IAC9B;AAAA;AAAA;AAAA;AAAA,IAKQ,wBAA8B;AAElC,MAAC,OAAe,qBAAqB,KAAK,iBAAiB,KAAK,IAAI;AAAA,IACxE;AAAA,EACJ;;;AChXO,MAAM,cAAN,MAAkB;AAAA,IACrB,cAAc;AACV,WAAK,mBAAmB;AACxB,WAAK,qBAAqB;AAAA,IAC9B;AAAA,IAEQ,qBAA2B;AAE/B,eAAS,iBAAiB,SAAS,KAAK,YAAY,KAAK,IAAI,GAAG,IAAI;AAGpE,eAAS,iBAAiB,UAAU,KAAK,aAAa,KAAK,IAAI,GAAG,IAAI;AAGtE,eAAS,iBAAiB,WAAW,KAAK,cAAc,KAAK,IAAI,GAAG,IAAI;AAGxE,eAAS,iBAAiB,kBAAkB,KAAK,iBAAiB,KAAK,IAAI,GAAG,IAAI;AAAA,IACtF;AAAA,IAEQ,YAAY,OAAoB;AACpC,YAAM,SAAS,MAAM;AAGrB,YAAM,UAAU,OAAO,QAAQ,mCAAmC;AAClE,UAAI,SAAS;AACT,aAAK,eAAe,KAAK;AACzB;AAAA,MACJ;AAGA,YAAM,cAAc,OAAO,QAAQ,8FAA8F;AACjI,UAAI,aAAa;AACb,aAAK,6BAA6B,WAA0B;AAC5D;AAAA,MACJ;AAGA,YAAM,cAAc,OAAO,QAAQ,wBAAwB;AAC3D,UAAI,aAAa;AACb,aAAK,gBAAgB;AACrB;AAAA,MACJ;AAAA,IACJ;AAAA,IAEQ,aAAa,OAAoB;AACrC,YAAM,SAAS,MAAM;AAErB,UAAI,OAAO,QAAQ,0BAA0B,GAAG;AAC5C,cAAM,YAAY,OAAO,QAAQ,cAAc,KAAK;AACpD,aAAK,4BAA4B,SAAS;AAAA,MAC9C;AAAA,IACJ;AAAA,IAEQ,cAAc,OAA4B;AAC9C,UAAI,MAAM,QAAQ,SAAS;AACvB,cAAM,SAAS,SAAS;AACxB,YAAI,UAAU,OAAO,OAAO,mBAAmB;AAC3C,gBAAM,MAAM,SAAS,eAAe,mBAAmB;AACvD,cAAI,KAAK;AACL,gBAAI,MAAM;AACV,kBAAM,eAAe;AAAA,UACzB;AAAA,QACJ;AAAA,MACJ;AAAA,IACJ;AAAA,IAEQ,uBAA6B;AACjC,WAAK,kBAAkB;AACvB,WAAK,4BAA4B,QAAQ;AAAA,IAC7C;AAAA;AAAA;AAAA;AAAA,IAKQ,iBAAiB,OAAoB;AACzC,YAAM,SAAS,MAAM;AAGrB,UAAI,OAAO,OAAO,wBAAwB,OAAO,OAAO,0BAA0B;AAC9E,gBAAQ,IAAI,gDAAgD;AAG5D,aAAK,kBAAkB;AACvB,aAAK,4BAA4B,QAAQ;AAAA,MAC7C;AAAA,IACJ;AAAA;AAAA;AAAA;AAAA,IAKQ,oBAA0B;AAC9B,YAAM,gBAA0B,CAAC;AAEjC,eAAS,iBAAiB,eAAe,EAAE,QAAQ,CAAC,OAAgB;AAChE,cAAM,QAAQ;AACd,cAAM,aAAa,MAAM,SAAS;AAClC,YAAI,WAAW,QAAQ;AACnB,gBAAM,SAAS,SAAS,YAAY,EAAE;AACtC,cAAI,CAAC,MAAM,MAAM,GAAG;AAChB,0BAAc,KAAK,MAAM;AAAA,UAC7B;AAAA,QACJ;AAAA,MACJ,CAAC;AAED,UAAI,cAAc;AAClB,eAAS,iBAAiB,gBAAgB,EAAE,QAAQ,CAAC,OAAgB;AACjE,cAAM,SAAS,GAAG,MAAM;AACxB,cAAM,QAAQ,SAAS,OAAO,QAAQ,YAAY,EAAE,GAAG,EAAE;AAEzD,YAAI,CAAC,OAAO,MAAM,KAAK,KAAK,cAAc,SAAS,KAAK,GAAG;AAEvD,gBAAM,MAAM,GAAG,QAAQ,IAAI,KACf,GAAG,iBAAiB,GAAG,cAAc;AACjD,cAAI,KAAK;AACL,YAAC,IAAoB,MAAM,UAAU;AACrC;AAAA,UACJ;AAAA,QACJ;AAAA,MACJ,CAAC;AAED,YAAM,WAAW,SAAS,iBAAiB,WAAW;AACtD,UAAI,eAAe,SAAS,QAAQ;AAChC,cAAM,YAAY,SAAS,eAAe,mBAAmB,KAAK,SAAS,eAAe,yBAAyB;AACnH,YAAI,WAAW;AACX,oBAAU,MAAM,UAAU;AAAA,QAC9B;AAAA,MACJ;AAAA,IACJ;AAAA;AAAA;AAAA;AAAA,IAKQ,eAAe,OAAoB;AACvC,YAAM,MAAO,MAAM,OAAuB,QAAQ,mCAAmC;AACrF,UAAI,CAAC,IAAK;AAEV,YAAM,SAAS,MAAM;AACrB,UAAI,OAAO,SAAS,YAAY;AAC5B,cAAM,WAAW,IAAI,cAAc,wBAAwB;AAC3D,YAAI,UAAU;AAEV,mBAAS,UAAU,CAAC,SAAS;AAC7B,mBAAS,cAAc,IAAI,MAAM,UAAU,EAAE,SAAS,KAAK,CAAC,CAAC;AAAA,QACjE;AAAA,MACJ;AAAA,IACJ;AAAA;AAAA;AAAA;AAAA,IAKQ,4BAA4B,MAAgC;AAChE,YAAM,MAAM,QAAQ;AACpB,YAAM,aAAa,IAAI,iBAAiB,0BAA0B;AAClE,YAAM,eAAe,IAAI,iBAAiB,kCAAkC;AAC5E,YAAM,aAAa,aAAa,SAAS;AAEzC,cAAQ,IAAI,uCAAgC,WAAW,MAAM,sBAAsB,aAAa,MAAM,yBAAyB,UAAU,EAAE;AAG3I,UAAI;AAGJ,gBAAU,IAAI,iBAAiB,8FAA8F;AAG7H,UAAI,QAAQ,WAAW,GAAG;AACtB,kBAAU,SAAS,iBAAiB,8FAA8F;AAAA,MACtI;AAGA,UAAI,QAAQ,WAAW,GAAG;AACtB,cAAM,aAAa,SAAS,eAAe,mBAAmB,KAAK,SAAS,eAAe,yBAAyB;AACpH,YAAI,YAAY;AACZ,oBAAU,CAAC,UAAU;AACrB,kBAAQ,IAAI,uCAAgC;AAAA,QAChD;AAAA,MACJ;AAGA,UAAI,QAAQ,WAAW,GAAG;AACtB,cAAM,SAAS,SAAS,iBAAiB,QAAQ;AACjD,eAAO,QAAQ,WAAS;AACpB,gBAAM,eAAe,MAAM,iBAAiB,4IAA4I;AACxL,cAAI,aAAa,SAAS,GAAG;AACzB,sBAAU;AACV,oBAAQ,IAAI,0CAAmC;AAAA,UACnD;AAAA,QACJ,CAAC;AAAA,MACL;AAEA,cAAQ,IAAI,mBAAY,QAAQ,MAAM,sBAAsB;AAE5D,cAAQ,QAAQ,CAAC,QAAiB;AAC9B,cAAM,SAAS;AACf,YAAI,YAAY;AACZ,iBAAO,gBAAgB,UAAU;AACjC,iBAAO,gBAAgB,eAAe;AACtC,iBAAO,WAAW;AAClB,kBAAQ,IAAI,mCAA8B;AAAA,QAC9C,OAAO;AACH,iBAAO,aAAa,YAAY,MAAM;AACtC,iBAAO,aAAa,iBAAiB,MAAM;AAC3C,iBAAO,WAAW;AAClB,kBAAQ,IAAI,oCAA+B;AAAA,QAC/C;AAAA,MACJ,CAAC;AAAA,IACL;AAAA;AAAA;AAAA;AAAA,IAKA,MAAc,6BAA6B,KAAiC;AACxE,YAAM,cAAc,IAAI,IAAI,SAAS,IAAI;AACzC,YAAM,WAAW,YAAY,SAAS,MAAM,GAAG,EAAE,GAAG,EAAE,KAAK;AAG3D,YAAM,cAAc,YAAY,SAAS,SAAS,SAAS;AAC3D,YAAM,gBAAgB,YAAY,SAAS,SAAS,OAAO;AAE3D,YAAM,UAAU,MAAM;AAAA,QAClB,SAAS,iBAAiB,kCAAkC;AAAA,MAChE,EACK,IAAI,CAAC,OAAgB,SAAU,GAAwB,OAAO,EAAE,CAAC,EACjE,OAAO,CAAC,OAAe,CAAC,MAAM,EAAE,CAAC;AAEtC,UAAI,QAAQ,WAAW,EAAG;AAG1B,YAAM,gBAAgB,QAAQ,SAAS,CAAC,GAAG,MAAM,IAAI,CAAC;AACtD,cAAQ,IAAI,qCAAqC,aAAa;AAE9D,YAAM,eAAe,IAAI;AACzB,UAAI,YAAY;AAChB,MAAC,IAA0B,WAAW;AAEtC,YAAM,SAAS,IAAI,gBAAgB;AACnC,oBAAc,QAAQ,CAAC,OAAe;AAClC,eAAO,OAAO,cAAc,GAAG,SAAS,CAAC;AAAA,MAC7C,CAAC;AAGD,UAAI,aAAa;AACb,eAAO,OAAO,YAAY,QAAQ;AAAA,MACtC,OAAO;AACH,eAAO,OAAO,UAAU,QAAQ;AAAA,MACpC;AAEA,YAAM,WAAW,cAAc,oBAAoB;AAEnD,UAAI;AACA,cAAM,WAAW,MAAM,MAAM,iBAAiB,QAAQ,IAAI,OAAO,SAAS,CAAC,IAAI;AAAA,UAC3E,QAAQ;AAAA,UACR,aAAa;AAAA,UACb,OAAO;AAAA,UACP,SAAS,EAAE,UAAU,mBAAmB;AAAA,QAC5C,CAAC;AAED,YAAI,CAAC,SAAS,IAAI;AACd,gBAAM,IAAI,MAAM,4BAA4B,SAAS,MAAM,EAAE;AAAA,QACjE;AAEA,cAAM,OAAO,MAAM,SAAS,KAAK;AACjC,YAAI;AACJ,YAAI;AACA,iBAAO,KAAK,MAAM,IAAI;AAAA,QAC1B,SAAS,GAAG;AACR,iBAAO;AAAA,QACX;AAEA,cAAM,QAAQ,UAAU,IAAI;AAC5B,aAAK,aAAa,KAAK;AAEvB,YAAI,YAAY;AAGhB,iBAAS,OAAO;AAAA,MACpB,SAAS,OAAO;AACZ,gBAAQ,MAAM,wBAAwB,KAAK;AAC3C,YAAI,YAAY;AAChB,QAAC,IAA0B,WAAW;AAEtC,cAAM,YAAY,IAAI,MAAM,6EAA6E;AAAA,UACrG,OAAO;AAAA,QACX,CAAC;AACD,cAAM,UAAU,OAAO;AAAA,MAC3B;AAAA,IACJ;AAAA;AAAA;AAAA;AAAA,IAKQ,aAAa,OAAoC;AACrD,UAAI,0BAAyC;AAG7C,YAAM,iBAAiB,OAAO;AAAA,QAC1B,OAAO,QAAQ,KAAK,EAAE,IAAI,CAAC,CAAC,KAAK,IAAI,OAAO,EAAE,KAAK,GAAG,KAAK,EAAE;AAAA,QAC7D,CAAC,SAAS,KAAK,eAAe;AAAA,MAClC;AAEA,cAAQ,IAAI,8BAA8B,OAAO,KAAK,cAAc,CAAC;AAGrE,aAAO,QAAQ,KAAK,EAAE,WAAW,EAAE,QAAQ,CAAC,CAAC,KAAK,IAAI,MAAM;AACxD,cAAM,mBAAmB,KAAK;AAE9B,YAAI,CAAC,kBAAkB;AACnB,gBAAM,eAAe,SAAS,eAAe,uBAAuB,KACjD,SAAS,cAAc,wBAAwB;AAClE,oCAA0B,eAAe,aAAa,aAAa,OAAO,IAAI;AAAA,QAClF,OAAO;AACH,oCAA0B;AAAA,QAC9B;AAGA,cAAM,YAAY,SAAS,cAAc,gCAAgC,KACxD,SAAS,cAAc,mBAAmB;AAC3D,YAAI,CAAC,UAAW;AAEhB,cAAM,SAAS,UAAU,cAAc,yBAAyB;AAChE,cAAM,SAAS,UAAU,cAAc,mCAAmC;AAC1E,cAAM,UAAU,UAAU,cAAc,0BAA0B;AAClE,cAAM,QAAQ,UAAU,cAAc,6BAA6B;AACnE,cAAM,QAAQ,UAAU,cAAc,iCAAiC;AACvE,cAAM,WAAW,UAAU,cAAc,4BAA4B;AAErE,YAAI,OAAQ,QAAO,QAAQ,KAAK,QAAQ;AACxC,YAAI,OAAQ,QAAO,QAAQ,KAAK,eAAe;AAC/C,YAAI,QAAS,SAAQ,QAAQ,KAAK,SAAS;AAC3C,YAAI,MAAO,OAAM,QAAQ;AACzB,YAAI,MAAO,OAAM,QAAQ,2BAA2B;AACpD,YAAI,SAAU,UAAS,QAAQ,KAAK,MAAM;AAAA,MAC9C,CAAC;AAAA,IACL;AAAA;AAAA;AAAA;AAAA,IAKA,MAAc,kBAAiC;AAC3C,YAAM,aAAa,SAAS,cAAc,cAAc;AACxD,UAAI,CAAC,WAAY;AAEjB,YAAM,YAAY,GAAG,SAAS,MAAM;AACpC,iBAAW,YAAY;AAGvB,YAAM,EAAE,SAAS,SAAS,OAAO,IAAI,QAAQ,cAAoB;AAEjE,YAAM,YAAY,WAAW,MAAM;AAC/B,eAAO,IAAI,MAAM,uBAAuB;AAAA,UACpC,OAAO;AAAA,QACX,CAAC,CAAC;AAAA,MACN,GAAG,GAAK;AAER,UAAI;AACA,cAAM,WAAW,MAAM,MAAM,WAAW;AAAA,UACpC,OAAO;AAAA,UACP,aAAa;AAAA,QACjB,CAAC;AAED,cAAM,OAAO,MAAM,SAAS,KAAK;AAGjC,cAAM,SAAS,IAAI,UAAU;AAC7B,cAAM,MAAM,OAAO,gBAAgB,MAAM,WAAW;AACpD,cAAM,WAAW,SAAS,uBAAuB;AAGjD,cAAM,KAAK,IAAI,KAAK,QAAQ,EAAE,WAAW,EAAE,QAAQ,WAAS;AACxD,mBAAS,aAAa,OAAO,SAAS,UAAU;AAAA,QACpD,CAAC;AAED,mBAAW,YAAY;AACvB,mBAAW,YAAY,QAAQ;AAE/B,aAAK,4BAA4B,UAAU;AAC3C,qBAAa,SAAS;AACtB,gBAAQ;AAAA,MACZ,SAAS,OAAO;AACZ,qBAAa,SAAS;AACtB,gBAAQ,MAAM,2BAA2B,KAAK;AAC9C,eAAO,KAAK;AAAA,MAChB;AAGA,cAAQ,KAAK,MAAM;AAEf,iBAAS,iBAAiB,4BAA4B,EAAE,QAAQ,CAAC,QAAiB;AAC9E,UAAC,IAA0B,gBAAgB,UAAU;AAAA,QACzD,CAAC;AAAA,MACL,CAAC,EAAE,MAAM,CAAC,UAAU;AAChB,gBAAQ,MAAM,sBAAsB,KAAK;AAEzC,iBAAS,iBAAiB,4BAA4B,EAAE,QAAQ,CAAC,QAAiB;AAC9E,UAAC,IAA0B,gBAAgB,UAAU;AAAA,QACzD,CAAC;AAAA,MACL,CAAC;AAAA,IACL;AAAA,EACJ;;;AC5ZA,WAASC,kBAAiB,SAAkB,MAAoB;AAC5D,UAAM,SAAS,IAAI,UAAU;AAC7B,UAAM,MAAM,OAAO,gBAAgB,MAAM,WAAW;AACpD,UAAM,WAAW,SAAS,uBAAuB;AACjD,UAAM,KAAK,IAAI,KAAK,QAAQ,EAAE,QAAQ,WAAS,SAAS,YAAY,KAAK,CAAC;AAC1E,YAAQ,YAAY;AACpB,YAAQ,YAAY,QAAQ;AAAA,EAChC;AAGA,WAASC,gBAAqB;AAC1B,WAAO,SAAS,OAAO;AAAA,EAC3B;AAqBO,MAAM,oBAAN,MAAwB;AAAA,IAC3B,cAAc;AACV,WAAK,mBAAmB;AACxB,WAAK,iBAAiB;AAAA,IAC1B;AAAA,IAEQ,qBAA2B;AAC/B,eAAS,iBAAiB,SAAS,KAAK,YAAY,KAAK,IAAI,GAAG,IAAI;AAAA,IACxE;AAAA,IAEQ,mBAAyB;AAC7B,UAAI,SAAS,eAAe,WAAW;AACnC,iBAAS,iBAAiB,oBAAoB,MAAM;AAChD,eAAK,YAAY;AAAA,QACrB,CAAC;AAAA,MACL,OAAO;AACH,aAAK,YAAY;AAAA,MACrB;AAAA,IACJ;AAAA,IAEQ,YAAY,OAAoB;AACpC,YAAM,SAAS,MAAM;AAGrB,UAAI,OAAO,QAAQ,+CAA+C,KAC9D,OAAO,QAAQ,+CAA+C,GAAG;AACjE,aAAK,gBAAgB,IAAI;AACzB;AAAA,MACJ;AAGA,UAAI,OAAO,QAAQ,kDAAkD,KACjE,OAAO,QAAQ,kDAAkD,GAAG;AACpE,aAAK,gBAAgB,KAAK;AAC1B;AAAA,MACJ;AAGA,UAAI,OAAO,QAAQ,wBAAwB,KACvC,OAAO,QAAQ,wBAAwB,GAAG;AAC1C,aAAK,4BAA4B;AACjC;AAAA,MACJ;AAGA,YAAM,eAAe,OAAO,QAAQ,wBAAwB;AAC5D,UAAI,cAAc;AACd,aAAK,gBAAgB,YAAY;AACjC;AAAA,MACJ;AAGA,YAAM,UAAU,OAAO,QAAQ,kBAAkB;AACjD,UAAI,SAAS;AACT,aAAK,qBAAqB;AAC1B;AAAA,MACJ;AAAA,IACJ;AAAA;AAAA;AAAA;AAAA,IAKQ,cAAoB;AACxB,UAAI,OAAO,OAAO,cAAc,YAAa;AAE7C,YAAM,UAAU,SAAS;AAAA,QACrB;AAAA,MACJ;AACA,cAAQ,QAAQ,aAAW;AAEvB,YAAI,CAAE,QAAgB,YAAY;AAC9B,cAAI;AACA,gBAAI,OAAO,UAAU,SAAS,CAAC,CAAC;AAChC,YAAC,QAAgB,aAAa;AAAA,UAClC,SAAS,OAAO;AACZ,oBAAQ,KAAK,mCAAmC,KAAK;AAAA,UACzD;AAAA,QACJ;AAAA,MACJ,CAAC;AAAA,IACL;AAAA;AAAA;AAAA;AAAA,IAKA,MAAc,gBAAgB,SAAqC;AAC/D,YAAM,MAAM,QAAQ,QAAQ,OAAO,GAAG,SAAS,MAAM;AACrD,YAAM,WAAW,QAAQ,QAAQ,UAAU;AAC3C,YAAM,SAAS,SAAS,eAAe,QAAQ;AAE/C,UAAI,CAAC,QAAQ;AACT,gBAAQ,MAAM,mCAAmC,QAAQ,EAAE;AAC3D;AAAA,MACJ;AAEA,UAAI;AACA,cAAM,WAAW,MAAM,MAAM,KAAK,EAAE,OAAO,YAAY,aAAa,cAAc,CAAC;AACnF,cAAM,OAAO,MAAM,SAAS,KAAK;AAGjC,QAAAD,kBAAiB,QAAQ,IAAI;AAG7B,cAAM,UAAU,OAAO,cAAc,QAAQ;AAC7C,YAAI,WAAW,OAAO,WAAW,OAAO;AACpC,gBAAM,gBAAgB,IAAI,OAAO,UAAU,MAAM,OAAO;AACxD,wBAAc,KAAK;AAAA,QACvB;AAGA,aAAK,YAAY;AAAA,MACrB,SAAS,OAAO;AACZ,gBAAQ,MAAM,qCAAqC,KAAK;AACxD,cAAM,yCAAyC;AAAA,MACnD;AAAA,IACJ;AAAA;AAAA;AAAA;AAAA,IAKQ,gBAAgB,kBAAiC;AACrD,YAAM,MAAM,SAAS,SAAS,8BAA8B,mBAAmB,MAAM;AACrF,aAAO,SAAS,OAAO;AACvB,aAAO,KAAK,KAAK,QAAQ;AAAA,IAC7B;AAAA;AAAA;AAAA;AAAA,IAKA,MAAc,8BAA6C;AACvD,YAAM,MAAM,SAAS,cAAc,wBAAwB;AAC3D,UAAI,KAAK;AACL,YAAI,YAAY;AAAA,MACpB;AAGA,YAAM,SAAS,SAAS,eAAe,OAAO;AAC9C,YAAM,aAAa,SAAS,eAAe,WAAW;AACtD,YAAM,YAAY,SAAS,eAAe,UAAU;AACpD,YAAM,aAAa,SAAS,eAAe,UAAU;AAErD,UAAI,CAAC,QAAQ,SAAS,CAAC,YAAY,SAAS,CAAC,WAAW,OAAO;AAC3D,gBAAQ,MAAM,sDAAsD;AACpE,cAAM,sCAAsC;AAC5C;AAAA,MACJ;AAEA,YAAM,UAAU;AAAA,QACZ,OAAO,OAAO;AAAA,QACd,WAAW,WAAW;AAAA,QACtB,UAAU,UAAU;AAAA,QACpB,UAAU,YAAY,SAAS;AAAA,MACnC;AAEA,UAAI;AACA,cAAM,MAAM,SAAS,SAAS;AAC9B,cAAM,WAAW,MAAM,QAAQ,KAAK,OAAO;AAE3C,YAAI,YAAY,SAAS,YAAY,GAAG;AACpC,cAAI,KAAK;AACL,gBAAI,YAAY;AAAA,UACpB;AAEA,cAAI,SAAS,QAAQ;AACjB,mBAAO,SAAS,OAAO,GAAG,SAAS,MAAM,qBAAqB,SAAS,MAAM;AAAA,UACjF,OAAO;AACH,YAAAC,cAAa;AAAA,UACjB;AAAA,QACJ,OAAO;AAEH,cAAI,UAAU,mBAAmB;AAC7B,qBAAS,iBAAiB,gBAAgB,EAAE,QAAQ,WAAS;AACzD,oBAAM,UAAU,OAAO,OAAO;AAAA,YAClC,CAAC;AACD,mBAAO,QAAQ,SAAS,iBAAiB,EAAE,QAAQ,CAAC,CAAC,KAAK,KAAK,MAAM;AACjE,oBAAM,QAAQ,SAAS,eAAe,GAAG;AACzC,kBAAI,OAAO,eAAe;AACtB,sBAAM,cAAc,UAAU,IAAI,WAAW;AAAA,cACjD;AAAA,YACJ,CAAC;AAAA,UACL;AACA,cAAI,KAAK;AACL,gBAAI,YAAY;AAAA,UACpB;AAAA,QACJ;AAAA,MACJ,SAAS,OAAO;AACZ,gBAAQ,MAAM,oCAAoC,KAAK;AACvD,YAAI,KAAK;AACL,cAAI,YAAY;AAAA,QACpB;AACA,cAAM,wDAAwD;AAAA,MAClE;AAAA,IACJ;AAAA;AAAA;AAAA;AAAA,IAKA,MAAc,uBAAsC;AAChD,YAAM,OAAO,SAAS,cAAc,kBAAkB;AACtD,UAAI,CAAC,MAAM;AACP,gBAAQ,MAAM,4BAA4B;AAC1C;AAAA,MACJ;AAEA,UAAI;AACA,cAAM,SACF,KAAK,aAAa,QAAQ,KAAK,GAAG,SAAS,MAAM;AACrD,cAAM,WAAW,IAAI,SAAS,IAAI;AAGlC,cAAM,SAAS,IAAI,gBAAgB;AACnC,iBAAS,QAAQ,CAAC,OAAO,QAAQ;AAC7B,iBAAO,OAAO,KAAK,MAAM,SAAS,CAAC;AAAA,QACvC,CAAC;AAED,cAAM,MAAM,GAAG,MAAM,IAAI,OAAO,SAAS,CAAC;AAC1C,cAAM,WAAW,MAAM,MAAM,KAAK;AAAA,UAC9B,OAAO;AAAA,UACP,aAAa;AAAA,UACb,SAAS;AAAA,YACL,QAAQ;AAAA,UACZ;AAAA,QACJ,CAAC;AAED,cAAM,OAAO,MAAM,SAAS,KAAK;AACjC,cAAM,iBAAiB,UAAU,IAAI;AAErC,YAAI,eAAe,YAAY,GAAG;AAE9B,iBAAO,SAAS,OAAO;AAAA,QAC3B,OAAO;AACH,gBAAM,UAAU,eAAe,WAAW;AAC1C,gBAAM,OAAO;AAAA,QACjB;AAAA,MACJ,SAAS,OAAO;AACZ,gBAAQ,MAAM,4BAA4B,KAAK;AAC/C,cAAM,mDAAmD;AAAA,MAC7D;AAAA,IACJ;AAAA,EACJ;;;ACvOO,MAAM,gBAAN,MAAoB;AAAA,IACvB,cAAc;AACV,WAAK,mBAAmB;AAAA,IAC5B;AAAA,IAEQ,qBAA2B;AAE/B,UAAI,SAAS,eAAe,WAAW;AACnC,iBAAS,iBAAiB,oBAAoB,KAAK,oBAAoB,KAAK,IAAI,CAAC;AAAA,MACrF,OAAO;AAEH,aAAK,oBAAoB;AAAA,MAC7B;AACA,eAAS,iBAAiB,SAAS,KAAK,YAAY,KAAK,IAAI,GAAG,IAAI;AAAA,IACxE;AAAA,IAEQ,YAAY,OAAoB;AACpC,YAAM,SAAS,MAAM;AAErB,UAAI,OAAO,QAAQ,4BAA4B,GAAG;AAC9C,aAAK,yBAAyB;AAC9B;AAAA,MACJ;AAAA,IACJ;AAAA,IAEQ,sBAA4B;AAChC,YAAM,gBAAgB,SAAS;AAAA,QAC3B;AAAA,MACJ;AACA,YAAM,kBAAkB,SAAS;AAAA,QAC7B;AAAA,MACJ;AAEA,UAAI,eAAe;AACf,sBAAc,iBAAiB,UAAU,KAAK,gBAAgB,KAAK,IAAI,GAAG,KAAK;AAE/E,aAAK,mBAAmB,MAAM,KAAK,gBAAgB,CAAC;AAAA,MACxD;AAEA,UAAI,iBAAiB;AACjB,wBAAgB,iBAAiB,UAAU,KAAK,kBAAkB,KAAK,IAAI,GAAG,KAAK;AAEnF,aAAK,mBAAmB,MAAM,KAAK,kBAAkB,CAAC;AAAA,MAC1D;AAAA,IACJ;AAAA;AAAA;AAAA;AAAA;AAAA,IAMQ,mBAAmB,UAA4B;AACnD,YAAM,EAAE,SAAS,SAAS,OAAO,IAAI,QAAQ,cAAoB;AAGjE,YAAM,YAAY,WAAW,MAAM;AAC/B,eAAO,IAAI,MAAM,mCAAmC;AAAA,UAChD,OAAO;AAAA,QACX,CAAC,CAAC;AAAA,MACN,GAAG,GAAI;AAGP,iBAAW,MAAM;AACb,qBAAa,SAAS;AACtB,gBAAQ;AAAA,MACZ,GAAG,CAAC;AAEJ,cACK,KAAK,MAAM,SAAS,CAAC,EACrB,MAAM,WAAS;AACZ,gBAAQ,MAAM,mCAAmC,KAAK;AAEtD,YAAI;AACA,mBAAS;AAAA,QACb,SAAS,eAAe;AACpB,kBAAQ,MAAM,8BAA8B,aAAa;AAAA,QAC7D;AAAA,MACJ,CAAC;AAAA,IACT;AAAA;AAAA;AAAA;AAAA,IAKQ,eACJ,UACA,OACA,YACI;AACJ,UAAI,CAAC,SAAU;AAGf,eAAS,YAAY;AAGrB,YAAM,eAAe,SAAS,cAAc,QAAQ;AACpD,mBAAa,QAAQ;AACrB,mBAAa,cAAc,cAAc;AACzC,eAAS,YAAY,YAAY;AAEjC,UAAI,CAAC,MAAO;AAGZ,UAAI,MAAM,QAAQ,KAAK,GAAG;AACtB,cAAM,QAAQ,CAAC,OAAO,UAAU;AAC5B,gBAAM,SAAS,SAAS,cAAc,QAAQ;AAC9C,iBAAO,QAAQ,MAAM,SAAS;AAC9B,iBAAO,cAAc;AACrB,mBAAS,YAAY,MAAM;AAAA,QAC/B,CAAC;AAAA,MACL,OAAO;AACH,eAAO,QAAQ,KAAK,EAAE,QAAQ,CAAC,CAAC,KAAK,KAAK,MAAM;AAC5C,gBAAM,SAAS,SAAS,cAAc,QAAQ;AAC9C,iBAAO,QAAQ;AACf,iBAAO,cAAc;AACrB,mBAAS,YAAY,MAAM;AAAA,QAC/B,CAAC;AAAA,MACL;AAAA,IACJ;AAAA;AAAA;AAAA;AAAA,IAKA,MAAc,kBAAiC;AAC3C,YAAM,gBAAgB,SAAS;AAAA,QAC3B;AAAA,MACJ;AACA,UAAI,CAAC,cAAe;AAEpB,YAAM,oBAAoB,cAAc,SAAS;AACjD,YAAM,MAAM,GAAG,SAAS,MAAM,+BAA+B,mBAAmB,iBAAiB,CAAC;AAElG,UAAI;AACA,cAAM,UAAkC;AAAA,UACpC,qBAAqB;AAAA,QACzB;AAEA,cAAM,WAAW,MAAM,QAAiC,KAAK,OAAO;AACpE,cAAM,OAAO,UAAU,QAAQ;AAE/B,YAAI,KAAK,YAAY,GAAG;AACpB,gBAAM,sBAAsB,KAAK,wBAAwB,CAAC;AAC1D,gBAAM,oBAAoB,SAAS;AAAA,YAC/B;AAAA,UACJ;AACA,eAAK,eAAe,mBAAmB,qBAAqB,MAAM;AAGlE,cAAI,mBAAmB;AACnB,kBAAM,cAAc,IAAI,MAAM,UAAU,EAAE,SAAS,KAAK,CAAC;AACzD,8BAAkB,cAAc,WAAW;AAAA,UAC/C;AAAA,QACJ,OAAO;AAEH,eAAK;AAAA,YACD,SAAS,eAAe,8BAA8B;AAAA,YACtD,CAAC;AAAA,YACD;AAAA,UACJ;AACA,eAAK;AAAA,YACD,SAAS,eAAe,aAAa;AAAA,YACrC,CAAC;AAAA,YACD;AAAA,UACJ;AAAA,QACJ;AAAA,MACJ,SAAS,OAAO;AACZ,gBAAQ,MAAM,sCAAsC,KAAK;AAEzD,aAAK;AAAA,UACD,SAAS,eAAe,8BAA8B;AAAA,UACtD,CAAC;AAAA,UACD;AAAA,QACJ;AACA,aAAK;AAAA,UACD,SAAS,eAAe,aAAa;AAAA,UACrC,CAAC;AAAA,UACD;AAAA,QACJ;AAAA,MACJ;AAAA,IACJ;AAAA;AAAA;AAAA;AAAA,IAKA,MAAc,oBAAmC;AAC7C,YAAM,kBAAkB,SAAS;AAAA,QAC7B;AAAA,MACJ;AACA,UAAI,CAAC,gBAAiB;AAEtB,YAAM,sBAAsB,gBAAgB,SAAS;AACrD,YAAM,MAAM,GAAG,SAAS,MAAM,yBAAyB,mBAAmB,mBAAmB,CAAC;AAE9F,UAAI;AACA,cAAM,UAA8B;AAAA,UAChC,uBAAuB;AAAA,QAC3B;AAEA,cAAM,WAAW,MAAM,QAA6B,KAAK,OAAO;AAChE,cAAM,OAAO,UAAU,QAAQ;AAE/B,YAAI,KAAK,YAAY,GAAG;AACpB,gBAAM,cAAc,KAAK,gBAAgB,CAAC;AAC1C,gBAAM,qBAAqB,SAAS;AAAA,YAChC;AAAA,UACJ;AACA,eAAK,eAAe,oBAAoB,aAAa,MAAM;AAAA,QAC/D,OAAO;AACH,eAAK;AAAA,YACD,SAAS,eAAe,aAAa;AAAA,YACrC,CAAC;AAAA,YACD;AAAA,UACJ;AAAA,QACJ;AAAA,MACJ,SAAS,OAAO;AACZ,gBAAQ,MAAM,8BAA8B,KAAK;AAEjD,aAAK;AAAA,UACD,SAAS,eAAe,aAAa;AAAA,UACrC,CAAC;AAAA,UACD;AAAA,QACJ;AAAA,MACJ;AAAA,IACJ;AAAA;AAAA;AAAA;AAAA,IAOQ,gCAA8C;AAClD,YAAM,WAAyB,CAAC;AAChC,YAAM,eAAe,SAAS,iBAAmC,oCAAoC;AAErG,mBAAa,QAAQ,cAAY;AAC7B,cAAM,MAAM,SAAS,QAAQ,IAAI;AACjC,YAAI,CAAC,IAAK;AAEV,cAAM,WAAW,SAAS;AAC1B,cAAM,iBAAiB,IAAI,cAAc,oBAAoB;AAC7D,cAAM,mBAAmB,IAAI,cAAc,sBAAsB;AACjE,cAAM,sBAAsB,IAAI,cAAc,yBAAyB;AAEvE,cAAM,aAAyB;AAAA,UAC3B,WAAW;AAAA,UACX,aAAa,gBAAgB,aAAa,KAAK,KAAK;AAAA,UACpD,sBAAsB,kBAAkB,aAAa,KAAK,KAAK;AAAA,UAC/D,kBAAkB,qBAAqB,aAAa,KAAK,KAAK;AAAA,QAClE;AAEA,iBAAS,KAAK,UAAU;AAAA,MAC5B,CAAC;AAED,aAAO;AAAA,IACX;AAAA;AAAA;AAAA;AAAA,IAOA,MAAc,2BAA0C;AACpD,YAAM,gBAAgB,SAAS,eAAe,aAAa;AAC3D,YAAM,aAAa,SAAS,eAAe,SAAS;AACpD,YAAM,aAAa,SAAS,eAAe,2BAA2B;AAEtE,UAAI,CAAC,eAAe,SAAS,CAAC,YAAY,OAAO;AAC7C,cAAM,uCAAuC;AAC7C;AAAA,MACJ;AAEA,YAAM,mBAAmB,KAAK,8BAA8B;AAC5D,UAAI,iBAAiB,WAAW,GAAG;AAC/B,cAAM,uBAAuB;AAC7B;AAAA,MACJ;AAGA,YAAM,eAAe,WAAW;AAChC,iBAAW,YAAY;AACvB,iBAAW,WAAW;AAEtB,UAAI;AACA,cAAM,YAAY,iBAAiB,IAAI,OAAK,EAAE,SAAS;AACvD,cAAM,YAAa,SAAS,cAAc,qBAAqB,GAAwB,SAAS;AAEhG,cAAM,UAAiC;AAAA,UACnC,YAAY;AAAA,UACZ,aAAa,cAAc;AAAA,UAC3B,SAAS,WAAW;AAAA,UACpB,OAAO;AAAA,QACX;AAEA,cAAM,WAAW,MAAM,MAAM,GAAG,SAAS,MAAM,qCAAqC;AAAA,UAChF,QAAQ;AAAA,UACR,SAAS;AAAA,YACL,gBAAgB;AAAA,UACpB;AAAA,UACA,aAAa;AAAA,UACb,MAAM,IAAI,gBAAgB,OAAc,EAAE,SAAS;AAAA,QACvD,CAAC;AAED,cAAM,OAAQ,MAAM,SAAS,KAAK;AAElC,YAAI,KAAK,SAAS;AACd,qBAAW,YAAY;AACvB,gBAAM,KAAK,WAAW,0BAA0B,KAAK,SAAS,CAAC,YAAY;AAE3E,cAAI,KAAK,YAAY,KAAK,SAAS,SAAS,GAAG;AAC3C,oBAAQ,KAAK,uCAAuC,KAAK,QAAQ;AAAA,UACrE;AAGA,gBAAM,QAAQ,SAAS,eAAe,yBAAyB;AAC/D,cAAI,SAAS,OAAQ,OAAe,WAAW,UAAU,aAAa;AAClE,kBAAM,UAAW,OAAe,UAAU,MAAM,YAAY,KAAK;AACjE,gBAAI,SAAS;AACT,sBAAQ,KAAK;AAAA,YACjB;AAAA,UACJ;AACA,qBAAW,MAAM;AACb,mBAAO,SAAS,OAAO;AAAA,UAC3B,GAAG,GAAI;AAAA,QACX,OAAO;AACH,qBAAW,YAAY;AACvB,qBAAW,WAAW;AACtB,gBAAM,UAAU,KAAK,WAAW,wBAAwB,EAAE;AAAA,QAC9D;AAAA,MACJ,SAAS,OAAO;AACZ,gBAAQ,MAAM,6BAA6B,KAAK;AAChD,mBAAW,YAAY;AACvB,mBAAW,WAAW;AACtB,cAAM,gEAAgE;AAAA,MAC1E;AAAA,IACJ;AAAA,EAGJ;;;AC1VO,MAAM,kBAAN,MAAsB;AAAA,IACjB,wBAAgD,CAAC;AAAA,IACjD,yBACJ,CAAC;AAAA,IAEL,cAAc;AACV,WAAK,mBAAmB;AAAA,IAC5B;AAAA,IAEQ,qBAA2B;AAE/B,UAAI,SAAS,eAAe,WAAW;AACnC,iBAAS,iBAAiB,oBAAoB,KAAK,WAAW,KAAK,IAAI,CAAC;AAAA,MAC5E,OAAO;AAEH,aAAK,WAAW;AAAA,MACpB;AAAA,IACJ;AAAA,IAEQ,aAAmB;AAEvB,WAAK,mBAAmB;AAGxB,YAAM,oBAAoB,SAAS,eAAe,mBAAmB;AACrE,UAAI,mBAAmB;AACnB,0BAAkB,iBAAiB,UAAU,KAAK,mBAAmB,KAAK,IAAI,CAAC;AAAA,MACnF;AAGA,YAAM,SAAS,SAAS,eAAe,kBAAkB;AACzD,UAAI,QAAQ;AACR,eAAO,iBAAiB,SAAS,OAAK;AAClC,YAAE,eAAe;AACjB,eAAK,uBAAuB;AAAA,QAChC,CAAC;AAAA,MACL;AAGA,YAAM,eAAe,SAAS,eAAe,eAAe;AAC5D,YAAM,YAAY,SAAS,eAAe,YAAY;AACtD,UAAI,aAAa,cAAc;AAE3B,YAAI,aAAa,SAAS,SAAS,GAAG;AAClC,oBAAU,iBAAiB,SAAS,OAAK;AACrC,cAAE,eAAe;AACjB,iBAAK,0BAA0B;AAAA,UACnC,CAAC;AAAA,QACL;AAAA,MACJ;AAGA,YAAM,eAAe,SAAS,eAAe,uBAAuB;AACpE,UAAI,cAAc;AACd,qBAAa;AAAA,UACT;AAAA,UACA,KAAK,gCAAgC,KAAK,IAAI;AAAA,QAClD;AAAA,MACJ;AAGA,WAAK,gCAAgC;AAAA,IACzC;AAAA;AAAA;AAAA;AAAA,IAKQ,qBAA2B;AAC/B,YAAM,oBAAoB,SAAS,eAAe,mBAAmB;AACrE,YAAM,MAAM,SAAS,eAAe,mBAAmB;AAEvD,UAAI,CAAC,OAAO,CAAC,kBAAmB;AAEhC,UAAI,kBAAkB,UAAU,QAAQ;AACpC,YAAI,MAAM,UAAU;AAAA,MACxB,OAAO;AACH,YAAI,MAAM,UAAU;AAAA,MACxB;AAAA,IACJ;AAAA;AAAA;AAAA;AAAA,IAKA,MAAc,yBAAwC;AAClD,YAAM,MAAM,GAAG,SAAS,MAAM;AAE9B,YAAM,cAAkC;AAAA,QACpC,WAAW,UAAU;AAAA,QACrB,OAAO,OAAO,OAAO;AAAA,QACrB,QAAQ,OAAO,OAAO;AAAA,QACtB,eAAe,KAAK,MAAM,OAAO,mBAAmB,GAAG,IAAI;AAAA,QAC3D,aAAa,OAAO,OAAO;AAAA,QAC3B,kBAAkB,OAAO;AAAA,QACzB,mBAAmB,OAAO;AAAA,MAC9B;AAEA,YAAM,SAAS,IAAI,gBAAgB;AACnC,aAAO,QAAQ,WAAW,EAAE,QAAQ,CAAC,CAAC,KAAK,KAAK,MAAM;AAClD,eAAO,OAAO,KAAK,MAAM,SAAS,CAAC;AAAA,MACvC,CAAC;AAED,UAAI;AACA,cAAM,WAAW,MAAM,MAAM,GAAG,GAAG,IAAI,OAAO,SAAS,CAAC,IAAI;AAAA,UACxD,QAAQ;AAAA,UACR,aAAa;AAAA,UACb,OAAO;AAAA,UACP,SAAS,EAAE,QAAQ,mBAAmB;AAAA,QAC1C,CAAC;AAED,YAAI,CAAC,SAAS,IAAI;AACd,gBAAM,IAAI,MAAM,4BAA4B,SAAS,MAAM,EAAE;AAAA,QACjE;AAEA,cAAM,OAAO,MAAM,SAAS,KAAK,EAAE,MAAM,OAAO,CAAC,EAAE;AACnD,cAAM,iBAAiB,UAAU,IAAI;AAErC,YAAI,eAAe,YAAY,GAAG;AAC9B,eAAK;AAAA,YACD;AAAA,YACA,eAAe;AAAA,UACnB;AACA,eAAK,mBAAmB,kCAAkC,eAAe,QAAQ;AACjF,eAAK,mBAAmB,8BAA8B,eAAe,KAAK;AAC1E,eAAK,mBAAmB,+BAA+B,eAAe,MAAM;AAC5E,eAAK;AAAA,YACD;AAAA,YACA,eAAe;AAAA,UACnB;AACA,eAAK;AAAA,YACD;AAAA,YACA,eAAe;AAAA,UACnB;AACA,eAAK,mBAAmB,2BAA2B,eAAe,SAAS;AAC3E,eAAK,mBAAmB,6BAA6B,eAAe,UAAU;AAC9E,eAAK;AAAA,YACD;AAAA,YACA,eAAe;AAAA,UACnB;AAAA,QACJ;AAAA,MACJ,SAAS,OAAO;AACZ,gBAAQ,MAAM,uBAAuB,KAAK;AAAA,MAC9C;AAAA,IACJ;AAAA;AAAA;AAAA;AAAA,IAKQ,mBAAmB,SAAiB,OAAsB;AAC9D,YAAM,UAAU,SAAS,eAAe,OAAO;AAC/C,UAAI,WAAW,UAAU,QAAW;AAChC,gBAAQ,QAAQ;AAAA,MACpB;AAAA,IACJ;AAAA;AAAA;AAAA;AAAA,IAMQ,4BAAkC;AACtC,YAAM,OAAO,SAAS,eAAe,eAAe;AACpD,UAAI,CAAC,KAAM;AAIX,YAAM,WAAW,KAAK,iBAAiB,WAAW;AAElD,WAAK,wBAAwB,CAAC;AAC9B,WAAK,yBAAyB,CAAC;AAG/B,YAAM,KAAK,QAAQ,EAAE,WAAW,EAAE,QAAQ,UAAQ;AAC9C,YAAI,KAAK,IAAI;AAET,eAAK,sBAAsB,KAAK,EAAE,IAAI,KAAK,MAAM;AACjD,eAAK,MAAM,UAAU;AAGrB,gBAAM,mBAAmB,KAAK;AAAA,YAC1B;AAAA,UACJ;AACA,2BAAiB,QAAQ,CAAC,SAAS,UAAU;AACzC,kBAAM,MAAM,GAAG,KAAK,EAAE,IAAI,KAAK;AAC/B,iBAAK,uBAAuB,GAAG,IAAI,EAAE,SAAS,UAAU,KAAK;AAC7D,YACI,QACF,WAAW;AAAA,UACjB,CAAC;AAAA,QACL;AAAA,MACJ,CAAC;AAGD,iBAAW,MAAM;AACb,aAAK,OAAO;AACZ,aAAK,iBAAiB,QAAQ;AAAA,MAClC,GAAG,EAAE;AAAA,IACT;AAAA;AAAA;AAAA;AAAA,IAKQ,iBAAiB,UAA4C;AAEjE,eAAS,QAAQ,UAAQ;AACrB,YAAI,KAAK,MAAM,KAAK,sBAAsB,KAAK,EAAE,MAAM,QAAW;AAC9D,eAAK,MAAM,UAAU,KAAK,sBAAsB,KAAK,EAAE;AAAA,QAC3D;AAAA,MACJ,CAAC;AAGD,aAAO,QAAQ,KAAK,sBAAsB,EAAE,QAAQ,CAAC,CAAC,GAAG,KAAK,MAAM;AAChE,YAAI,MAAM,WAAW,MAAM,UAAU;AACjC,UACI,MAAM,QACR,WAAW;AAAA,QACjB;AAAA,MACJ,CAAC;AAAA,IACL;AAAA;AAAA;AAAA;AAAA,IAKQ,kCAAwC;AAC5C,YAAM,SAAS,SAAS,eAAe,uBAAuB;AAC9D,UAAI,CAAC,OAAQ;AAEb,YAAM,SAAS,OAAO;AAGtB,YAAM,kBAAkB,SAAS;AAAA,QAC7B;AAAA,MACJ;AACA,sBAAgB,QAAQ,aAAW;AAC/B,YAAI,CAAC,QAAQ,UAAU,SAAS,gBAAgB,GAAG;AAC/C,kBAAQ,UAAU,IAAI,QAAQ;AAAA,QAClC;AAAA,MACJ,CAAC;AAGD,YAAM,SAAS,SAAS,eAAe,oBAAoB,MAAM,EAAE;AACnE,UAAI,QAAQ;AACR,eAAO,UAAU,OAAO,QAAQ;AAChC,eAAO,UAAU,IAAI,gBAAgB;AAAA,MACzC;AAAA,IACJ;AAAA,EACJ;;;ACjRO,WAAS,eAAqB;AACjC,UAAMC,aAAa,OAAe;AAClC,QAAI,OAAOA,eAAc,eAAe,CAACA,WAAU,QAAS;AAE5D,UAAM,kBAAkB,SAAS,iBAAiB,4BAA4B;AAC9E,oBAAgB,QAAQ,CAAC,OAAO;AAC5B,UAAI;AACA,YAAIA,WAAU,QAAQ,EAAE;AAAA,MAC5B,SAAS,GAAG;AAAA,MAEZ;AAAA,IACJ,CAAC;AAAA,EACL;AAEO,WAAS,kBAAkB,MAAiC;AAC/D,UAAM,YAAa,OAAe;AAClC,QAAI,OAAO,cAAc,YAAa;AAEtC,UAAM,YAAY,QAAQ;AAC1B,UAAM,iBAAiB,UAAU,iBAAiB,gBAAgB;AAElE,mBAAe,QAAQ,CAAC,OAAO;AAC3B,UAAI,CAAE,GAAW,YAAY;AACzB,YAAI,UAAU,IAAI,CAAC,CAAC;AACpB,QAAC,GAAW,aAAa;AAAA,MAC7B;AAAA,IACJ,CAAC;AAAA,EACL;AAGO,WAAS,qBAA2B;AACvC,UAAM,SAAS,SAAS,eAAe,iBAAiB;AACxD,UAAM,cAAc,SAAS,eAAe,cAAc;AAC1D,UAAM,aAAa,SAAS,eAAe,aAAa;AAExD,QAAI,OAAQ,QAAO,MAAM,UAAU;AACnC,QAAI,YAAa,aAAY,MAAM,UAAU;AAC7C,QAAI,YAAY;AACZ,iBAAW,UAAU,IAAI,SAAS;AAClC,iBAAW,UAAU,OAAO,aAAa;AAAA,IAC7C;AAGA,eAAW,MAAM;AACb,UAAI,YAAa,aAAY,MAAM,UAAU;AAC7C,UAAI,YAAY;AACZ,mBAAW,UAAU,OAAO,SAAS;AACrC,mBAAW,UAAU,IAAI,aAAa;AAAA,MAC1C;AAAA,IACJ,GAAG,GAAK;AAAA,EACZ;AAEO,WAAS,qBAA2B;AACvC,UAAM,SAAS,SAAS,eAAe,iBAAiB;AACxD,UAAM,cAAc,SAAS,eAAe,cAAc;AAC1D,UAAM,aAAa,SAAS,eAAe,aAAa;AAExD,QAAI,OAAQ,QAAO,MAAM,UAAU;AACnC,QAAI,YAAa,aAAY,MAAM,UAAU;AAC7C,QAAI,YAAY;AACZ,iBAAW,UAAU,IAAI,SAAS;AAClC,iBAAW,UAAU,OAAO,aAAa;AAAA,IAC7C;AAAA,EACJ;AAGO,WAAS,oBAA0B;AACtC,UAAM,gBAAgB,SAAS,cAAc,sBAAsB;AACnE,QAAI,CAAC,cAAe;AAEpB,kBAAc,iBAAiB,SAAS,MAAM;AAE1C,YAAM,WAAW,cAAc;AAC/B,YAAM,WAAW,0BAA0B,QAAQ;AAEnD,YAAM,SAAS,SAAS,cAAc,cAAc;AACpD,YAAM,SAAS,SAAS,cAAc,cAAc;AAEpD,UAAI,UAAU,QAAQ;AAClB,eAAO,MAAM,UAAU;AACvB,eAAO,MAAM,UAAU;AAEvB,YAAI,YAAY,GAAG;AACf,iBAAO,MAAM,UAAU;AACvB,iBAAO,MAAM,UAAU;AAAA,QAC3B,WAAW,YAAY,GAAG;AACtB,iBAAO,MAAM,UAAU;AAAA,QAC3B;AAAA,MACJ;AAAA,IACJ,CAAC;AAAA,EACL;AAEA,WAAS,0BAA0B,UAA0B;AACzD,QAAI,WAAW;AACf,QAAI,SAAS,UAAU,EAAG;AAC1B,QAAI,QAAQ,KAAK,QAAQ,EAAG;AAC5B,QAAI,QAAQ,KAAK,QAAQ,EAAG;AAC5B,QAAI,QAAQ,KAAK,QAAQ,EAAG;AAC5B,QAAI,eAAe,KAAK,QAAQ,EAAG;AACnC,WAAO;AAAA,EACX;AAGO,WAAS,oBAA0B;AACtC,aAAS,iBAAiB,oBAAoB,MAAM;AAChD,mBAAa;AACb,wBAAkB;AAClB,wBAAkB;AAGlB,eAAS,iBAAiB,SAAS,CAAC,MAAM;AACtC,cAAM,SAAS,EAAE;AACjB,YAAI,OAAO,UAAU,SAAS,aAAa,GAAG;AAC1C,6BAAmB;AAAA,QACvB;AACA,YAAI,OAAO,UAAU,SAAS,uBAAuB,GAAG;AACpD,6BAAmB;AAAA,QACvB;AAAA,MACJ,CAAC;AAAA,IACL,CAAC;AAAA,EACL;AAGA,oBAAkB;;;ACzHlB,MAAM,wBAAN,MAA4B;AAAA,IAChB;AAAA,IACA;AAAA,IACA,kBAA+B,oBAAI,IAAI;AAAA,IACvC,cAAsB;AAAA,IACtB,iBAAyB;AAAA,IACzB,aAAqB;AAAA;AAAA,IAE7B,YAAY,aAAqB,YAAoB;AACjD,WAAK,YAAY,SAAS,eAAe,WAAW;AACpD,WAAK,WAAW,SAAS,eAAe,UAAU;AAElD,UAAI,CAAC,KAAK,aAAa,CAAC,KAAK,UAAU;AACnC,cAAM,IAAI,MAAM,6BAA6B;AAAA,MACjD;AAEA,WAAK,kBAAkB;AACvB,WAAK,OAAO;AACZ,WAAK,qBAAqB;AAAA,IAC9B;AAAA,IAEQ,oBAA0B;AAC9B,UAAI,KAAK,SAAS,OAAO;AACrB,cAAM,kBAAkB,KAAK,SAAS,MACjC,MAAM,GAAG,EACT,IAAI,OAAK,SAAS,EAAE,KAAK,CAAC,CAAC,EAC3B,OAAO,OAAK,CAAC,MAAM,CAAC,KAAK,KAAK,KAAK,KAAK,GAAG;AAEhD,aAAK,kBAAkB,IAAI,IAAI,eAAe;AAAA,MAClD;AAAA,IACJ;AAAA,IAEQ,SAAe;AACnB,WAAK,UAAU,YAAY,KAAK,QAAQ;AAAA,IAC5C;AAAA,IAEQ,UAAkB;AACtB,YAAM,mBAAmB,KAAK,oBAAoB;AAClD,YAAM,gBAAgB,KAAK,gBAAgB;AAC3C,YAAM,WAAW,KAAK,YAAY;AAElC,aAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kCAUmB,aAAa;AAAA;AAAA,6DAEc,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAiC3C,iBAAiB,IAAI,SAAO;AAAA;AAAA,4DAEM,KAAK,gBAAgB,IAAI,GAAG,IAAI,gBAAgB,uBAAuB;AAAA,mEAChE,GAAG;AAAA,2DACX,GAAG;AAAA,kCAC5B,GAAG;AAAA;AAAA,yBAEZ,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+GAM4E,KAAK,gBAAgB,IAAI,aAAa,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA,0BAK7H,CAAC,GAAG,GAAG,GAAG,CAAC,EAAE,IAAI,UAAQ;AAAA;AAAA,6DAEU,SAAS,KAAK,cAAc,gBAAgB,qBAAqB;AAAA,+DAC/D,IAAI;AAAA,kCACjC,IAAI;AAAA;AAAA,yBAEb,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,+GAG4E,KAAK,gBAAgB,KAAK,aAAa,aAAa,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA,kBAKnJ,gBAAgB,IAAI;AAAA;AAAA;AAAA;AAAA,6DAIuB,MAAM,KAAK,KAAK,eAAe,EAAE,KAAK,CAAC,GAAG,MAAM,IAAI,CAAC,EAAE,KAAK,IAAI,CAAC;AAAA;AAAA;AAAA,oBAG1G,EAAE;AAAA;AAAA;AAAA,IAGlB;AAAA,IAEQ,sBAAgC;AACpC,YAAM,cAAc,KAAK,cAAc,KAAK,KAAK;AACjD,YAAM,WAAW,aAAa,KAAK;AACnC,YAAM,aAAa,MAAM,KAAK,EAAE,QAAQ,IAAI,GAAG,CAAC,GAAG,MAAM,IAAI,CAAC;AAC9D,aAAO,WAAW,MAAM,YAAY,QAAQ;AAAA,IAChD;AAAA,IAEQ,cAAsB;AAC1B,YAAM,SAAS,KAAK,cAAc,KAAK,KAAK,iBAAiB;AAC7D,YAAM,MAAM,KAAK,IAAI,KAAK,cAAc,KAAK,gBAAgB,GAAG;AAChE,aAAO,GAAG,KAAK,IAAI,GAAG;AAAA,IAC1B;AAAA,IAEO,aAAa,KAAmB;AACnC,UAAI,KAAK,gBAAgB,IAAI,GAAG,GAAG;AAC/B,aAAK,gBAAgB,OAAO,GAAG;AAAA,MACnC,OAAO;AACH,aAAK,gBAAgB,IAAI,GAAG;AAAA,MAChC;AACA,WAAK,eAAe;AACpB,WAAK,OAAO;AAAA,IAChB;AAAA,IAEO,WAAiB;AACpB,WAAK,gBAAgB,MAAM;AAC3B,WAAK,eAAe;AACpB,WAAK,OAAO;AAAA,IAChB;AAAA,IAEO,YAAY,OAAe,KAAmB;AACjD,eAAS,IAAI,OAAO,KAAK,KAAK,KAAK;AAC/B,YAAI,KAAK,KAAK,KAAK,KAAK;AACpB,eAAK,gBAAgB,IAAI,CAAC;AAAA,QAC9B;AAAA,MACJ;AACA,WAAK,eAAe;AACpB,WAAK,OAAO;AAAA,IAChB;AAAA,IAEO,aAAmB;AACtB,WAAK,oBAAoB,EAAE,QAAQ,SAAO;AACtC,aAAK,gBAAgB,IAAI,GAAG;AAAA,MAChC,CAAC;AACD,WAAK,eAAe;AACpB,WAAK,OAAO;AAAA,IAChB;AAAA,IAEO,eAAqB;AACxB,WAAK,oBAAoB,EAAE,QAAQ,SAAO;AACtC,aAAK,gBAAgB,OAAO,GAAG;AAAA,MACnC,CAAC;AACD,WAAK,eAAe;AACpB,WAAK,OAAO;AAAA,IAChB;AAAA,IAEO,SAAS,MAAoB;AAChC,UAAI,QAAQ,KAAK,QAAQ,KAAK,YAAY;AACtC,aAAK,cAAc;AACnB,aAAK,OAAO;AAAA,MAChB;AAAA,IACJ;AAAA,IAEO,WAAiB;AACpB,UAAI,KAAK,cAAc,KAAK,YAAY;AACpC,aAAK;AACL,aAAK,OAAO;AAAA,MAChB;AAAA,IACJ;AAAA,IAEO,WAAiB;AACpB,UAAI,KAAK,cAAc,GAAG;AACtB,aAAK;AACL,aAAK,OAAO;AAAA,MAChB;AAAA,IACJ;AAAA,IAEQ,iBAAuB;AAC3B,YAAM,gBAAgB,MAAM,KAAK,KAAK,eAAe,EAAE,KAAK,CAAC,GAAG,MAAM,IAAI,CAAC;AAC3E,YAAM,iBAAiB,cAAc,KAAK,IAAI;AAC9C,WAAK,SAAS,QAAQ;AAGtB,WAAK,SAAS,cAAc,IAAI,MAAM,UAAU,EAAE,SAAS,KAAK,CAAC,CAAC;AAClE,WAAK,SAAS,cAAc,IAAI,MAAM,SAAS,EAAE,SAAS,KAAK,CAAC,CAAC;AAAA,IACrE;AAAA,IAEQ,uBAA6B;AAEjC,WAAK,SAAS,iBAAiB,SAAS,MAAM;AAC1C,aAAK,kBAAkB;AACvB,aAAK,OAAO;AAAA,MAChB,CAAC;AAAA,IACL;AAAA,EACJ;AAGA,MAAI,SAAuC;AAUpC,WAAS,4BAA4B;AACxC,WAAO,wBAAwB;AAC/B,WAAO,SAAS;AAAA,EACpB;AAEA,WAAS,wBAAwB;AAC7B,UAAM,YAAY,SAAS,eAAe,4BAA4B;AACtE,UAAM,SAAS,SAAS,eAAe,mBAAmB;AAE1D,QAAI,CAAC,aAAa,CAAC,OAAQ;AAE3B,QAAI,UAAU,MAAM,YAAY,QAAQ;AAEpC,gBAAU,MAAM,UAAU;AAC1B,aAAO,YAAY;AAGnB,UAAI,CAAC,QAAQ;AAET,cAAM,YAAY,SAAS,cAAc,KAAK;AAC9C,kBAAU,KAAK;AAEf,cAAM,YAAY,UAAU,cAAc,QAAQ;AAClD,YAAI,aAAa,UAAU,aAAa;AACpC,oBAAU,aAAa,WAAW,UAAU,WAAW;AAAA,QAC3D,OAAO;AACH,oBAAU,YAAY,SAAS;AAAA,QACnC;AAEA,iBAAS,IAAI,sBAAsB,iBAAiB,kBAAkB;AACtE,eAAO,SAAS;AAAA,MACpB;AAAA,IACJ,OAAO;AAEH,gBAAU,MAAM,UAAU;AAC1B,aAAO,YAAY;AAAA,IACvB;AAAA,EACJ;AAGA,MAAI,SAAS,eAAe,WAAW;AACnC,aAAS,iBAAiB,oBAAoB,yBAAyB;AAAA,EAC3E,OAAO;AACH,8BAA0B;AAAA,EAC9B;;;AZ7RA,UAAQ,IAAI,kCAAkC;AAkB9C,MAAM,aAAN,MAAiB;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IAET,cAAc;AAEV,WAAK,uBAAuB,IAAI,oBAAoB;AACpD,WAAK,gBAAgB,IAAI,aAAa;AACtC,WAAK,iBAAiB,IAAI,cAAc;AACxC,WAAK,kBAAkB,IAAI,eAAe;AAC1C,WAAK,kBAAkB,IAAI,eAAe;AAC1C,WAAK,eAAe,IAAI,YAAY;AACpC,WAAK,qBAAqB,IAAI,kBAAkB;AAChD,WAAK,iBAAiB,IAAI,cAAc;AACxC,WAAK,mBAAmB,IAAI,gBAAgB;AAE5C,WAAK,mBAAmB;AACxB,WAAK,wBAAwB;AAG7B,mBAAa;AACb,wBAAkB;AAClB,wBAAkB;AAGlB,WAAK,yBAAyB;AAE9B,cAAQ;AAAA,QACJ;AAAA,MACJ;AAAA,IACJ;AAAA;AAAA;AAAA;AAAA,IAKQ,qBAA2B;AAC/B,eAAS,iBAAiB,oBAAoB,MAAM;AAChD,YAAI,OAAO,cAAc,eAAe,UAAU,SAAS;AACvD,gBAAM,kBAAkB,SAAS,iBAAiB,4BAA4B;AAC9E,0BAAgB,QAAQ,aAAW;AAC/B,gBAAI;AACA,kBAAI,UAAU,QAAQ,OAAkB;AAAA,YAC5C,SAAS,OAAO;AACZ,sBAAQ,KAAK,kCAAkC,KAAK;AAAA,YACxD;AAAA,UACJ,CAAC;AAAA,QACL;AAAA,MACJ,CAAC;AAAA,IACL;AAAA;AAAA;AAAA;AAAA,IAKQ,0BAAgC;AACpC,eAAS;AAAA,QACL;AAAA,QACA,CAAC,UAAsB;AACnB,gBAAM,SAAS,MAAM;AACrB,cAAI,QAAQ,WAAW,SAAS,UAAU,GAAG;AACzC,mBAAO,sBAAsB;AAAA,UACjC;AAAA,QACJ;AAAA,QACA;AAAA,MACJ;AAAA,IACJ;AAAA;AAAA;AAAA;AAAA,IAKQ,2BAAiC;AACrC,eAAS,iBAAiB,SAAS,CAAC,MAAM;AACtC,cAAM,SAAS,EAAE;AACjB,YAAI,OAAO,UAAU,SAAS,aAAa,GAAG;AAC1C,6BAAmB;AAAA,QACvB;AACA,YAAI,OAAO,UAAU,SAAS,uBAAuB,GAAG;AACpD,6BAAmB;AAAA,QACvB;AAAA,MACJ,CAAC;AAAA,IACL;AAAA,EACJ;AAGA,MAAI,SAAS,eAAe,WAAW;AACnC,aAAS,iBAAiB,oBAAoB,MAAM,IAAI,WAAW,CAAC;AAAA,EACxE,OAAO;AACH,QAAI,WAAW;AAAA,EACnB;",
  "names": ["getFieldValue", "secureReload", "setButtonLoading", "setButtonLoading", "getFieldValue", "setButtonLoading", "secureInsertHTML", "secureReload", "bootstrap"]
}
